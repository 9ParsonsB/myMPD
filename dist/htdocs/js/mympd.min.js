var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var f=b.length;c=c||0;for(0>c&&(c=Math.max(c+f,0));c<f;c++){var g=b[c];if(g===a||Object.is(g,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var f in d)$jscomp.owns(d,f)&&(a[f]=d[f])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");
function sendAPI(a,b,c,d){var f={jsonrpc:"2.0",id:0,method:a,params:b},g=new XMLHttpRequest;g.open("POST",subdir+"/api",!0);g.setRequestHeader("Content-type","application/json");g.onreadystatechange=function(){if(4===g.readyState)if(""!==g.responseText){var a=JSON.parse(g.responseText);if(a.error)showNotification(t(a.error.message,a.error.data),"","","danger"),logError(JSON.stringify(a.error));else if(a.result&&a.result.message&&"ok"!==a.result.message)logDebug("Got API response: "+JSON.stringify(a.result)),
showNotification(t(a.result.message,a.result.data),"","","success");else if(a.result&&a.result.message&&"ok"===a.result.message)logDebug("Got API response: "+JSON.stringify(a.result));else if(a.result&&a.result.method)logDebug("Got API response of type: "+a.result.method);else if(logError("Got invalid API response: "+JSON.stringify(a)),!0!==d)return;void 0!==c&&"function"===typeof c&&(void 0!==a.result||!0===d?(logDebug("Calling "+c.name),c(a)):logDebug("Undefined resultset, skip calling "+c.name))}else logError("Empty response for request: "+
JSON.stringify(f)),!0===d&&void 0!==c&&"function"===typeof c&&(logDebug("Got empty API response calling "+c.name),c(""))};g.send(JSON.stringify(f));logDebug("Send API request: "+a)}
function webSocketConnect(){if(null!==socket&&socket.readyState===WebSocket.OPEN)logInfo("Socket already connected"),websocketConnected=!0,socketRetry=0;else if(null!==socket&&socket.readyState===WebSocket.CONNECTING)logInfo("Socket connection in progress"),websocketConnected=!1,socketRetry++,20<socketRetry&&(logError("Socket connection timed out"),webSocketClose(),setTimeout(function(){webSocketConnect()},1E3),socketRetry=0);else{websocketConnected=!1;var a=getWsUrl();socket=new WebSocket(a);socketRetry=
0;logInfo("Connecting to "+a);try{socket.onopen=function(){logInfo("Websocket is connected");websocketConnected=!0;null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null)},socket.onmessage=function(b){try{var c=JSON.parse(b.data);logDebug("Websocket notification: "+JSON.stringify(c))}catch(d){logError("Invalid JSON data received: "+b.data);return}if(c.error)showNotification(t(c.error.message,c.error.data),"","","danger");else if(c.result)showNotification(t(c.result.message,c.result.data),
"","","success");else switch(c.method){case "welcome":websocketConnected=!0;showNotification(t("Connected to myMPD"),a,"","success");appRoute();sendAPI("MPD_API_PLAYER_STATE",{},parseState,!0);break;case "update_state":c.result=c.params;parseState(c);break;case "mpd_disconnected":progressTimer&&clearTimeout(progressTimer);getSettings(!0);break;case "mpd_connected":showNotification(t("Connected to MPD"),"","","success");sendAPI("MPD_API_PLAYER_STATE",{},parseState);getSettings(!0);break;case "update_queue":"Queue"===
app.current.app&&getQueue();c.result=c.params;parseUpdateQueue(c);break;case "update_options":getSettings();break;case "update_outputs":sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},parseOutputs);break;case "update_started":updateDBstarted(!1);break;case "update_database":case "update_finished":updateDBfinished(c.method);break;case "update_volume":c.result=c.params;parseVolume(c);break;case "update_stored_playlist":"Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view?sendAPI("MPD_API_PLAYLIST_LIST",
{offset:app.current.page,searchstr:app.current.search},parsePlaylists):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view&&sendAPI("MPD_API_PLAYLIST_CONTENT_LIST",{offset:app.current.page,searchstr:app.current.search,uri:app.current.search,cols:settings.colsBrowsePlaylistsDetail},parsePlaylists);break;case "update_lastplayed":"Queue"===app.current.app&&"LastPlayed"===app.current.tab&&sendAPI("MPD_API_QUEUE_LAST_PLAYED",{offset:app.current.page,cols:settings.colsQueueLastPlayed},
parseLastPlayed);break;case "update_jukebox":"Queue"===app.current.app&&"Jukebox"===app.current.tab&&sendAPI("MPD_API_JUKEBOX_LIST",{offset:app.current.page,cols:settings.colsQueueJukebox},parseJukeboxList);break;case "error":document.getElementById("alertMpdState").classList.contains("hide")&&showNotification(t(c.params.message),"","","danger");break;case "warn":document.getElementById("alertMpdState").classList.contains("hide")&&showNotification(t(c.params.message),"","","warning");break;case "info":document.getElementById("alertMpdState").classList.contains("hide")&&
showNotification(t(c.params.message),"","","success")}},socket.onclose=function(){logError("Websocket is disconnected");websocketConnected=!1;!0===appInited?(toggleUI(),progressTimer&&clearTimeout(progressTimer)):(showAppInitAlert(t("Websocket connection failed")),logError("Websocket connection failed."));null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null);websocketTimer=setTimeout(function(){logInfo("Reconnecting websocket");toggleAlert("alertMympdState",!0,t("Websocket connection failed, trying to reconnect")+
'&nbsp;&nbsp;<div class="spinner-border spinner-border-sm"></div>');webSocketConnect()},3E3);socket=null}}catch(b){logError(b)}}}function webSocketClose(){null!==websocketTimer&&(clearTimeout(websocketTimer),websocketTimer=null);null!==socket&&(socket.onclose=function(){},socket.close(),socket=null);websocketConnected=!1}function getWsUrl(){var a=window.location.hostname,b=window.location.protocol,c=window.location.port;return("https:"===b?"wss://":"ws://")+a+(""!==c?":"+c:"")+subdir+"/ws/"}
function navBrowseHandler(a){"BUTTON"===a.target.nodeName&&(a=a.target.getAttribute("data-tag"),"Playlists"===a||"Filesystem"===a?appGoto("Browse",a,void 0):"Browse"===app.current.app&&"Database"!==app.current.tab?appGoto("Browse","Database",app.apps.Browse.tabs.Database.active):("Album"!==a&&(app.current.filter=a,app.current.sort=a),app.current.search="",document.getElementById("searchDatabaseMatch").value="contains",appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,
app.current.sort,a,app.current.search)))}function gotoBrowse(){var a=event.target,b=a.getAttribute("data-tag"),c=decodeURI(a.getAttribute("data-name"));null===b&&(b=a.parentNode.getAttribute("data-tag"),c=decodeURI(a.parentNode.getAttribute("data-name")));""!==b&&""!==c&&"-"!==c&&settings.browsetags.includes(b)&&appGoto("Browse","Database","List","0",b,"AlbumArtist","Album",c)}
function parseFilesystem(a){var b=app.current.app+("Filesystem"===app.current.tab?app.current.tab:""),c=document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+"List"),d=c.getElementsByTagName("tbody")[0],f=settings["cols"+b].length;f--;if(a.error)d.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+f+'">'+t(a.error.message)+"</td></tr>";else{if("Browse"===app.current.app&&"Filesystem"===app.current.tab){var g=document.getElementById("BrowseFilesystemImages");
g.innerHTML="";0===a.result.images.length&&""===a.result.bookletPath||!1===settings.publish?g.classList.add("hide"):g.classList.remove("hide");if(""!==a.result.bookletPath&&!0===settings.publish){var h=document.createElement("div");h.style.backgroundImage='url("'+subdir+'/assets/coverimage-booklet.svg")';h.classList.add("booklet");h.setAttribute("data-href",subdir+"/browse/music/"+a.result.bookletPath);h.title=t("Booklet");g.appendChild(h)}for(h=0;h<a.result.images.length;h++){var k=document.createElement("div");
k.style.backgroundImage='url("'+subdir+"/browse/music/"+a.result.images[h]+'"),url("assets/coverimage-loading.svg")';g.appendChild(k)}}g=a.result.returnedEntities;h=d.getElementsByTagName("tr");c=document.activeElement.parentNode.parentNode===c?!0:!1;for(var l=k=0;l<g;l++){var m=encodeURI(a.result.data[l].uri),p=document.createElement("tr"),n="";p.setAttribute("data-type",a.result.data[l].Type);p.setAttribute("data-uri",m);p.setAttribute("tabindex",0);"song"===a.result.data[l].Type?p.setAttribute("data-name",
a.result.data[l].Title):p.setAttribute("data-name",a.result.data[l].name);switch(a.result.data[l].Type){case "dir":case "smartpls":case "plist":for(m=0;m<settings["cols"+b].length;m++)n+='<td data-col="'+settings["cols"+b][m]+'">',"Type"===settings["cols"+b][m]?n="dir"===a.result.data[l].Type?n+'<span class="material-icons">folder_open</span>':n+('<span class="material-icons">'+("smartpls"===a.result.data[l].Type?"queue_music":"list")+"</span>"):"Title"===settings["cols"+b][m]&&(n+=e(a.result.data[l].name)),
n+="</td>";n+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";p.innerHTML=n;break;case "song":a.result.data[l].Duration=beautifySongDuration(a.result.data[l].Duration);for(m=0;m<settings["cols"+b].length;m++)n+='<td data-col="'+settings["cols"+b][m]+'">',n="Type"===settings["cols"+b][m]?n+'<span class="material-icons">music_note</span>':n+e(a.result.data[l][settings["cols"+b][m]]),n+="</td>";n+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+
ligatureMore+"</a></td>";p.innerHTML=n}l<h.length?k=!0===replaceTblRow(h[l],p)?l:k:d.append(p)}for(b=h.length-1;b>=g;b--)h[b].remove();!0===c&&focusTable(0);setPagination(a.result.totalEntities,a.result.returnedEntities);0===g&&(d.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+f+'">'+t("Empty list")+"</td></tr>")}document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+"List").classList.remove("opacity05")}
function addAllFromBrowseFilesystem(){sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:app.current.search});showNotification(t("Added all songs"),"","","success")}function addAllFromBrowseDatabasePlist(a){2<=app.current.search.length&&sendAPI("MPD_API_DATABASE_SEARCH",{plist:a,filter:app.current.view,searchstr:app.current.search,offset:0,cols:settings.colsSearch,replace:!1})}
function parseBookmarks(a){for(var b='<table class="table table-sm table-dark table-borderless mb-0">',c=0;c<a.result.returnedEntities;c++)b+='<tr data-id="'+a.result.data[c].id+'" data-type="'+a.result.data[c].type+'" data-uri="'+encodeURI(a.result.data[c].uri)+'"><td class="nowrap"><a class="text-light" href="#" data-href="goto">'+e(a.result.data[c].name)+'</a></td><td><a class="text-light material-icons material-icons-small" href="#" data-href="edit">edit</a></td><td><a class="text-light material-icons material-icons-small" href="#" data-href="delete">delete</a></td></tr>';
0===a.result.returnedEntities&&(b+='<tr><td class="text-light nowrap">'+t("No bookmarks found")+"</td></tr>");b+="</table>";document.getElementById("BrowseFilesystemBookmarks").innerHTML=b}
function showBookmarkSave(a,b,c,d){document.getElementById("saveBookmarkName").classList.remove("is-invalid");document.getElementById("saveBookmarkId").value=a;document.getElementById("saveBookmarkName").value=b;document.getElementById("saveBookmarkUri").value=c;document.getElementById("saveBookmarkType").value=d;modalSaveBookmark.show()}
function saveBookmark(){var a=parseInt(document.getElementById("saveBookmarkId").value),b=document.getElementById("saveBookmarkName").value,c=document.getElementById("saveBookmarkUri").value,d=document.getElementById("saveBookmarkType").value;""!==b?(sendAPI("MYMPD_API_BOOKMARK_SAVE",{id:a,name:b,uri:c,type:d}),modalSaveBookmark.hide()):document.getElementById("saveBookmarkName").classList.add("is-invalid")}
function parseDatabase(a){var b=a.result.returnedEntities,c=document.getElementById("BrowseDatabaseCards"),d=c.getElementsByClassName("col"),f="IntersectionObserver"in window?!0:!1;0===d.length&&(c.innerHTML="");for(var g=0;g<b;g++){var h=document.createElement("div");h.classList.add("col","px-0","flex-grow-0");""===a.result.data[g].AlbumArtist&&(a.result.data[g].AlbumArtist=t("Unknown artist"));""===a.result.data[g].Album&&(a.result.data[g].Album=t("Unknown album"));if("Album"===a.result.tag){var k=
genId("database"+a.result.data[g].Album+a.result.data[g].AlbumArtist);var l=subdir+"/albumart/"+encodeURI(a.result.data[g].FirstSongUri);k='<div class="card card-grid clickable" data-picture="'+l+'" data-uri="'+encodeURI(a.result.data[g].FirstSongUri.replace(/\/[^/]+$/,""))+'" data-type="dir" data-name="'+encodeURI(a.result.data[g].Album)+'" data-album="'+encodeURI(a.result.data[g].Album)+'" data-albumartist="'+encodeURI(a.result.data[g].AlbumArtist)+'" tabindex="0"><div class="card-body album-cover-loading album-cover-grid bg-white" id="'+
k+'"></div><div class="card-footer card-footer-grid p-2" title="'+e(a.result.data[g].AlbumArtist)+": "+e(a.result.data[g].Album)+'">'+e(a.result.data[g].Album)+"<br/><small>"+e(a.result.data[g].AlbumArtist)+"</small></div></div>"}else k=genId("database"+a.result.data[g].value),l=subdir+"/tagpics/"+a.result.tag+"/"+encodeURI(a.result.data[g].value),k='<div class="card card-grid clickable" data-picture="'+l+'" data-tag="'+encodeURI(a.result.data[g].value)+'" tabindex="0">'+(!0===a.result.pics?'<div class="card-body album-cover-loading album-cover-grid bg-white" id="'+
k+'"></div>':"")+'<div class="card-footer card-footer-grid p-2" title="'+e(a.result.data[g].value)+'">'+e(a.result.data[g].value)+"<br/></div></div>";h.innerHTML=k;k=!1;g<d.length?d[g].firstChild.getAttribute("data-picture")!==h.firstChild.getAttribute("data-picture")&&(d[g].replaceWith(h),k=!0):(c.append(h),k=!0);!0===k&&(!0===f?(new IntersectionObserver(setGridImage,{root:null,rootMargin:"0px"})).observe(h):h.firstChild.firstChild.style.backgroundImage=l)}for(f=d.length-1;f>=b;f--)d[f].remove();
setPagination(a.result.totalEntities,a.result.returnedEntities);0===b&&(c.innerHTML='<div><span class="material-icons">error_outline</span>&nbsp;'+t("Empty list")+"</div>")}function setGridImage(a,b){a.forEach(function(a){if(0<a.intersectionRatio){b.unobserve(a.target);var c=decodeURI(a.target.firstChild.getAttribute("data-picture"));if(a=a.target.firstChild.getElementsByClassName("card-body")[0])a.style.backgroundImage='url("'+c+'"), url("'+subdir+'/assets/coverimage-loading.svg")'}})}
function parseAlbumDetails(a){var b=document.getElementById("viewDetailDatabaseCover");b.style.backgroundImage='url("'+subdir+"/albumart/"+a.result.data[0].uri+'"), url("'+subdir+'/assets/coverimage-loading.svg")';b.setAttribute("data-images",a.result.images.join(";;"));document.getElementById("viewDetailDatabaseInfo").innerHTML="<h1>"+e(a.result.Album)+"</h1><small> "+t("AlbumArtist")+"</small><p>"+e(a.result.AlbumArtist)+"</p>"+(""===a.result.bookletPath||!1===settings.featBrowse?"":'<span class="text-light material-icons">description</span>&nbsp;<a class="text-light" target="_blank" href="'+
subdir+"/browse/music/"+e(a.result.bookletPath)+'">'+t("Download booklet")+"</a>")+"</p>";b=document.getElementById("BrowseDatabaseDetailList").getElementsByTagName("tbody")[0];var c=settings.colsBrowseDatabaseDetail.length,d="";1<a.result.Discs&&(d='<tr class="not-clickable"><td><span class="material-icons">album</span></td><td colspan="'+c+'">'+t("Disc 1")+"</td></tr>");for(var f=a.result.returnedEntities,g=parseInt(a.result.data[0].Disc),h=0;h<f;h++){g<parseInt(a.result.data[h].Disc)&&(d+='<tr class="not-clickable"><td><span class="material-icons">album</span></td><td colspan="'+
c+'">'+t("Disc")+" "+e(a.result.data[h].Disc)+"</td></tr>");a.result.data[h].Duration&&(a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration));d+='<tr tabindex="0" data-type="song" data-name="'+a.result.data[h].Title+'" data-uri="'+encodeURI(a.result.data[h].uri)+'">';for(g=0;g<settings.colsBrowseDatabaseDetail.length;g++)d+='<td data-col="'+settings.colsBrowseDatabaseDetail[g]+'">'+e(a.result.data[h][settings.colsBrowseDatabaseDetail[g]])+"</td>";d+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+
ligatureMore+"</a></td></tr>";g=a.result.data[h].Disc}b.innerHTML=d;document.getElementById("BrowseDatabaseDetailList").classList.remove("opacity05")}function backToAlbumGrid(){appGoto("Browse","Database","List")}
function addAlbum(a){var b=decodeURI(app.current.tag),c=decodeURI(app.current.search);b="((Album == '"+b+"') AND (AlbumArtist == '"+c+"'))";"appendQueue"===a?addAllFromSearchPlist("queue",b,!1):"replaceQueue"===a?addAllFromSearchPlist("queue",b,!0):"addPlaylist"===a&&showAddToPlaylist("ALBUM",b)}
function searchAlbumgrid(a){for(var b="",c=document.getElementById("searchDatabaseCrumb").children,d=0;d<c.length;d++)0<d&&(b+=" AND "),b+="("+decodeURI(c[d].getAttribute("data-filter"))+")";""!==a&&(""!==b&&(b+=" AND "),c=document.getElementById("searchDatabaseMatch"),b+="("+app.current.filter+" "+c.options[c.selectedIndex].value+" '"+a+"')");2>=b.length&&(b="");appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,app.current.tag,b)}
function navigateGrid(a,b){var c=!1;"Enter"===b?"Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view?("Album"===app.current.tag?appGoto("Browse","Database","Detail","0","Album","AlbumArtist",decodeURI(a.getAttribute("data-album")),decodeURI(a.getAttribute("data-albumartist"))):(app.current.search="",document.getElementById("searchDatabaseStr").value="",appGoto(app.current.app,app.current.card,void 0,"0","Album","AlbumArtist","Album","("+app.current.tag+" == '"+decodeURI(a.getAttribute("data-tag"))+
"')")),c=!0):"Home"===app.current.app&&(a=event.target.getAttribute("data-href"),null!==a&&parseCmd(event,a)):" "===b?"Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view?("Album"===app.current.tag&&showMenu(a.getElementsByClassName("card-footer")[0],event),c=!0):"Home"===app.current.app&&showMenu(a.getElementsByClassName("card-footer")[0],event):"ArrowDown"===b||"ArrowUp"===b?(b="ArrowDown"===b?null!==a.parentNode.nextElementSibling?a.parentNode.nextElementSibling.firstChild:
null:null!==a.parentNode.previousElementSibling?a.parentNode.previousElementSibling.firstChild:null,null!==b&&(b.focus(),a.classList.remove("selected"),b.classList.add("selected"),c=!0,scrollFocusIntoView())):"Escape"===b&&(a.blur(),a.classList.remove("selected"),c=!0);!0===c&&(event.stopPropagation(),event.preventDefault())}
function parseHome(a){var b=a.result.returnedEntities,c=document.getElementById("HomeCards"),d=c.getElementsByClassName("col");0===d.length&&(c.innerHTML="");for(var f=0;f<b;f++){var g=document.createElement("div");g.classList.add("col","px-0","flex-grow-0");""===a.result.data[f].AlbumArtist&&(a.result.data[f].AlbumArtist=t("Unknown artist"));""===a.result.data[f].Album&&(a.result.data[f].Album=t("Unknown album"));var h=JSON.stringify({cmd:a.result.data[f].cmd,options:a.result.data[f].options});h=
'<div class="card home-icons clickable" draggable="true" tabindex="0" data-pos="'+f+"\" data-href='"+h+"'  title=\""+e(a.result.data[f].name)+'"><div class="card-body material-icons">'+e(a.result.data[f].ligature)+'</div><div class="card-footer card-footer-grid p-2">'+e(a.result.data[f].name)+"</div></div>";g.innerHTML=h;f<d.length?d[f].replaceWith(g):c.append(g);""!==a.result.data[f].image&&(g.getElementsByClassName("card-body")[0].style.backgroundImage='url("'+subdir+"/browse/pics/"+a.result.data[f].image+
'")');""!==a.result.data[f].bgcolor&&(g.getElementsByClassName("card-body")[0].style.backgroundColor=a.result.data[f].bgcolor)}for(a=d.length-1;a>=b;a--)d[a].remove();0===b&&(c.innerHTML="<div>"+t("You have not added any Home Icons yet. You can add views, playlists and scripts.")+"</div>")}
function dragAndDropHome(){var a=document.getElementById("HomeCards");a.addEventListener("dragstart",function(a){a.target.classList.contains("home-icons")&&(a.target.classList.add("opacity05"),a.dataTransfer.setDragImage(a.target,0,0),a.dataTransfer.effectAllowed="move",dragSrc=a.target,dragEl=a.target.cloneNode(!0))},!1);a.addEventListener("dragleave",function(a){a.preventDefault();!1!==dragEl.classList.contains("home-icons")&&"DIV"===a.target.nodeName&&a.target.classList.contains("home-icons")&&
a.target.classList.remove("dragover-icon")},!1);a.addEventListener("dragover",function(b){b.preventDefault();if(!1!==dragEl.classList.contains("home-icons")){for(var c=a.getElementsByClassName("dragover-icon"),d=c.length,f=0;f<d;f++)c[f].classList.remove("dragover-icon");"DIV"===b.target.nodeName&&b.target.classList.contains("home-icons")?b.target.classList.add("dragover-icon"):"DIV"===b.target.nodeName&&b.target.parentNode.classList.contains("home-icons")&&b.target.parentNode.classList.add("dragover-icon");
b.dataTransfer.dropEffect="move"}},!1);a.addEventListener("dragend",function(b){b.preventDefault();if(!1!==dragEl.classList.contains("home-icons")){b=a.getElementsByClassName("dragover-icon");for(var c=b.length,d=0;d<c;d++)b[d].classList.remove("dragover-icon");dragSrc.classList.remove("opacity05")}},!1);a.addEventListener("drop",function(b){b.preventDefault();b.stopPropagation();if(!1!==dragEl.classList.contains("home-icons")){b=b.target;if("DIV"===b.nodeName&&(b.classList.contains("card-body")&&
(b=b.parentNode),b.classList.contains("home-icons"))){dragEl.classList.remove("opacity05");b=parseInt(b.getAttribute("data-pos"));var c=parseInt(dragSrc.getAttribute("data-pos"));!1===isNaN(b)&&!1===isNaN(c)&&c!==b&&sendAPI("MYMPD_API_HOME_ICON_MOVE",{from:c,to:b},function(a){parseHome(a)})}b=a.getElementsByClassName("dragover-icon");c=b.length;for(var d=0;d<c;d++)b[d].classList.remove("dragover-icon")}},!1)}
function executeHomeIcon(a){a=document.getElementById("HomeCards").children[a].firstChild;parseCmd(null,a.getAttribute("data-href"))}function addViewToHome(){_addHomeIcon("appGoto","","preview",[app.current.app,app.current.tab,app.current.view,app.current.page,app.current.filter,app.current.sort,app.current.tag,app.current.search])}function addScriptToHome(a,b){b=JSON.parse(b);b=[b.script,b.arguments.join(",")];_addHomeIcon("execScriptFromOptions",a,"description",b)}
function addPlistToHome(a,b){_addHomeIcon("replaceQueue",b,"list",["plist",a,b])}
function _addHomeIcon(a,b,c,d){document.getElementById("modalEditHomeIconTitle").innerHTML=t("Add to homescreen");document.getElementById("inputHomeIconReplace").value="false";document.getElementById("inputHomeIconOldpos").value="0";document.getElementById("inputHomeIconName").value=b;document.getElementById("inputHomeIconLigature").value=c;document.getElementById("inputHomeIconBgcolor").value="#28a745";document.getElementById("selectHomeIconCmd").value=a;showHomeIconCmdOptions(d);getHomeIconPictureList("");
document.getElementById("homeIconPreview").innerText=c;document.getElementById("homeIconPreview").style.backgroundColor="#28a745";document.getElementById("homeIconPreview").style.backgroundImage="";document.getElementById("divHomeIconLigature").classList.remove("hide");modalEditHomeIcon.show()}function duplicateHomeIcon(a){_editHomeIcon(a,!1,"Duplicate home icon")}function editHomeIcon(a){_editHomeIcon(a,!0,"Edit home icon")}
function _editHomeIcon(a,b,c){document.getElementById("modalEditHomeIconTitle").innerHTML=t(c);sendAPI("MYMPD_API_HOME_ICON_GET",{pos:a},function(c){document.getElementById("inputHomeIconReplace").value=b;document.getElementById("inputHomeIconOldpos").value=a;document.getElementById("inputHomeIconName").value=c.result.data.name;document.getElementById("inputHomeIconLigature").value=c.result.data.ligature;document.getElementById("inputHomeIconBgcolor").value=c.result.data.bgcolor;document.getElementById("selectHomeIconCmd").value=
c.result.data.cmd;showHomeIconCmdOptions(c.result.data.options);getHomeIconPictureList(c.result.data.image);document.getElementById("homeIconPreview").innerText=c.result.data.ligature;document.getElementById("homeIconPreview").style.backgroundColor=c.result.data.bgcolor;""===c.result.data.image?(document.getElementById("divHomeIconLigature").classList.remove("hide"),document.getElementById("homeIconPreview").style.backgroundImage=""):(document.getElementById("divHomeIconLigature").classList.add("hide"),
document.getElementById("homeIconPreview").style.backgroundImage="url("+subdir+'"/browse/pics/'+c.result.data.image+'")');modalEditHomeIcon.show()})}
function saveHomeIcon(){var a=!0,b=document.getElementById("inputHomeIconName");validateNotBlank(b)||(a=!1);if(!0===a){a=[];for(var c=document.getElementById("divHomeIconOptions").getElementsByTagName("input"),d=0;d<c.length;d++)a.push(""!==c[d].value?c[d].value:"!undefined!");c=getSelectValue("selectHomeIconImage");sendAPI("MYMPD_API_HOME_ICON_SAVE",{replace:"true"===document.getElementById("inputHomeIconReplace").value?!0:!1,oldpos:parseInt(document.getElementById("inputHomeIconOldpos").value),
name:b.value,ligature:""===c?document.getElementById("inputHomeIconLigature").value:"",bgcolor:document.getElementById("inputHomeIconBgcolor").value,image:c,cmd:document.getElementById("selectHomeIconCmd").value,options:a},function(){modalEditHomeIcon.hide();sendAPI("MYMPD_API_HOME_LIST",{},function(a){parseHome(a)})})}}function deleteHomeIcon(a){sendAPI("MYMPD_API_HOME_ICON_DELETE",{pos:a},function(a){parseHome(a)})}
function showHomeIconCmdOptions(a){var b="",c=getSelectedOptionAttribute("selectHomeIconCmd","data-options");if(void 0!==c){c=JSON.parse(c);for(var d=0;d<c.options.length;d++){var f=void 0!==a?void 0!==a[d]?a[d]:"":"";b+='<div class="form-group row"><label class="col-sm-4 col-form-label">'+t(c.options[d])+'</label><div class="col-sm-8"><input class="form-control border-secondary" value="'+e(f)+'"></div></div>'}}document.getElementById("divHomeIconOptions").innerHTML=b}
function getHomeIconPictureList(a){sendAPI("MYMPD_API_HOME_ICON_PICTURE_LIST",{},function(b){for(var c='<option value="">'+t("Use ligature")+"</option>",d=0;d<b.result.returnedEntities;d++)c+='<option value="'+e(b.result.data[d])+'">'+e(b.result.data[d])+"</option>";b=document.getElementById("selectHomeIconImage");b.innerHTML=c;b.value=a})}
function delQueueJukeboxSong(a){sendAPI("MPD_API_JUKEBOX_RM",{pos:a},function(){sendAPI("MPD_API_JUKEBOX_LIST",{offset:app.current.page,cols:settings.colsQueueJukebox},parseJukeboxList)})}
function parseJukeboxList(a){var b=a.result.returnedEntities,c=document.getElementById("QueueJukeboxList"),d=document.activeElement.parentNode.parentNode===c?!0:!1,f=0;c=c.getElementsByTagName("tbody")[0];for(var g=c.getElementsByTagName("tr"),h=0;h<b;h++){a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration);a.result.data[h].LastPlayed=localeDate(a.result.data[h].LastPlayed);var k=document.createElement("tr");k.setAttribute("data-uri",a.result.data[h].uri);k.setAttribute("data-name",
a.result.data[h].Title);k.setAttribute("data-type","song");k.setAttribute("data-pos",h);k.setAttribute("tabindex",0);for(var l="",m=0;m<settings.colsQueueJukebox.length;m++)l+='<td data-col="'+settings.colsQueueJukebox[m]+'">'+e(a.result.data[h][settings.colsQueueJukebox[m]])+"</td>";l+='<td data-col="Action">';""!==a.result.data[h].uri&&(l+='<a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a>");l+="</td>";k.innerHTML=l;h<g.length?f=!0===replaceTblRow(g[h],k)?h:f:c.append(k)}for(h=
g.length-1;h>=b;h--)g[h].remove();g=settings.colsQueueJukebox.length;g--;0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("Empty list")+"</td></tr>");!0===d&&focusTable(f);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueJukeboxList").classList.remove("opacity05")}
var keymap={ArrowLeft:{cmd:"clickPrev",options:[],desc:"Previous song",key:"keyboard_arrow_left"},ArrowRight:{cmd:"clickNext",options:[],desc:"Next song",key:"keyboard_arrow_right"}," ":{cmd:"clickPlay",options:[],desc:"Toggle play / pause",key:"space_bar"},s:{cmd:"clickStop",options:[],desc:"Stop playing"},"-":{cmd:"volumeStep",options:["down"],desc:"Volume down"},"+":{cmd:"volumeStep",options:["up"],desc:"Volume up"},c:{cmd:"sendAPI",options:[{cmd:"MPD_API_QUEUE_CLEAR"}],desc:"Clear queue"},u:{cmd:"updateDB",
options:["",!0],desc:"Update database"},r:{cmd:"rescanDB",options:["",!0],desc:"Rescan database"},p:{cmd:"updateSmartPlaylists",options:[!1],desc:"Update smart playlists",req:"featSmartpls"},a:{cmd:"showAddToPlaylist",options:["stream",""],desc:"Add stream"},t:{cmd:"openModal",options:["modalSettings"],desc:"Open settings"},i:{cmd:"clickTitle",options:[],desc:"Open song details"},l:{cmd:"openDropdown",options:["dropdownLocalPlayer"],desc:"Open local player"},0:{cmd:"appGoto",options:["Playback"],
desc:"Goto playback"},1:{cmd:"appGoto",options:["Queue","Current"],desc:"Goto queue"},2:{cmd:"appGoto",options:["Queue","LastPlayed"],desc:"Goto last played"},3:{cmd:"appGoto",options:["Browse","Database"],desc:"Goto browse database",req:"featTags"},4:{cmd:"appGoto",options:["Browse","Playlists"],desc:"Goto browse playlists",req:"featPlaylists"},5:{cmd:"appGoto",options:["Browse","Filesystem"],desc:"Goto browse filesystem"},6:{cmd:"appGoto",options:["Search"],desc:"Goto search"},m:{cmd:"openDropdown",
options:["dropdownMainMenu"],desc:"Open main menu"},v:{cmd:"openDropdown",options:["dropdownVolumeMenu"],desc:"Open volume menu"},S:{cmd:"sendAPI",options:[{cmd:"MPD_API_QUEUE_SHUFFLE"}],desc:"Shuffle queue"},C:{cmd:"sendAPI",options:[{cmd:"MPD_API_QUEUE_CROP"}],desc:"Crop queue"},"?":{cmd:"openModal",options:["modalAbout"],desc:"Open about"},"/":{cmd:"focusSearch",options:[],desc:"Focus search"},n:{cmd:"focusTable",options:[],desc:"Focus table"},q:{cmd:"queueSelectedItem",options:[!0],desc:"Append item to queue"},
Q:{cmd:"queueSelectedItem",options:[!1],desc:"Replace queue with item"},d:{cmd:"dequeueSelectedItem",options:[],desc:"Remove item from queue"},x:{cmd:"addSelectedItemToPlaylist",options:[],desc:"Append item to playlist"},F:{cmd:"openFullscreen",options:[],desc:"Open fullscreen"}};
function e(a){return isNaN(a)?a.replace(/([<>"'])/g,function(a,c){if("<"===c)return"&lt;";if(">"===c)return"&gt;";if('"'===c)return"&quot;";if("'"===c)return"&apos;"}).replace(/\\u(003C|003E|0022|0027)/gi,function(a,c){if("003C"===c)return"&lt;";if("003E"===c)return"&gt;";if("0022"===c)return"&quot;";if("0027"===c)return"&apos;"}):a}
function t(a,b,c){var d=void 0;isNaN(b)&&(c=b);phrases[a]&&(d=phrases[a][locale],void 0===d&&("en-US"!==locale&&logWarn('Phrase "'+a+'" for locale '+locale+" not found"),d=phrases[a]["en-US"]));void 0===d&&(d=a);!1===isNaN(b)&&(a=d.split(" |||| "),1<a.length&&(d=a[smartCount(b)]),d=d.replace("%{smart_count}",b));null!==c&&(d=d.replace(/%\{(\w+)\}/g,function(a,b){return c[b]}));return e(d)}function smartCount(a){return 0===a?1:1===a?0:1}
function localeDate(a){return(void 0===a?new Date:new Date(1E3*a)).toLocaleString(locale)}function beautifyDuration(a){var b=Math.floor(a/86400),c=Math.floor(a/3600)-24*b,d=Math.floor(a/60)-60*c-1440*b;a=a-86400*b-3600*c-60*d;return(0<b?b+"\u2009"+t("Days")+" ":"")+(0<c?c+"\u2009"+t("Hours")+" "+(10>d?"0":""):"")+d+"\u2009"+t("Minutes")+" "+(10>a?"0":"")+a+"\u2009"+t("Seconds")}
function beautifySongDuration(a){var b=Math.floor(a/3600),c=Math.floor(a/60)-60*b;a=a-3600*b-60*c;return(0<b?b+":"+(10>c?"0":""):"")+c+":"+(10>a?"0":"")+a}function gtPage(a,b,c){return-1<c?t(a,c):b+app.current.page<settings.maxElementsPerPage?t(a,b):"> "+t(a,settings.maxElementsPerPage)}
function i18nHtml(a){for(var b=[["data-phrase","innerText"],["data-title-phrase","title"],["data-placeholder-phrase","placeholder"]],c=0;c<b.length;c++)for(var d=a.querySelectorAll("["+b[c][0]+"]"),f=d.length,g=0;g<f;g++)d[g][b[c][1]]=t(d[g].getAttribute(b[c][0]))}
function setLocalPlayerUrl(){"https:"===window.location.protocol?(document.getElementById("infoLocalplayer").classList.remove("hide"),document.getElementById("selectStreamMode").options[0].setAttribute("data-phrase","HTTPS Port")):(document.getElementById("infoLocalplayer").classList.add("hide"),document.getElementById("selectStreamMode").options[0].setAttribute("data-phrase","HTTP Port"));""===settings.streamUrl?(settings.mpdstream=window.location.protocol+"//",null!==settings.mpdHost.match(/^127\./)||
"localhost"===settings.mpdHost||null!==settings.mpdHost.match(/^\//)?settings.mpdstream+=window.location.hostname:settings.mpdstream+=settings.mpdHost,settings.mpdstream+=":"+settings.streamPort+"/"):settings.mpdstream=settings.streamUrl;var a=document.getElementById("localPlayer");a.src!==settings.mpdstream&&(a.pause(),a.src=settings.mpdstream,a.load(),setTimeout(function(){checkLocalPlayerState()},500))}
function clickCheckLocalPlayerState(a){var b=a.target;b.classList.add("disabled");a=document.getElementById("localPlayer").parentNode;document.getElementById("localPlayer").remove();var c=document.createElement("audio");c.setAttribute("preload","none");c.setAttribute("controls","");c.setAttribute("id","localPlayer");c.classList.add("mx-4");a.appendChild(c);setLocalPlayerUrl();setTimeout(function(){b.classList.remove("disabled");c.play()},500)}
function checkLocalPlayerState(){var a=document.getElementById("localPlayer");document.getElementById("errorLocalPlayback").classList.add("hide");document.getElementById("alertLocalPlayback").classList.add("hide");0===a.networkState?(logDebug("localPlayer networkState: "+a.networkState),document.getElementById("alertLocalPlayback").classList.remove("hide")):1<=a.networkState&&logDebug("localPlayer networkState: "+a.networkState);3===a.networkState&&(logError("localPlayer networkState: "+a.networkState),
document.getElementById("errorLocalPlayback").classList.remove("hide"))}function logError(a){logLog(0,"ERROR: "+a)}function logWarn(a){logLog(1,"WARN: "+a)}function logInfo(a){logLog(2,"INFO: "+a)}function logVerbose(a){logLog(3,"VERBOSE: "+a)}function logDebug(a){logLog(4,"DEBUG: "+a)}function logLog(a,b){settings.loglevel>=a&&(0===a?console.error(b):1===a?console.warn(b):4===a?console.debug(b):console.log(b))}
function openFullscreen(){var a=document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}
function setViewport(a){document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale="+scale+", maximum-scale="+scale);if(!0===a)try{localStorage.setItem("scale-ratio",scale)}catch(b){logError("Can not save scale-ratio in localStorage: "+b.message)}}
function addStream(){var a=document.getElementById("streamUrl");!0===validateStream(a)&&(sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:a.value}),modalAddToPlaylist.hide(),showNotification(t("Added stream %{streamUri} to queue",{streamUri:a.value}),"","","success"))}function seekRelativeForward(){seekRelative(5)}function seekRelativeBackward(){seekRelative(-5)}function seekRelative(a){sendAPI("MPD_API_SEEK_CURRENT",{seek:a,relative:!0})}
function clickPlay(){"play"!==playstate?sendAPI("MPD_API_PLAYER_PLAY",{}):!0===settings.footerStop?sendAPI("MPD_API_PLAYER_STOP",{}):sendAPI("MPD_API_PLAYER_PAUSE",{})}function clickStop(){sendAPI("MPD_API_PLAYER_STOP",{})}function clickPrev(){sendAPI("MPD_API_PLAYER_PREV",{})}function clickNext(){sendAPI("MPD_API_PLAYER_NEXT",{})}function execSyscmd(a){sendAPI("MYMPD_API_SYSCMD",{cmd:a})}function clearCovercache(){sendAPI("MYMPD_API_COVERCACHE_CLEAR",{})}
function cropCovercache(){sendAPI("MYMPD_API_COVERCACHE_CROP",{})}function updateDB(a,b){sendAPI("MPD_API_DATABASE_UPDATE",{uri:a});updateDBstarted(b)}function rescanDB(a,b){sendAPI("MPD_API_DATABASE_RESCAN",{uri:a});updateDBstarted(b)}
function updateDBstarted(a){!0===a&&(document.getElementById("updateDBfinished").innerText="",document.getElementById("updateDBfooter").classList.add("hide"),a=document.getElementById("updateDBprogress"),a.style.width="20px",a.style.marginLeft="-20px",modalUpdateDB.show(),a.classList.add("updateDBprogressAnimate"));showNotification(t("Database update started"),"","","success")}
function updateDBfinished(a){document.getElementById("modalUpdateDB").classList.contains("show")?_updateDBfinished(a):setTimeout(function(){_updateDBfinished(a)},100)}
function _updateDBfinished(a){var b=document.getElementById("spinnerUpdateProgress");if(b){var c=b.parentNode;b.remove();for(b=0;b<c.children.length;b++)c.children[b].classList.remove("hide")}document.getElementById("modalUpdateDB").classList.contains("show")&&("update_database"===a?document.getElementById("updateDBfinished").innerText=t("Database successfully updated"):"update_finished"===a&&(document.getElementById("updateDBfinished").innerText=t("Database update finished")),c=document.getElementById("updateDBprogress"),
c.classList.remove("updateDBprogressAnimate"),c.style.width="100%",c.style.marginLeft="0px",document.getElementById("updateDBfooter").classList.remove("hide"));"update_database"===a?showNotification(t("Database successfully updated"),"","","success"):"update_finished"===a&&showNotification(t("Database update finished"),"","","success")}
function zoomPicture(a){if(a.classList.contains("booklet"))window.open(a.getAttribute("data-href"));else{if(a.classList.contains("carousel")){var b=null!==a.getAttribute("data-images")?a.getAttribute("data-images").split(";;"):lastSongObj.images.slice();if(0<b.length){for(a=0;a<b.length;a++)b[a]=subdir+"/browse/music/"+b[a];a=document.getElementById("modalPictureImg");a.style.paddingTop=0;createImgCarousel(a,"picsCarousel",b);document.getElementById("modalPictureZoom").classList.add("hide");modalPicture.show();
return}}""!==a.style.backgroundImage&&(b=document.getElementById("modalPictureImg"),b.innerHTML="",b.style.paddingTop="100%",b.style.backgroundImage=a.style.backgroundImage,document.getElementById("modalPictureZoom").classList.remove("hide"),modalPicture.show())}}function zoomZoomPicture(){window.open(document.getElementById("modalPictureImg").style.backgroundImage.match(/^url\(["']?([^"']*)["']?\)/)[1])}
function createImgCarousel(a,b,c){for(var d='<div id="'+b+'" class="carousel slide" data-ride="carousel"><ol class="carousel-indicators">',f=0;f<c.length;f++)d+='<li data-target="#'+b+'" data-slide-to="'+f+'"'+(0===f?' class="active"':"")+"></li>";d+='</ol><div class="carousel-inner" role="listbox">';for(f=0;f<c.length;f++)d+='<div class="carousel-item'+(0===f?" active":"")+'"><div></div></div>';a.innerHTML=d+('</div><a class="carousel-control-prev" href="#'+b+'" data-slide="prev"><span class="carousel-control-prev-icon"></span></a><a class="carousel-control-next" href="#'+
b+'" data-slide="next"><span class="carousel-control-next-icon"></span></a></div>');a=a.getElementsByClassName("carousel-item");for(d=0;d<a.length;d++)a[d].children[0].style.backgroundImage='url("'+encodeURI(c[d])+'")';b=document.getElementById(b);new BSN.Carousel(b,{interval:!1,pause:!1})}function unmountMount(a){sendAPI("MPD_API_MOUNT_UNMOUNT",{mountPoint:a},showListMounts)}
function mountMount(){document.getElementById("errorMount").classList.add("hide");sendAPI("MPD_API_MOUNT_MOUNT",{mountUrl:getSelectValue("selectMountUrlhandler")+document.getElementById("inputMountUrl").value,mountPoint:document.getElementById("inputMountPoint").value},showListMounts,!0)}
function updateMount(a,b){for(var c=a.parentNode,d=0;d<c.children.length;d++)c.children[d].classList.add("hide");c=document.createElement("div");c.setAttribute("id","spinnerUpdateProgress");c.classList.add("spinner-border","spinner-border-sm");a.parentNode.insertBefore(c,a);updateDB(b,!1)}
function showEditMount(a,b){document.getElementById("listMounts").classList.remove("active");document.getElementById("editMount").classList.add("active");document.getElementById("listMountsFooter").classList.add("hide");document.getElementById("editMountFooter").classList.remove("hide");document.getElementById("errorMount").classList.add("hide");a=a.match(/^(\w+:\/\/)(.+)$/);null!==a&&2<a.length?(document.getElementById("selectMountUrlhandler").value=a[1],document.getElementById("inputMountUrl").value=
a[2],document.getElementById("inputMountPoint").value=b):(document.getElementById("inputMountUrl").value="",document.getElementById("inputMountPoint").value="");document.getElementById("inputMountUrl").focus();document.getElementById("inputMountUrl").classList.remove("is-invalid");document.getElementById("inputMountPoint").classList.remove("is-invalid")}
function showListMounts(a){if(a&&a.error&&a.error.message){var b=document.getElementById("errorMount");b.innerText=a.error.message;b.classList.remove("hide")}else document.getElementById("listMounts").classList.add("active"),document.getElementById("editMount").classList.remove("active"),document.getElementById("listMountsFooter").classList.remove("hide"),document.getElementById("editMountFooter").classList.add("hide"),sendAPI("MPD_API_MOUNT_LIST",{},parseListMounts)}
function parseListMounts(a){for(var b=document.getElementById("listMounts").getElementsByTagName("tbody")[0],c=b.getElementsByTagName("tr"),d=0,f=0;f<a.result.returnedEntities;f++){var g=document.createElement("tr");g.setAttribute("data-url",encodeURI(a.result.data[f].mountUrl));g.setAttribute("data-point",encodeURI(a.result.data[f].mountPoint));""===a.result.data[f].mountPoint&&g.classList.add("not-clickable");var h="<td>"+(""===a.result.data[f].mountPoint?'<span class="material-icons">home</span>':
e(a.result.data[f].mountPoint))+"</td><td>"+e(a.result.data[f].mountUrl)+"</td>";h=""!==a.result.data[f].mountPoint?h+('<td data-col="Action"><a href="#" title="'+t("Unmount")+'" data-action="unmount" class="material-icons color-darkgrey">delete</a><a href="#" title="'+t("Update")+'" data-action="update"class="material-icons color-darkgrey">refresh</a></td>'):h+"<td>&nbsp;</td>";g.innerHTML=h;f<c.length?d=!0===replaceTblRow(c[f],g)?f:d:b.append(g)}for(d=c.length-1;d>=a.result.returnedEntities;d--)c[d].remove();
0===a.result.returnedEntities&&(b.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="4">'+t("Empty list")+"</td></tr>")}
function parseNeighbors(a){var b="";if(a.error)b='<div class="list-group-item"><span class="material-icons">error_outline</span> '+t(a.error.message)+"</div>";else{for(var c=0;c<a.result.returnedEntities;c++)b+='<a href="#" class="list-group-item list-group-item-action" data-value="'+a.result.data[c].uri+'">'+a.result.data[c].uri+"<br/><small>"+a.result.data[c].displayName+"</small></a>";0===a.result.returnedEntities&&(b='<div class="list-group-item"><span class="material-icons">error_outline</span>&nbsp;'+
t("Empty list")+"</div>")}document.getElementById("dropdownNeighbors").children[0].innerHTML=b}
var socket=null,websocketConnected=!1,websocketTimer=null,socketRetry=0,lastSong="",lastSongObj={},lastState,currentSong={},playstate="",settingsLock=!1,settingsParsed=!1,settingsNew={},settings={loglevel:2},alertTimeout=null,progressTimer=null,deferredA2HSprompt,dragSrc,dragEl,appInited=!1,subdir="",uiEnabled=!0,locale=navigator.language||navigator.userLanguage,scale="1.0",isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),ligatureMore="menu",progressBarTransition="width 1s linear",app=
{apps:{Home:{page:0,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Playback:{page:0,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Queue:{active:"Current",tabs:{Current:{page:0,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0},LastPlayed:{page:0,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0},Jukebox:{page:0,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0}}},Browse:{active:"Database",tabs:{Filesystem:{page:0,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Playlists:{active:"All",
views:{All:{page:0,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0},Detail:{page:0,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0}}},Database:{active:"List",views:{List:{page:0,filter:"AlbumArtist",sort:"AlbumArtist",tag:"Album",search:"",scrollPos:0},Detail:{page:0,filter:"-",sort:"-",tag:"-",search:"",scrollPos:0}}}}},Search:{page:0,filter:"any",sort:"-",tag:"-",search:"",scrollPos:0}},current:{app:"Home",tab:void 0,view:void 0,page:0,filter:"",search:"",sort:"",tag:"",scrollPos:0},last:{app:void 0,
tab:void 0,view:void 0,filter:"",search:"",sort:"",tag:"",scrollPos:0}},domCache={};domCache.navbarBtns=document.getElementById("navbar-main").getElementsByTagName("div");domCache.navbarBtnsLen=domCache.navbarBtns.length;domCache.counter=document.getElementById("counter");domCache.volumePrct=document.getElementById("volumePrct");domCache.volumeControl=document.getElementById("volumeControl");domCache.volumeMenu=document.getElementById("volumeMenu");domCache.btnsPlay=document.getElementsByClassName("btnPlay");
domCache.btnsPlayLen=domCache.btnsPlay.length;domCache.btnPrev=document.getElementById("btnPrev");domCache.btnNext=document.getElementById("btnNext");domCache.progress=document.getElementById("footerProgress");domCache.progressBar=document.getElementById("footerProgressBar");domCache.progressPos=document.getElementById("footerProgressPos");domCache.volumeBar=document.getElementById("volumeBar");domCache.outputs=document.getElementById("outputs");domCache.btnA2HS=document.getElementById("nav-add2homescreen");
domCache.currentCover=document.getElementById("currentCover");domCache.currentTitle=document.getElementById("currentTitle");domCache.footerTitle=document.getElementById("footerTitle");domCache.footerArtist=document.getElementById("footerArtist");domCache.footerAlbum=document.getElementById("footerAlbum");domCache.footerCover=document.getElementById("footerCover");domCache.btnVoteUp=document.getElementById("btnVoteUp");domCache.btnVoteDown=document.getElementById("btnVoteDown");
domCache.badgeQueueItems=document.getElementById("badgeQueueItems");domCache.searchstr=document.getElementById("searchstr");domCache.searchCrumb=document.getElementById("searchCrumb");domCache.body=document.getElementsByTagName("body")[0];domCache.footer=document.getElementsByTagName("footer")[0];domCache.header=document.getElementById("header");domCache.mainMenu=document.getElementById("mainMenu");
var modalConnection=new BSN.Modal(document.getElementById("modalConnection")),modalSettings=new BSN.Modal(document.getElementById("modalSettings")),modalAbout=new BSN.Modal(document.getElementById("modalAbout")),modalSaveQueue=new BSN.Modal(document.getElementById("modalSaveQueue")),modalAddToQueue=new BSN.Modal(document.getElementById("modalAddToQueue")),modalSongDetails=new BSN.Modal(document.getElementById("modalSongDetails")),modalAddToPlaylist=new BSN.Modal(document.getElementById("modalAddToPlaylist")),
modalRenamePlaylist=new BSN.Modal(document.getElementById("modalRenamePlaylist")),modalUpdateDB=new BSN.Modal(document.getElementById("modalUpdateDB")),modalSaveSmartPlaylist=new BSN.Modal(document.getElementById("modalSaveSmartPlaylist")),modalDeletePlaylist=new BSN.Modal(document.getElementById("modalDeletePlaylist")),modalSaveBookmark=new BSN.Modal(document.getElementById("modalSaveBookmark")),modalTimer=new BSN.Modal(document.getElementById("modalTimer")),modalMounts=new BSN.Modal(document.getElementById("modalMounts")),
modalExecScript=new BSN.Modal(document.getElementById("modalExecScript")),modalScripts=new BSN.Modal(document.getElementById("modalScripts")),modalPartitions=new BSN.Modal(document.getElementById("modalPartitions")),modalPartitionOutputs=new BSN.Modal(document.getElementById("modalPartitionOutputs")),modalTrigger=new BSN.Modal(document.getElementById("modalTrigger")),modalOutputAttributes=new BSN.Modal(document.getElementById("modalOutputAttributes")),modalPicture=new BSN.Modal(document.getElementById("modalPicture")),
modalEditHomeIcon=new BSN.Modal(document.getElementById("modalEditHomeIcon")),dropdownMainMenu=new BSN.Dropdown(document.getElementById("mainMenu")),dropdownVolumeMenu=new BSN.Dropdown(document.getElementById("volumeMenu")),dropdownBookmarks=new BSN.Dropdown(document.getElementById("BrowseFilesystemBookmark")),dropdownLocalPlayer=new BSN.Dropdown(document.getElementById("localPlaybackMenu")),dropdownPlay=new BSN.Dropdown(document.getElementById("btnPlayDropdown")),dropdownDatabaseSort=new BSN.Dropdown(document.getElementById("btnDatabaseSortDropdown")),
dropdownNeighbors=new BSN.Dropdown(document.getElementById("btnDropdownNeighbors")),collapseDBupdate=new BSN.Collapse(document.getElementById("navDBupdate")),collapseSettings=new BSN.Collapse(document.getElementById("navSettings")),collapseSyscmds=new BSN.Collapse(document.getElementById("navSyscmds")),collapseScripting=new BSN.Collapse(document.getElementById("navScripting")),collapseJukeboxMode=new BSN.Collapse(document.getElementById("labelJukeboxMode"));
function appPrepare(a){if(app.current.app!==app.last.app||app.current.tab!==app.last.tab||app.current.view!==app.last.view){for(var b=0;b<domCache.navbarBtnsLen;b++)domCache.navbarBtns[b].classList.remove("active");document.getElementById("cardHome").classList.add("hide");document.getElementById("cardPlayback").classList.add("hide");document.getElementById("cardQueue").classList.add("hide");document.getElementById("cardBrowse").classList.add("hide");document.getElementById("cardSearch").classList.add("hide");
document.getElementById("cardQueueCurrent").classList.add("hide");document.getElementById("cardQueueLastPlayed").classList.add("hide");document.getElementById("cardQueueJukebox").classList.add("hide");document.getElementById("cardBrowsePlaylists").classList.add("hide");document.getElementById("cardBrowseFilesystem").classList.add("hide");document.getElementById("cardBrowseDatabase").classList.add("hide");document.getElementById("card"+app.current.app).classList.remove("hide");document.getElementById("nav"+
app.current.app)&&document.getElementById("nav"+app.current.app).classList.add("active");void 0!==app.current.tab&&document.getElementById("card"+app.current.app+app.current.tab).classList.remove("hide");scrollToPosY(a)}(a=document.getElementById(app.current.app+(void 0===app.current.tab?"":app.current.tab)+(void 0===app.current.view?"":app.current.view)+"List"))&&a.classList.add("opacity05")}
function appGoto(a,b,c,d,f,g,h,k){var l=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;void 0!==app.apps[app.current.app].scrollPos?app.apps[app.current.app].scrollPos=l:void 0!==app.apps[app.current.app].tabs[app.current.tab].scrollPos?app.apps[app.current.app].tabs[app.current.tab].scrollPos=l:void 0!==app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos&&(app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos=
l);app.apps[a].tabs?(void 0===b&&(b=app.apps[a].active),app.apps[a].tabs[b].views?(void 0===c&&(c=app.apps[a].tabs[b].active),a="/"+encodeURIComponent(a)+"/"+encodeURIComponent(b)+"/"+encodeURIComponent(c)+"!"+encodeURIComponent(void 0===d?app.apps[a].tabs[b].views[c].page:d)+"/"+encodeURIComponent(void 0===f?app.apps[a].tabs[b].views[c].filter:f)+"/"+encodeURIComponent(void 0===g?app.apps[a].tabs[b].views[c].sort:g)+"/"+encodeURIComponent(void 0===h?app.apps[a].tabs[b].views[c].tag:h)+"/"+encodeURIComponent(void 0===
k?app.apps[a].tabs[b].views[c].search:k)):a="/"+encodeURIComponent(a)+"/"+encodeURIComponent(b)+"!"+encodeURIComponent(void 0===d?app.apps[a].tabs[b].page:d)+"/"+encodeURIComponent(void 0===f?app.apps[a].tabs[b].filter:f)+"/"+encodeURIComponent(void 0===g?app.apps[a].tabs[b].sort:g)+"/"+encodeURIComponent(void 0===h?app.apps[a].tabs[b].tag:h)+"/"+encodeURIComponent(void 0===k?app.apps[a].tabs[b].search:k)):a="/"+encodeURIComponent(a)+"!"+encodeURIComponent(void 0===d?app.apps[a].page:d)+"/"+encodeURIComponent(void 0===
f?app.apps[a].filter:f)+"/"+encodeURIComponent(void 0===g?app.apps[a].sort:g)+"/"+encodeURIComponent(void 0===h?app.apps[a].tag:h)+"/"+encodeURIComponent(void 0===k?app.apps[a].search:k);location.hash=a}
function appRoute(){if(!1===settingsParsed)appInitStart();else{var a=location.hash.match(/^#\/(\w+)\/?(\w+)?\/?(\w+)?!(\d+)\/([^/]+)\/([^/]+)\/([^/]+)\/(.*)$/);if(a){app.current.app=decodeURIComponent(a[1]);app.current.tab=void 0!==a[2]?decodeURIComponent(a[2]):void 0;app.current.view=void 0!==a[3]?decodeURIComponent(a[3]):void 0;app.current.page=decodeURIComponent(parseInt(a[4]));app.current.filter=decodeURIComponent(a[5]);app.current.sort=decodeURIComponent(a[6]);app.current.tag=decodeURIComponent(a[7]);
app.current.search=decodeURIComponent(a[8]);void 0!==app.apps[app.current.app].page?(app.apps[app.current.app].page=app.current.page,app.apps[app.current.app].filter=app.current.filter,app.apps[app.current.app].sort=app.current.sort,app.apps[app.current.app].tag=app.current.tag,app.apps[app.current.app].search=app.current.search,app.current.scrollPos=app.apps[app.current.app].scrollPos):void 0!==app.apps[app.current.app].tabs[app.current.tab].page?(app.apps[app.current.app].tabs[app.current.tab].page=
app.current.page,app.apps[app.current.app].tabs[app.current.tab].filter=app.current.filter,app.apps[app.current.app].tabs[app.current.tab].sort=app.current.sort,app.apps[app.current.app].tabs[app.current.tab].tag=app.current.tag,app.apps[app.current.app].tabs[app.current.tab].search=app.current.search,app.apps[app.current.app].active=app.current.tab,app.current.scrollPos=app.apps[app.current.app].tabs[app.current.tab].scrollPos):void 0!==app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].page&&
(app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].page=app.current.page,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].filter=app.current.filter,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].sort=app.current.sort,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].tag=app.current.tag,app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].search=app.current.search,app.apps[app.current.app].active=
app.current.tab,app.apps[app.current.app].tabs[app.current.tab].active=app.current.view,app.current.scrollPos=app.apps[app.current.app].tabs[app.current.tab].views[app.current.view].scrollPos);appPrepare(app.current.scrollPos);if("Home"===app.current.app)sendAPI("MYMPD_API_HOME_LIST",{},parseHome);else if("Playback"===app.current.app)sendAPI("MPD_API_PLAYER_CURRENT_SONG",{},songChange);else if("Queue"===app.current.app&&"Current"===app.current.tab)selectTag("searchqueuetags","searchqueuetagsdesc",
app.current.filter),getQueue();else if("Queue"===app.current.app&&"LastPlayed"===app.current.tab)sendAPI("MPD_API_QUEUE_LAST_PLAYED",{offset:app.current.page,cols:settings.colsQueueLastPlayed},parseLastPlayed);else if("Queue"===app.current.app&&"Jukebox"===app.current.tab)sendAPI("MPD_API_JUKEBOX_LIST",{offset:app.current.page,cols:settings.colsQueueJukebox},parseJukeboxList);else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view)sendAPI("MPD_API_PLAYLIST_LIST",
{offset:app.current.page,searchstr:app.current.search},parsePlaylists),a=document.getElementById("searchPlaylistsStr"),""===a.value&&""!==app.current.search&&(a.value=app.current.search);else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view)sendAPI("MPD_API_PLAYLIST_CONTENT_LIST",{offset:app.current.page,searchstr:app.current.search,uri:app.current.filter,cols:settings.colsBrowsePlaylistsDetail},parsePlaylists),a=document.getElementById("searchPlaylistsStr"),
""===a.value&&""!==app.current.search&&(a.value=app.current.search);else if("Browse"===app.current.app&&"Filesystem"===app.current.tab){sendAPI("MPD_API_DATABASE_FILESYSTEM_LIST",{offset:app.current.page,path:app.current.search?app.current.search:"/",searchstr:"-"!==app.current.filter?app.current.filter:"",cols:settings.colsBrowseFilesystem},parseFilesystem,!0);app.current.search?(document.getElementById("BrowseFilesystemAddAllSongs").removeAttribute("disabled"),document.getElementById("BrowseFilesystemAddAllSongsBtn").removeAttribute("disabled")):
(document.getElementById("BrowseFilesystemAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("BrowseFilesystemAddAllSongsBtn").setAttribute("disabled","disabled"));a='<li class="breadcrumb-item"><a data-uri="" class="text-body material-icons">home</a></li>';for(var b=app.current.search.split("/"),c=b.length,d="",f=0;f<c;f++){if(c-1===f){a+='<li class="breadcrumb-item active">'+e(b[f])+"</li>";break}d+=b[f];a+='<li class="breadcrumb-item"><a class="text-body" href="#" data-uri="'+
encodeURI(d)+'">'+e(b[f])+"</a></li>";d+="/"}document.getElementById("BrowseBreadcrumb").innerHTML=a;a=document.getElementById("searchFilesystemStr");""===a.value&&"-"!==app.current.filter&&(a.value=app.current.filter)}else if("Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view)if(document.getElementById("viewListDatabase").classList.remove("hide"),document.getElementById("viewDetailDatabase").classList.add("hide"),selectTag("searchDatabaseTags","searchDatabaseTagsDesc",
app.current.filter),selectTag("BrowseDatabaseByTagDropdown","btnBrowseDatabaseByTagDesc",app.current.tag),a=app.current.sort,b=!1,"-"===app.current.sort.charAt(0)?(b=!0,a=app.current.sort.substr(1),toggleBtnChk("databaseSortDesc",!0)):toggleBtnChk("databaseSortDesc",!1),selectTag("databaseSortTags",void 0,a),"Album"===app.current.tag){c=document.getElementById("searchDatabaseCrumb");d=document.getElementById("searchDatabaseStr");f="";for(var g=app.current.search.split(" AND "),h=0;h<g.length-1;h++){var k=
g[h].substring(1,g[h].length-1);f+='<button data-filter="'+encodeURI(k)+'" class="btn btn-light mr-2">'+e(k)+'<span class="badge badge-secondary">&times</span></button>'}c.innerHTML=f;""===d.value&&1<=g.length&&(f=g[g.length-1].substring(1,g[g.length-1].length-1),g=f.substring(f.indexOf("'")+1,f.length-1),d.value!==g&&(c.innerHTML+='<button data-filter="'+encodeURI(f)+'" class="btn btn-light mr-2">'+e(f)+'<span class="badge badge-secondary">&times;</span></button>'),document.getElementById("searchDatabaseMatch").value=
"contains");c.classList.remove("hide");document.getElementById("searchDatabaseMatch").classList.remove("hide");document.getElementById("btnDatabaseSortDropdown").removeAttribute("disabled");document.getElementById("btnDatabaseSearchDropdown").removeAttribute("disabled");sendAPI("MPD_API_DATABASE_GET_ALBUMS",{offset:app.current.page,searchstr:app.current.search,filter:app.current.filter,sort:a,sortdesc:b},parseDatabase)}else document.getElementById("searchDatabaseCrumb").classList.add("hide"),document.getElementById("searchDatabaseMatch").classList.add("hide"),
document.getElementById("btnDatabaseSortDropdown").setAttribute("disabled","disabled"),document.getElementById("btnDatabaseSearchDropdown").setAttribute("disabled","disabled"),document.getElementById("searchDatabaseStr").value=app.current.search,sendAPI("MPD_API_DATABASE_TAG_LIST",{offset:app.current.page,searchstr:app.current.search,filter:app.current.filter,sort:a,sortdesc:b,tag:app.current.tag},parseDatabase);else if("Browse"===app.current.app&&"Database"===app.current.tab&&"Detail"===app.current.view)document.getElementById("viewListDatabase").classList.add("hide"),
document.getElementById("viewDetailDatabase").classList.remove("hide"),"Album"===app.current.filter&&(a=settings.colsBrowseDatabaseDetail.slice(),!1===a.includes("Disc")&&a.push("Disc"),sendAPI("MPD_API_DATABASE_TAG_ALBUM_TITLE_LIST",{album:app.current.tag,searchstr:app.current.search,tag:app.current.sort,cols:a},parseAlbumDetails));else if("Search"===app.current.app){domCache.searchstr.focus();if(settings.featAdvsearch){a="";b=app.current.search.substring(1,app.current.search.length-1).split(" AND ");
for(c=0;c<b.length-1;c++)d=b[c].substring(1,b[c].length-1),a+='<button data-filter="'+encodeURI(d)+'" class="btn btn-light mr-2">'+e(d)+'<span class="badge badge-secondary">&times</span></button>';domCache.searchCrumb.innerHTML=a;""===domCache.searchstr.value&&1<=b.length&&(a=b[b.length-1].substring(1,b[b.length-1].length-1),b=a.substring(a.indexOf("'")+1,a.length-1),domCache.searchstr.value!==b&&(domCache.searchCrumb.innerHTML+='<button data-filter="'+encodeURI(a)+'" class="btn btn-light mr-2">'+
e(a)+'<span class="ml-2 badge badge-secondary">&times;</span></button>'),a=a.substring(a.indexOf(" ")+1),a=a.substring(0,a.indexOf(" ")),""===a&&(a="contains"),document.getElementById("searchMatch").value=a)}else""===domCache.searchstr.value&&""!==app.current.search&&(domCache.searchstr.value=app.current.search);app.last.app!==app.current.app&&""!==app.current.search&&(a=settings["cols"+app.current.app].length,a--,document.getElementById("SearchList").getElementsByTagName("tbody")[0].innerHTML='<tr><td><span class="material-icons">search</span></td><td colspan="'+
a+'">'+t("Searching...")+"</td></tr>");2<=domCache.searchstr.value.length||0<domCache.searchCrumb.children.length?settings.featAdvsearch?(a=app.current.sort,b=!1,"-"===a?(a=settings.tags.includes("Title")?"Title":"-",document.getElementById("SearchList").setAttribute("data-sort",a)):0===a.indexOf("-")&&(b=!0,a=a.substring(1)),sendAPI("MPD_API_DATABASE_SEARCH_ADV",{plist:"",offset:app.current.page,sort:a,sortdesc:b,expression:app.current.search,cols:settings.colsSearch,replace:!1},parseSearch)):sendAPI("MPD_API_DATABASE_SEARCH",
{plist:"",offset:app.current.page,filter:app.current.filter,searchstr:app.current.search,cols:settings.colsSearch,replace:!1},parseSearch):(document.getElementById("SearchList").getElementsByTagName("tbody")[0].innerHTML="",document.getElementById("searchAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("searchAddAllSongsBtn").setAttribute("disabled","disabled"),document.getElementById("SearchList").classList.remove("opacity05"),setPagination(0,0));selectTag("searchtags","searchtagsdesc",
app.current.filter)}else appGoto("Home");app.last.app=app.current.app;app.last.tab=app.current.tab;app.last.view=app.current.view}else appPrepare(0),!0===settings.featHome?appGoto("Home"):appGoto("Playback")}}
function showAppInitAlert(a){document.getElementById("splashScreenAlert").innerHTML='<p class="text-danger">'+t(a)+'</p><p><a id="appReloadBtn" class="btn btn-danger text-light clickable">'+t("Reload")+"</a></p>";document.getElementById("appReloadBtn").addEventListener("click",function(){clearAndReload()},!1)}function clearAndReload(){"serviceWorker"in navigator&&caches.keys().then(function(a){a.forEach(function(a){caches.delete(a)})});location.reload()}
function a2hsInit(){window.addEventListener("beforeinstallprompt",function(a){logDebug("Event: beforeinstallprompt");a.preventDefault();deferredA2HSprompt=a;domCache.btnA2HS.classList.remove("hide")});domCache.btnA2HS.addEventListener("click",function(){domCache.btnA2HS.classList.add("hide");deferredA2HSprompt.prompt();deferredA2HSprompt.userChoice.then(function(a){"accepted"===a.outcome?logDebug("User accepted the A2HS prompt"):logDebug("User dismissed the A2HS prompt");deferredA2HSprompt=null})});
window.addEventListener("appinstalled",function(){logInfo("myMPD installed as app");showNotification(t("myMPD installed as app"),"","","success")})}
function appInitStart(){window.addEventListener("hashchange",appRoute,!1);if(!0===isMobile)scale=localStorage.getItem("scale-ratio"),null===scale&&(scale="1.0"),setViewport(!1);else for(var a=document.getElementsByClassName("featMobile"),b=0;b<a.length;b++)a[b].classList.add("hide");subdir=window.location.pathname.replace("/index.html","").replace(/\/$/,"");a='<option value="default" data-phrase="Browser default"></option>';for(b=0;b<locales.length;b++)a+='<option value="'+e(locales[b].code)+'">'+
e(locales[b].desc)+" ("+e(locales[b].code)+")</option>";document.getElementById("selectLocale").innerHTML=a;i18nHtml(document.getElementById("splashScreenAlert"));a=document.getElementsByTagName("script")[0].src.replace(/^.*[/]/,"");"combined.js"!==a&&(settings.loglevel=4);"serviceWorker"in navigator&&"https:"===window.location.protocol&&"localhost"!==window.location.hostname&&"combined.js"===a&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(a){logInfo("ServiceWorker registration successful.");
a.update()},function(a){logError("ServiceWorker registration failed: "+a)})});appInited=!1;document.getElementById("splashScreen").classList.remove("hide");document.getElementsByTagName("body")[0].classList.add("overflow-hidden");document.getElementById("splashScreenAlert").innerText=t("Fetch myMPD settings");a2hsInit();getSettings(!0);appInitWait()}
function appInitWait(){setTimeout(function(){if("true"===settingsParsed&&!0===websocketConnected)document.getElementById("splashScreenAlert").innerText=t("Applying settings"),document.getElementById("splashScreen").classList.add("hide-fade"),setTimeout(function(){document.getElementById("splashScreen").classList.add("hide");document.getElementById("splashScreen").classList.remove("hide-fade");document.getElementsByTagName("body")[0].classList.remove("overflow-hidden")},500),appInit(),appInited=!0;
else{if("true"===settingsParsed)document.getElementById("splashScreenAlert").innerText=t("Connect to websocket"),webSocketConnect();else if("error"===settingsParsed)return;appInitWait()}},500)}
function appInit(){document.getElementById("btnChVolumeDown").addEventListener("click",function(a){a.stopPropagation()},!1);document.getElementById("btnChVolumeUp").addEventListener("click",function(a){a.stopPropagation()},!1);domCache.volumeBar.addEventListener("click",function(a){a.stopPropagation()},!1);domCache.volumeBar.addEventListener("change",function(){sendAPI("MPD_API_PLAYER_VOLUME_SET",{volume:domCache.volumeBar.value})},!1);domCache.progress.addEventListener("click",function(a){currentSong&&
0<=currentSong.currentSongId&&0<currentSong.totalTime&&(domCache.progressBar.style.transition="none",domCache.progressBar.style.width=a.clientX+"px",setTimeout(function(){domCache.progressBar.style.transition=progressBarTransition},10),sendAPI("MPD_API_PLAYER_SEEK",{songid:currentSong.currentSongId,seek:Math.ceil(currentSong.totalTime*a.clientX/a.target.offsetWidth)}))},!1);domCache.progress.addEventListener("mousemove",function(a){if(("pause"===playstate||"play"===playstate)&&0<currentSong.totalTime){domCache.progressPos.innerText=
beautifySongDuration(Math.ceil(currentSong.totalTime/a.target.offsetWidth*a.clientX));domCache.progressPos.style.display="block";var b=domCache.progressPos.offsetWidth/2;domCache.progressPos.style.left=(a.clientX<b?a.clientX:a.clientX<window.innerWidth-b?a.clientX-b:a.clientX-2*b)+"px"}},!1);domCache.progress.addEventListener("mouseout",function(){domCache.progressPos.style.display="none"},!1);for(var a=document.querySelectorAll(".subMenu"),b=a.length,c=0;c<b;c++)a[c].addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();a=this.getElementsByTagName("span")[0];a.innerText="keyboard_arrow_right"===a.innerText?"keyboard_arrow_down":"keyboard_arrow_right"},!1);document.getElementById("volumeMenu").parentNode.addEventListener("show.bs.dropdown",function(){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},parseOutputs)});document.getElementById("btnDropdownNeighbors").parentNode.addEventListener("show.bs.dropdown",function(){!0===settings.featNeighbors?sendAPI("MPD_API_MOUNT_NEIGHBOR_LIST",{},parseNeighbors,!0):
document.getElementById("dropdownNeighbors").children[0].innerHTML='<div class="list-group-item"><span class="material-icons">warning</span> '+t("Neighbors are disabled")+"</div>"});document.getElementById("dropdownNeighbors").children[0].addEventListener("click",function(a){a.preventDefault();"A"===a.target.nodeName&&(a=a.target.getAttribute("data-value").match(/^(\w+:\/\/)(.+)$/),document.getElementById("selectMountUrlhandler").value=a[1],document.getElementById("inputMountUrl").value=a[2])});document.getElementById("BrowseFilesystemBookmark").parentNode.addEventListener("show.bs.dropdown",
function(){sendAPI("MYMPD_API_BOOKMARK_LIST",{offset:0},parseBookmarks)});document.getElementById("playDropdown").parentNode.addEventListener("show.bs.dropdown",function(){showPlayDropdown()});document.getElementById("playDropdown").addEventListener("click",function(a){a.preventDefault();a.stopPropagation()});a=document.querySelectorAll(".dropdown-toggle");for(b=0;b<a.length;b++)a[b].parentNode.addEventListener("show.bs.dropdown",function(){alignDropdown(this)});document.getElementById("modalTimer").addEventListener("shown.bs.modal",
function(){showListTimer()});document.getElementById("modalMounts").addEventListener("shown.bs.modal",function(){showListMounts()});document.getElementById("modalScripts").addEventListener("shown.bs.modal",function(){showListScripts()});document.getElementById("modalTrigger").addEventListener("shown.bs.modal",function(){showListTrigger()});document.getElementById("modalPartitions").addEventListener("shown.bs.modal",function(){showListPartitions()});document.getElementById("modalPartitionOutputs").addEventListener("shown.bs.modal",
function(){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{partition:"default"},parsePartitionOutputsList,!1)});document.getElementById("modalAbout").addEventListener("shown.bs.modal",function(){sendAPI("MPD_API_DATABASE_STATS",{},parseStats);getServerinfo();var a="",b;for(b in keymap)if(void 0===keymap[b].req||!0===settings[keymap[b].req])a+='<tr><td><div class="key'+(keymap[b].key&&1<keymap[b].key.length?" material-icons material-icons-small":"")+'">'+(void 0!==keymap[b].key?keymap[b].key:b)+"</div></td><td>"+
t(keymap[b].desc)+"</td></tr>";document.getElementById("tbodyShortcuts").innerHTML=a});document.getElementById("modalAddToPlaylist").addEventListener("shown.bs.modal",function(){document.getElementById("addStreamFrm").classList.contains("hide")?document.getElementById("addToPlaylistPlaylist").focus():(document.getElementById("streamUrl").focus(),document.getElementById("streamUrl").value="")});document.getElementById("inputTimerVolume").addEventListener("change",function(){document.getElementById("textTimerVolume").innerHTML=
this.value+"&nbsp;%"},!1);document.getElementById("selectTimerAction").addEventListener("change",function(){selectTimerActionChange()},!1);document.getElementById("selectTriggerScript").addEventListener("change",function(){selectTriggerActionChange()},!1);a="";for(b=0;24>b;b++)a+='<option value="'+b+'">'+zeroPad(b,2)+"</option>";document.getElementById("selectTimerHour").innerHTML=a;a="";for(b=0;60>b;b+=5)a+='<option value="'+b+'">'+zeroPad(b,2)+"</option>";document.getElementById("selectTimerMinute").innerHTML=
a;document.getElementById("inputHighlightColor").addEventListener("change",function(){document.getElementById("highlightColorPreview").style.backgroundColor=this.value},!1);document.getElementById("inputBgColor").addEventListener("change",function(){document.getElementById("bgColorPreview").style.backgroundColor=this.value},!1);document.getElementById("modalAddToQueue").addEventListener("shown.bs.modal",function(){document.getElementById("inputAddToQueueQuantity").classList.remove("is-invalid");document.getElementById("warnJukeboxPlaylist2").classList.add("hide");
!0===settings.featPlaylists&&sendAPI("MPD_API_PLAYLIST_LIST_ALL",{searchstr:""},function(a){getAllPlaylists(a,"selectAddToQueuePlaylist")})});document.getElementById("modalUpdateDB").addEventListener("hidden.bs.modal",function(){document.getElementById("updateDBprogress").classList.remove("updateDBprogressAnimate")});document.getElementById("modalSaveQueue").addEventListener("shown.bs.modal",function(){var a=document.getElementById("saveQueueName");a.focus();a.value="";a.classList.remove("is-invalid")});
document.getElementById("modalSettings").addEventListener("shown.bs.modal",function(){getSettings();document.getElementById("inputCrossfade").classList.remove("is-invalid");document.getElementById("inputMixrampdb").classList.remove("is-invalid");document.getElementById("inputMixrampdelay").classList.remove("is-invalid");document.getElementById("inputScaleRatio").classList.remove("is-invalid")});document.getElementById("modalConnection").addEventListener("shown.bs.modal",function(){getSettings();document.getElementById("inputMpdHost").classList.remove("is-invalid");
document.getElementById("inputMpdPort").classList.remove("is-invalid");document.getElementById("inputMpdPass").classList.remove("is-invalid")});document.getElementById("btnJukeboxModeGroup").addEventListener("mouseup",function(){setTimeout(function(){var a=document.getElementById("btnJukeboxModeGroup").getElementsByClassName("active")[0].getAttribute("data-value");"0"===a?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled",
"disabled")):"2"===a?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").value="Database"):"1"===a&&(document.getElementById("inputJukeboxQueueLength").removeAttribute("disabled"),document.getElementById("selectJukeboxPlaylist").removeAttribute("disabled"));"0"!==a&&toggleBtnChk("btnConsume",!0);checkConsume()},100)});document.getElementById("btnConsume").addEventListener("mouseup",
function(){setTimeout(function(){checkConsume()},100)});document.getElementById("btnStickers").addEventListener("mouseup",function(){setTimeout(function(){document.getElementById("btnStickers").classList.contains("active")?(document.getElementById("warnPlaybackStatistics").classList.add("hide"),document.getElementById("inputJukeboxLastPlayed").removeAttribute("disabled")):(document.getElementById("warnPlaybackStatistics").classList.remove("hide"),document.getElementById("inputJukeboxLastPlayed").setAttribute("disabled",
"disabled"))},100)});document.getElementById("selectAddToQueueMode").addEventListener("change",function(){var a=this.options[this.selectedIndex].value;"2"===a?(document.getElementById("inputAddToQueueQuantity").setAttribute("disabled","disabled"),document.getElementById("inputAddToQueueQuantity").value="1",document.getElementById("selectAddToQueuePlaylist").setAttribute("disabled","disabled"),document.getElementById("selectAddToQueuePlaylist").value="Database"):"1"===a&&(document.getElementById("inputAddToQueueQuantity").removeAttribute("disabled"),
document.getElementById("selectAddToQueuePlaylist").removeAttribute("disabled"))});document.getElementById("addToPlaylistPlaylist").addEventListener("change",function(){"new"===this.options[this.selectedIndex].value?(document.getElementById("addToPlaylistNewPlaylistDiv").classList.remove("hide"),document.getElementById("addToPlaylistNewPlaylist").focus()):document.getElementById("addToPlaylistNewPlaylistDiv").classList.add("hide")},!1);document.getElementById("selectMusicDirectory").addEventListener("change",
function(){"auto"===this.options[this.selectedIndex].value?(document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):"none"===this.options[this.selectedIndex].value?(document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):(document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").removeAttribute("readonly"))},
!1);document.getElementById("syscmds").addEventListener("click",function(a){"A"===a.target.nodeName&&parseCmd(a,a.target.getAttribute("data-href"))},!1);document.getElementById("scripts").addEventListener("click",function(a){"A"===a.target.nodeName&&execScript(a.target.getAttribute("data-href"))},!1);a=document.querySelectorAll("[data-href]");b=a.length;for(c=0;c<b;c++){!1===a[c].classList.contains("notclickable")&&a[c].classList.add("clickable");var d=a[c].parentNode.classList.contains("noInitChilds")?
!0:!1;!1===d&&(d=a[c].parentNode.parentNode.classList.contains("noInitChilds")?!0:!1);!0!==d&&a[c].addEventListener("click",function(a){parseCmd(a,this.getAttribute("data-href"))},!1)}document.getElementById("HomeCards").addEventListener("click",function(a){if(a.target.classList.contains("card-body")){var b=a.target.parentNode.getAttribute("data-href");null!==b&&parseCmd(a,b)}else if(a.target.classList.contains("card-footer")){b=document.getElementById("HomeCards").getElementsByClassName("selected");
for(var c=0;c<b.length;c++)b[c].classList.remove("selected");a.target.parentNode.classList.add("selected");showMenu(a.target,a);a.stopPropagation()}},!1);document.getElementById("HomeCards").addEventListener("keydown",function(a){navigateGrid(a.target,a.key)},!1);dragAndDropHome();document.getElementById("selectHomeIconCmd").addEventListener("change",function(){showHomeIconCmdOptions()},!1);document.getElementById("inputHomeIconLigature").addEventListener("change",function(a){document.getElementById("homeIconPreview").innerText=
a.target.value;""!==a.target.value&&(document.getElementById("selectHomeIconImage").value="",document.getElementById("homeIconPreview").style.backgroundImage="")},!1);document.getElementById("inputHomeIconBgcolor").addEventListener("change",function(a){document.getElementById("homeIconPreview").style.backgroundColor=a.target.value},!1);document.getElementById("selectHomeIconImage").addEventListener("change",function(a){a=getSelectValue(a.target);document.getElementById("homeIconPreview").style.backgroundImage=
'url("'+subdir+"/browse/pics/"+a+'")';""!==a?(document.getElementById("divHomeIconLigature").classList.add("hide"),document.getElementById("homeIconPreview").innerHTML=""):(document.getElementById("divHomeIconLigature").classList.remove("hide"),document.getElementById("homeIconPreview").innerText=document.getElementById("inputHomeIconLigature").value)},!1);a=document.getElementsByClassName("pages");b=a.length;for(c=0;c<b;c++)a[c].addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&
gotoPage(a.target.getAttribute("data-page"))},!1);document.getElementById("cardPlaybackTags").addEventListener("click",function(a){"P"===a.target.nodeName&&gotoBrowse()},!1);document.getElementById("BrowseBreadcrumb").addEventListener("click",function(a){"A"===a.target.nodeName&&(a.preventDefault(),appGoto("Browse","Filesystem",void 0,"0",app.current.filter,app.current.sort,"-",decodeURI(a.target.getAttribute("data-uri"))))},!1);document.getElementById("tbodySongDetails").addEventListener("click",
function(a){if("A"===a.target.nodeName)if("calcFingerprint"===a.target.id){sendAPI("MPD_API_DATABASE_FINGERPRINT",{uri:decodeURI(a.target.getAttribute("data-uri"))},parseFingerprint);a.preventDefault();var b=a.target.parentNode,c=document.createElement("div");c.classList.add("spinner-border","spinner-border-sm");a.target.classList.add("hide");b.appendChild(c)}else null!==a.target.parentNode.getAttribute("data-tag")&&(modalSongDetails.hide(),a.preventDefault(),gotoBrowse());else"BUTTON"===a.target.nodeName&&
a.target.getAttribute("data-href")&&parseCmd(a,a.target.getAttribute("data-href"))},!1);document.getElementById("outputs").addEventListener("click",function(a){"BUTTON"===a.target.nodeName?(a.stopPropagation(),a.preventDefault(),sendAPI("MPD_API_PLAYER_TOGGLE_OUTPUT",{output:a.target.getAttribute("data-output-id"),state:a.target.classList.contains("active")?0:1}),toggleBtn(a.target.id)):"A"===a.target.nodeName&&(a.preventDefault(),showListOutputAttributes(decodeURI(a.target.parentNode.getAttribute("data-output-name"))))},
!1);document.getElementById("listTimerList").addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"TD"===a.target.nodeName?a.target.parentNode.classList.contains("not-clickable")||showEditTimer(a.target.parentNode.getAttribute("data-id")):"A"===a.target.nodeName?deleteTimer(a.target.parentNode.parentNode.getAttribute("data-id")):"BUTTON"===a.target.nodeName&&toggleTimer(a.target,a.target.parentNode.parentNode.getAttribute("data-id"))},!1);document.getElementById("listMountsList").addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();if("TD"===a.target.nodeName){if(""===a.target.parentNode.getAttribute("data-point"))return!1;showEditMount(decodeURI(a.target.parentNode.getAttribute("data-url")),decodeURI(a.target.parentNode.getAttribute("data-point")))}else if("A"===a.target.nodeName){var b=a.target.getAttribute("data-action"),c=decodeURI(a.target.parentNode.parentNode.getAttribute("data-point"));"unmount"===b?unmountMount(c):"update"===b&&updateMount(a.target,c)}},!1);document.getElementById("listScriptsList").addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();if("TD"===a.target.nodeName){if(!1===settings.featScripteditor||""===a.target.parentNode.getAttribute("data-script"))return!1;showEditScript(decodeURI(a.target.parentNode.getAttribute("data-script")))}else if("A"===a.target.nodeName){var b=a.target.getAttribute("data-action"),c=decodeURI(a.target.parentNode.parentNode.getAttribute("data-script"));"delete"===b?deleteScript(c):"execute"===b?execScript(a.target.getAttribute("data-href")):"add2home"===
b&&addScriptToHome(c,a.target.getAttribute("data-href"))}},!1);document.getElementById("listTriggerList").addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if("TD"===a.target.nodeName){var b=decodeURI(a.target.parentNode.getAttribute("data-trigger-id"));showEditTrigger(b)}else"A"===a.target.nodeName&&(b=a.target.getAttribute("data-action"),a=decodeURI(a.target.parentNode.parentNode.getAttribute("data-trigger-id")),"delete"===b&&deleteTrigger(a))},!1);document.getElementById("listPartitionsList").addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();if("A"===a.target.nodeName){var b=a.target.getAttribute("data-action");a=decodeURI(a.target.parentNode.parentNode.getAttribute("data-partition"));"delete"===b?deletePartition(a):"switch"===b&&switchPartition(a)}},!1);document.getElementById("partitionOutputsList").addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"TD"===a.target.nodeName&&(a=decodeURI(a.target.parentNode.getAttribute("data-output")),moveOutput(a),modalPartitionOutputs.hide())},
!1);document.getElementById("QueueCurrentList").addEventListener("click",function(a){"TD"===a.target.nodeName?sendAPI("MPD_API_PLAYER_PLAY_TRACK",{track:a.target.parentNode.getAttribute("data-trackid")}):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("QueueLastPlayedList").addEventListener("click",function(a){"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("QueueJukeboxList").addEventListener("click",function(a){"A"===a.target.nodeName&&showMenu(a.target,
a)},!1);document.getElementById("BrowseFilesystemList").addEventListener("click",function(a){if("TD"===a.target.nodeName)switch(a.target.parentNode.getAttribute("data-type")){case "parentDir":case "dir":appGoto("Browse","Filesystem",void 0,"0",app.current.filter,app.current.sort,"-",decodeURI(a.target.parentNode.getAttribute("data-uri")));break;case "song":appendQueue("song",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name"));break;case "plist":appendQueue("plist",
decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name"))}else"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseFilesystemBookmarks").addEventListener("click",function(a){if("A"===a.target.nodeName){var b=a.target.parentNode.parentNode.getAttribute("data-id"),c=a.target.parentNode.parentNode.getAttribute("data-type"),d=decodeURI(a.target.parentNode.parentNode.getAttribute("data-uri")),g=a.target.parentNode.parentNode.firstChild.innerText,
f=a.target.getAttribute("data-href");"delete"===f?(sendAPI("MYMPD_API_BOOKMARK_RM",{id:b},function(){sendAPI("MYMPD_API_BOOKMARK_LIST",{offset:0},parseBookmarks)}),a.preventDefault(),a.stopPropagation()):"edit"===f?showBookmarkSave(b,g,d,c):"goto"===f&&appGoto("Browse","Filesystem",void 0,"0","-","-","-",d)}},!1);document.getElementById("BrowsePlaylistsAllList").addEventListener("click",function(a){"TD"===a.target.nodeName?appendQueue("plist",decodeURI(a.target.parentNode.getAttribute("data-uri")),
a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowsePlaylistsDetailList").addEventListener("click",function(a){"TD"===a.target.nodeName?appendQueue("plist",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("SearchList").addEventListener("click",function(a){"TD"===a.target.nodeName?appendQueue("song",
decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseDatabaseCards").addEventListener("click",function(a){"Album"===app.current.tag?a.target.classList.contains("card-body")?appGoto("Browse","Database","Detail","0","Album","AlbumArtist",decodeURI(a.target.parentNode.getAttribute("data-album")),decodeURI(a.target.parentNode.getAttribute("data-albumartist"))):a.target.classList.contains("card-footer")&&
showMenu(a.target,a):(app.current.search="",document.getElementById("searchDatabaseStr").value="",appGoto(app.current.app,app.current.card,void 0,"0","Album","AlbumArtist","Album","("+app.current.tag+" == '"+decodeURI(a.target.parentNode.getAttribute("data-tag"))+"')"))},!1);document.getElementById("BrowseDatabaseCards").addEventListener("keydown",function(a){navigateGrid(a.target,a.key)},!1);document.getElementById("BrowseDatabaseDetailList").addEventListener("click",function(a){"TD"===a.target.nodeName?
appendQueue("song",decodeURI(a.target.parentNode.getAttribute("data-uri")),a.target.parentNode.getAttribute("data-name")):"A"===a.target.nodeName&&showMenu(a.target,a)},!1);document.getElementById("BrowseFilesystemAddAllSongsDropdown").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&("Add all to queue"===a.target.getAttribute("data-phrase")?addAllFromBrowseFilesystem():"Add all to playlist"===a.target.getAttribute("data-phrase")&&showAddToPlaylist(app.current.search,""))},!1);document.getElementById("searchAddAllSongsDropdown").addEventListener("click",
function(a){"BUTTON"===a.target.nodeName&&("Add all to queue"===a.target.getAttribute("data-phrase")?addAllFromSearchPlist("queue",null,!1):"Add all to playlist"===a.target.getAttribute("data-phrase")?showAddToPlaylist("SEARCH",""):"Save as smart playlist"===a.target.getAttribute("data-phrase")&&saveSearchAsSmartPlaylist())},!1);document.getElementById("searchtags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&(app.current.filter=a.target.getAttribute("data-tag"),doSearch(domCache.searchstr.value))},
!1);document.getElementById("searchDatabaseTags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&(app.current.filter=a.target.getAttribute("data-tag"),appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,app.current.tag,app.current.search))},!1);document.getElementById("databaseSortDesc").addEventListener("click",function(a){toggleBtnChk(this);a.stopPropagation();a.preventDefault();"-"===app.current.sort.charAt(0)?app.current.sort=app.current.sort.substr(1):
app.current.sort="-"+app.current.sort;appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,app.current.tag,app.current.search)},!1);document.getElementById("databaseSortTags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&(a.preventDefault(),a.stopPropagation(),app.current.sort=a.target.getAttribute("data-tag"),appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,app.current.tag,app.current.search))},
!1);document.getElementById("BrowseDatabaseByTagDropdown").addEventListener("click",function(a){navBrowseHandler(a)},!1);document.getElementById("BrowseNavPlaylistsDropdown").addEventListener("click",function(a){navBrowseHandler(a)},!1);document.getElementById("BrowseNavFilesystemDropdown").addEventListener("click",function(a){navBrowseHandler(a)},!1);document.getElementById("dropdownSortPlaylistTags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&(a.preventDefault(),playlistSort(a.target.getAttribute("data-tag")))},
!1);document.getElementById("searchqueuestr").addEventListener("keyup",function(a){"Escape"===a.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,"-",this.value)},!1);document.getElementById("searchqueuetags").addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&appGoto(app.current.app,app.current.tab,app.current.view,app.current.page,a.target.getAttribute("data-tag"),app.current.sort,"-",app.current.search)},!1);document.getElementById("searchFilesystemStr").addEventListener("keyup",
function(a){"Escape"===a.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0",""!==this.value?this.value:"-",app.current.sort,"-",app.current.search)},!1);document.getElementById("searchPlaylistsStr").addEventListener("keyup",function(a){"Escape"===a.key?this.blur():appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,"-",this.value)},!1);a=["PlaybackColsDropdown"];for(b=0;b<a.length;b++)document.getElementById(a[b]).addEventListener("click",
function(a){"BUTTON"===a.target.nodeName&&a.target.classList.contains("material-icons")&&(a.stopPropagation(),a.preventDefault(),toggleBtnChk(a.target))},!1);document.getElementById("search").addEventListener("submit",function(){return!1},!1);document.getElementById("searchqueue").addEventListener("submit",function(){return!1},!1);document.getElementById("searchdatabase").addEventListener("submit",function(){return!1},!1);document.getElementById("searchDatabaseStr").addEventListener("keyup",function(a){if("Escape"===
a.key)this.blur();else if("Enter"===a.key&&"Album"===app.current.tag)if(""!==this.value){a=document.getElementById("searchDatabaseMatch");var b=document.createElement("button");b.classList.add("btn","btn-light","mr-2");b.setAttribute("data-filter",encodeURI(app.current.filter+" "+a.options[a.selectedIndex].value+" '"+this.value+"'"));b.innerHTML=e(app.current.filter)+" "+e(a.options[a.selectedIndex].value)+" '"+e(this.value)+'\'<span class="ml-2 badge badge-secondary">&times;</span>';this.value="";
document.getElementById("searchDatabaseCrumb").appendChild(b)}else searchAlbumgrid(this.value);else"Album"===app.current.tag?searchAlbumgrid(this.value):appGoto(app.current.app,app.current.tab,app.current.view,"0",app.current.filter,app.current.sort,app.current.tag,this.value)},!1);document.getElementById("searchDatabaseCrumb").addEventListener("click",function(a){a.preventDefault();a.stopPropagation();if("SPAN"===a.target.nodeName)a.target.parentNode.remove(),searchAlbumgrid("");else if("BUTTON"===
a.target.nodeName){var b=decodeURI(a.target.getAttribute("data-filter"));document.getElementById("searchDatabaseStr").value=b.substring(b.indexOf("'")+1,b.length-1);var c=b.substring(b.indexOf(" ")+1);c=c.substring(0,c.indexOf(" "));document.getElementById("searchDatabaseMatch").value=c;b=b.substring(0,b.indexOf(" "));selectTag("searchDatabaseTags","searchDatabaseTagsDesc",b);a.target.remove();searchAlbumgrid(document.getElementById("searchDatabaseStr").value)}},!1);domCache.searchstr.addEventListener("keyup",
function(a){if("Escape"===a.key)this.blur();else if("Enter"===a.key&&settings.featAdvsearch)if(""!==this.value){a=document.getElementById("searchMatch");var b=document.createElement("button");b.classList.add("btn","btn-light","mr-2");b.setAttribute("data-filter",encodeURI(app.current.filter+" "+a.options[a.selectedIndex].value+" '"+this.value+"'"));b.innerHTML=e(app.current.filter)+" "+e(a.options[a.selectedIndex].value)+" '"+e(this.value)+'\'<span class="ml-2 badge badge-secondary">&times;</span>';
this.value="";domCache.searchCrumb.appendChild(b)}else doSearch(this.value);else doSearch(this.value)},!1);domCache.searchCrumb.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();if("SPAN"===a.target.nodeName)a.target.parentNode.remove(),doSearch("");else if("BUTTON"===a.target.nodeName){var b=decodeURI(a.target.getAttribute("data-filter"));domCache.searchstr.value=b.substring(b.indexOf("'")+1,b.length-1);var c=b.substring(0,b.indexOf(" "));selectTag("searchtags","searchtagsdesc",
c);b=b.substring(b.indexOf(" ")+1);b=b.substring(0,b.indexOf(" "));document.getElementById("searchMatch").value=b;a.target.remove();doSearch(domCache.searchstr.value)}},!1);document.getElementById("searchMatch").addEventListener("change",function(){doSearch(domCache.searchstr.value)},!1);document.getElementById("SearchList").getElementsByTagName("tr")[0].addEventListener("click",function(a){if(settings.featAdvsearch&&"TH"===a.target.nodeName&&""!==a.target.innerHTML){var b=a.target.getAttribute("data-col");
if("Duration"!==b){var c=app.current.sort,d=!0;if(c===b||c==="-"+b)0===c.indexOf("-")?(d=!0,b=c.substring(1)):d=!1;!1===d?(c="-"+b,d=!0):(d=!1,c=b);for(var f=document.getElementById("SearchList").getElementsByClassName("sort-dir"),g=0;g<f.length;g++)f[g].remove();app.current.sort=c;a.target.innerHTML=t(b)+'<span class="sort-dir material-icons pull-right">'+(!0===d?"arrow_drop_up":"arrow_drop_down")+"</span>";appGoto(app.current.app,app.current.tab,app.current.view,app.current.page,app.current.filter,
app.current.sort,"-",app.current.search)}}},!1);document.getElementById("inputScriptArgument").addEventListener("keyup",function(a){"Enter"===a.key&&(a.preventDefault(),a.stopPropagation(),addScriptArgument())},!1);document.getElementById("selectScriptArguments").addEventListener("click",function(a){"OPTION"===a.target.nodeName&&removeScriptArgument(a)},!1);document.getElementsByTagName("body")[0].addEventListener("click",function(){hideMenu()},!1);dragAndDropTable("QueueCurrentList");dragAndDropTable("BrowsePlaylistsDetailList");
dragAndDropTableHeader("QueueCurrent");dragAndDropTableHeader("QueueLastPlayed");dragAndDropTableHeader("QueueJukebox");dragAndDropTableHeader("Search");dragAndDropTableHeader("BrowseFilesystem");dragAndDropTableHeader("BrowsePlaylistsDetail");dragAndDropTableHeader("BrowseDatabaseDetail");window.addEventListener("focus",function(){sendAPI("MPD_API_PLAYER_STATE",{},parseState)},!1);document.addEventListener("keydown",function(a){if("INPUT"!==a.target.tagName&&"SELECT"!==a.target.tagName&&"TEXTAREA"!==
a.target.tagName&&!a.ctrlKey&&!a.altKey){var b=keymap[a.key];b&&"function"===typeof window[b.cmd]&&(void 0===keymap[a.key].req||!0===settings[keymap[a.key].req])&&parseCmd(a,b)}},!1);a=document.getElementsByTagName("table");for(b=0;b<a.length;b++)a[b].setAttribute("tabindex",0),a[b].addEventListener("keydown",function(a){navigateTable(this,a.key)},!1);var f="";Object.keys(themes).forEach(function(a){f+='<option value="'+e(a)+'">'+t(themes[a])+"</option>"});document.getElementById("selectTheme").innerHTML=
f;window.addEventListener("beforeunload",function(){webSocketClose()});document.getElementById("alertLocalPlayback").getElementsByTagName("a")[0].addEventListener("click",function(a){a.stopPropagation();a.preventDefault();clickCheckLocalPlayerState(a)},!1);document.getElementById("errorLocalPlayback").getElementsByTagName("a")[0].addEventListener("click",function(a){a.stopPropagation();a.preventDefault();clickCheckLocalPlayerState(a)},!1);document.getElementById("localPlayer").addEventListener("click",
function(a){a.stopPropagation()});document.getElementById("localPlayer").addEventListener("canplay",function(){logDebug("localPlayer event: canplay");document.getElementById("alertLocalPlayback").classList.add("hide");document.getElementById("errorLocalPlayback").classList.add("hide")});document.getElementById("localPlayer").addEventListener("error",function(){logError("localPlayer event: error");document.getElementById("errorLocalPlayback").classList.remove("hide")})}
window.onerror=function(a,b,c){logError("JavaScript error: "+a+" ("+b+": "+c+")");4<=settings.loglevel&&(!0===appInited?showNotification(t("JavaScript error"),a+" ("+b+": "+c+")","","danger"):showAppInitAlert(t("JavaScript error")+": "+a+" ("+b+": "+c+")"));return!0};appInitStart();
function setStateIcon(){!1===websocketConnected||!1===settings.mpdConnected?(domCache.mainMenu.classList.add("text-light"),domCache.mainMenu.classList.remove("connected")):(domCache.mainMenu.classList.add("connected"),domCache.mainMenu.classList.remove("text-light"))}function toggleAlert(a,b,c){a=document.getElementById(a);!1===b?(a.innerHTML="",a.classList.add("hide")):(a.innerHTML=c,a.classList.remove("hide"))}
function showNotification(a,b,c,d){if(!0===settings.notificationWeb){var f=new Notification(a,{icon:"assets/favicon.ico",body:b});setTimeout(f.close.bind(f),3E3)}if(!0===settings.notificationPage||"danger"===d||"warning"===d){alertTimeout&&clearTimeout(alertTimeout);document.getElementById("alertBox")?f=document.getElementById("alertBox"):(f=document.createElement("div"),f.setAttribute("id","alertBox"),f.classList.add("toast"));var g='<div class="toast-header">';g=("success"===d?g+'<span class="material-icons text-success mr-2">info</span>':
"warning"===d?g+'<span class="material-icons text-warning mr-2">warning</span>':g+'<span class="material-icons text-danger mr-2">error</span>')+('<strong class="mr-auto">'+e(a)+'</strong><button type="button" class="ml-2 mb-1 close">&times;</button></div>');if(""!==c||""!==b)g+='<div class="toast-body">'+(""===c?e(b):c)+"</div>";f.innerHTML=g+"</div>";document.getElementById("alertBox")||(document.getElementsByTagName("main")[0].append(f),requestAnimationFrame(function(){var a=document.getElementById("alertBox");
a&&a.classList.add("alertBoxActive")}));f.getElementsByTagName("button")[0].addEventListener("click",function(){hideNotification()},!1);alertTimeout=setTimeout(function(){hideNotification()},3E3)}setStateIcon();logMessage(a,b,c,d)}
function logMessage(a,b,c,d){"success"===d?d="Info":"warning"===d?d="Warning":"danger"===d&&(d="Error");var f=document.getElementById("logOverview"),g=!0,h=f.firstElementChild;h&&h.getAttribute("data-title")===a&&(g=!1);var k=document.createElement("div");k.classList.add("text-light");k.setAttribute("data-title",a);var l=1;!1===g&&(l+=parseInt(h.getAttribute("data-occurence")));k.setAttribute("data-occurence",l);k.innerHTML="<small>"+localeDate()+"&nbsp;&ndash;&nbsp;"+t(d)+(1<l?"&nbsp;("+l+")":"")+
"</small><p>"+e(a)+(""===c&&""===b?"":"<br/>"+(""===c?e(b):c))+"</p>";!0===g?f.insertBefore(k,f.firstElementChild):f.replaceChild(k,h);a=f.getElementsByTagName("div");10<a.length&&a[10].remove()}function clearLogOverview(){for(var a=document.getElementById("logOverview").getElementsByTagName("div"),b=a.length-1;0<=b;b--)a[b].remove();setStateIcon()}
function hideNotification(){alertTimeout&&clearTimeout(alertTimeout);document.getElementById("alertBox")&&(document.getElementById("alertBox").classList.remove("alertBoxActive"),setTimeout(function(){var a=document.getElementById("alertBox");a&&a.remove()},750))}function notificationsSupported(){return"Notification"in window}
function setElsState(a,b,c){a="tag"===c?document.getElementsByTagName(a):document.getElementsByClassName(a);c=a.length;for(var d=0;d<c;d++)a[d].classList.contains("close")||("disabled"===b?!1===a[d].classList.contains("alwaysEnabled")&&null===a[d].getAttribute("disabled")&&(a[d].setAttribute("disabled","disabled"),a[d].classList.add("disabled")):a[d].classList.contains("disabled")&&(a[d].removeAttribute("disabled"),a[d].classList.remove("disabled")))}
function toggleUI(){var a="disabled",b=document.getElementById("top-alerts");if(!0===websocketConnected&&!0===settings.mpdConnected)b.classList.add("hide"),a="enabled";else{var c=0;window.innerWidth<window.innerHeight&&(c=domCache.header.offsetHeight);b.style.paddingTop=c+"px";b.classList.remove("hide")}b="disabled"===a?!1:!0;b!==uiEnabled&&(logDebug("Setting ui state to "+a),setElsState("a",a,"tag"),setElsState("input",a,"tag"),setElsState("button",a,"tag"),setElsState("clickable",a,"class"),uiEnabled=
b);!0===settings.mpdConnected?toggleAlert("alertMpdState",!1,""):(toggleAlert("alertMpdState",!0,t("MPD disconnected")),logMessage(t("MPD disconnected"),"","","danger"));!0===websocketConnected?toggleAlert("alertMympdState",!1,""):(toggleAlert("alertMympdState",!0,t("Websocket is disconnected")),logMessage(t("Websocket is disconnected"),"","","danger"));setStateIcon()}function moveOutput(a){sendAPI("MPD_API_PARTITION_OUTPUT_MOVE",{name:a})}
function parsePartitionOutputsList(a){for(var b=document.getElementById("outputs").getElementsByTagName("button"),c=[],d=0;d<b.length;d++)c.push(parseInt(b[d].getAttribute("data-output-id")));b="";for(var f=d=0;f<a.result.data.length;f++)!1===c.includes(a.result.data[f].id)&&(b+='<tr data-output="'+encodeURI(a.result.data[f].name)+'"><td>'+e(a.result.data[f].name)+"</td></tr>",d++);0===d&&(b='<tr class="not-clickable"><td><span class="material-icons">error_outline</span>&nbsp;'+t("Empty list")+"</td></tr>");
document.getElementById("partitionOutputsList").innerHTML=b}function savePartition(){var a=!0,b=document.getElementById("inputPartitionName");validatePlnameEl(b)||(a=!1);!0===a&&sendAPI("MPD_API_PARTITION_NEW",{name:b.value},showListPartitions,!1)}
function showNewPartition(){document.getElementById("listPartitions").classList.remove("active");document.getElementById("newPartition").classList.add("active");document.getElementById("listPartitionsFooter").classList.add("hide");document.getElementById("newPartitionFooter").classList.remove("hide");var a=document.getElementById("inputPartitionName");a.classList.remove("is-invalid");a.value="";a.focus()}
function showListPartitions(){document.getElementById("listPartitions").classList.add("active");document.getElementById("newPartition").classList.remove("active");document.getElementById("listPartitionsFooter").classList.remove("hide");document.getElementById("newPartitionFooter").classList.add("hide");document.getElementById("errorPartition").classList.add("hide");sendAPI("MPD_API_PARTITION_LIST",{},parsePartitionList,!1)}
function deletePartition(a){sendAPI("MPD_API_PARTITION_RM",{name:a},function(a){if(a.error){var b=document.getElementById("errorPartition");b.innerText=t(a.error.message);b.classList.remove("hide")}sendAPI("MPD_API_PARTITION_LIST",{},parsePartitionList,!1)},!0)}
function switchPartition(a){sendAPI("MPD_API_PARTITION_SWITCH",{name:a},function(a){if(a.error){var b=document.getElementById("errorPartition");b.innerText=t(a.error.message);b.classList.remove("hide")}sendAPI("MPD_API_PARTITION_LIST",{},parsePartitionList,!1);sendAPI("MPD_API_PLAYER_STATE",{},parseState)},!0)}
function parsePartitionList(a){if(0<a.result.data.length){for(var b="",c=0;c<a.result.data.length;c++)b+='<tr data-partition="'+encodeURI(a.result.data[c].name)+'"><td class="'+(a.result.data[c].name===settings.partition?"font-weight-bold":"")+'">'+e(a.result.data[c].name)+(a.result.data[c].name===settings.partition?"&nbsp;("+t("current")+")":"")+'</td><td data-col="Action">'+("default"===a.result.data[c].name||a.result.data[c].name===settings.partition?"":'<a href="#" title="'+t("Delete")+'" data-action="delete" class="material-icons color-darkgrey">delete</a>')+
(a.result.data[c].name!==settings.partition?'<a href="#" title="'+t("Switch to")+'" data-action="switch" class="material-icons color-darkgrey">check_circle</a>':"")+"</td></tr>";document.getElementById("listPartitionsList").innerHTML=b}else document.getElementById("listPartitionsList").innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="2">'+t("Empty list")+"</td></tr>"}
function parsePlaylists(a){"All"===app.current.view?(document.getElementById("BrowsePlaylistsAllList").classList.remove("hide"),document.getElementById("BrowsePlaylistsDetailList").classList.add("hide"),document.getElementById("btnBrowsePlaylistsAll").parentNode.classList.add("hide"),document.getElementById("playlistContentBtns").classList.add("hide"),document.getElementById("smartPlaylistContentBtns").classList.add("hide"),document.getElementById("btnAddSmartpls").parentNode.classList.remove("hide"),
document.getElementById("BrowseNavPlaylists").parentNode.classList.remove("hide")):(-1<a.result.uri.indexOf(".")||!0===a.result.smartpls?(document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-ro","true"),document.getElementById("playlistContentBtns").classList.add("hide"),document.getElementById("smartPlaylistContentBtns").classList.remove("hide")):(document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-ro","false"),document.getElementById("playlistContentBtns").classList.remove("hide"),
document.getElementById("smartPlaylistContentBtns").classList.add("hide")),document.getElementById("BrowsePlaylistsDetailList").setAttribute("data-uri",a.result.uri),document.getElementById("BrowsePlaylistsDetailList").getElementsByTagName("caption")[0].innerHTML=(!0===a.result.smartpls?t("Smart playlist"):t("Playlist"))+": "+a.result.uri,document.getElementById("BrowsePlaylistsDetailList").classList.remove("hide"),document.getElementById("BrowsePlaylistsAllList").classList.add("hide"),document.getElementById("btnBrowsePlaylistsAll").parentNode.classList.remove("hide"),
document.getElementById("btnAddSmartpls").parentNode.classList.add("hide"),document.getElementById("BrowseNavPlaylists").parentNode.classList.add("hide"));var b=a.result.returnedEntities,c=document.getElementById(app.current.app+app.current.tab+app.current.view+"List"),d=c.getElementsByTagName("tbody")[0],f=d.getElementsByTagName("tr");c=document.activeElement.parentNode.parentNode===c?!0:!1;var g=0;if("All"===app.current.view)for(var h=0;h<b;h++){var k=encodeURI(a.result.data[h].uri),l=document.createElement("tr");
l.setAttribute("data-uri",k);l.setAttribute("data-type",a.result.data[h].Type);l.setAttribute("data-name",a.result.data[h].name);l.setAttribute("tabindex",0);l.innerHTML='<td data-col="Type"><span class="material-icons">'+("smartpls"===a.result.data[h].Type?"queue_music":"list")+"</span></td><td>"+e(a.result.data[h].name)+"</td><td>"+localeDate(a.result.data[h].last_modified)+'</td><td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";h<f.length?g=!0===
replaceTblRow(f[h],l)?h:g:d.append(l)}else if("Detail"===app.current.view)for(h=0;h<b;h++){l=encodeURI(a.result.data[h].uri);k=document.createElement("tr");!1===a.result.smartpls&&k.setAttribute("draggable","true");k.setAttribute("id","playlistTrackId"+a.result.data[h].Pos);k.setAttribute("data-type",a.result.data[h].Type);k.setAttribute("data-uri",l);k.setAttribute("data-name",a.result.data[h].Title);k.setAttribute("data-songpos",a.result.data[h].Pos);k.setAttribute("tabindex",0);a.result.data[h].Duration=
beautifySongDuration(a.result.data[h].Duration);l="";for(var m=0;m<settings.colsBrowsePlaylistsDetail.length;m++)l+='<td data-col="'+settings.colsBrowsePlaylistsDetail[m]+'">'+e(a.result.data[h][settings.colsBrowsePlaylistsDetail[m]])+"</td>";l+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";k.innerHTML=l;h<f.length?g=!0===replaceTblRow(f[h],k)?h:g:d.append(k)}for(g=f.length-1;g>=b;g--)f[g].remove();!0===c&&focusTable(0);setPagination(a.result.totalEntities,
a.result.returnedEntities);0===b&&(d.innerHTML="All"===app.current.view?'<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="3">'+t("No playlists found")+"</td></tr>":'<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="'+settings.colsBrowsePlaylistsDetail.length+'">'+t("Empty playlist")+"</td></tr>");document.getElementById(app.current.app+app.current.tab+app.current.view+"List").classList.remove("opacity05")}
function playlistDetails(a){document.getElementById("BrowsePlaylistsAllList").classList.add("opacity05");appGoto("Browse","Playlists","Detail","0",a,"-","-","")}function playlistClear(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_CLEAR",{uri:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function playlistShuffle(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_SHUFFLE",{uri:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}function playlistSort(a){var b=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPD_API_PLAYLIST_SORT",{uri:b,tag:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function getAllPlaylists(a,b,c){var d=a.result.returnedEntities,f="";if("addToPlaylistPlaylist"===b)f='<option value=""></option><option value="new">'+t("New playlist")+"</option>";else if("selectJukeboxPlaylist"===b||"selectAddToQueuePlaylist"===b||"selectTimerPlaylist"===b)f='<option value="Database">'+t("Database")+"</option>";for(var g=0;g<d;g++)if("addToPlaylistPlaylist"!==b||"smartpls"!==a.result.data[g].Type)f+='<option value="'+e(a.result.data[g].uri)+'"',null!==c&&a.result.data[g].uri===
c&&(f+=" selected"),f+=">"+e(a.result.data[g].uri)+"</option>";document.getElementById(b).innerHTML=f}function updateSmartPlaylists(a){sendAPI("MPDWORKER_API_SMARTPLS_UPDATE_ALL",{force:a})}function removeFromPlaylist(a,b){b--;sendAPI("MPD_API_PLAYLIST_RM_TRACK",{uri:a,track:b});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}
function toggleAddToPlaylistFrm(){var a=document.getElementById("toggleAddToPlaylistBtn");toggleBtn("toggleAddToPlaylistBtn");a.classList.contains("active")?(document.getElementById("addToPlaylistFrm").classList.remove("hide"),document.getElementById("addStreamFooter").classList.add("hide"),document.getElementById("addToPlaylistFooter").classList.remove("hide")):(document.getElementById("addToPlaylistFrm").classList.add("hide"),document.getElementById("addStreamFooter").classList.remove("hide"),document.getElementById("addToPlaylistFooter").classList.add("hide"))}
function parseSmartPlaylist(a){var b=document.getElementById("saveSmartPlaylistName");b.value=a.result.playlist;b.classList.remove("is-invalid");document.getElementById("saveSmartPlaylistType").value=t(a.result.type);document.getElementById("saveSmartPlaylistType").setAttribute("data-value",a.result.type);document.getElementById("saveSmartPlaylistSearch").classList.add("hide");document.getElementById("saveSmartPlaylistSticker").classList.add("hide");document.getElementById("saveSmartPlaylistNewest").classList.add("hide");
var c;settings.featTags&&(c='<option value="any">'+t("Any Tag")+"</option>");c+='<option value="filename">'+t("Filename")+"</option>";for(var d=0;d<settings.searchtags.length;d++)c+='<option value="'+settings.searchtags[d]+'">'+t(settings.searchtags[d])+"</option>";d=document.getElementById("selectSaveSmartPlaylistTag");d.innerHTML=c;"search"===a.result.type?(document.getElementById("saveSmartPlaylistSearch").classList.remove("hide"),document.getElementById("selectSaveSmartPlaylistTag").value=a.result.tag,
document.getElementById("inputSaveSmartPlaylistSearchstr").value=a.result.searchstr,!0===settings.featAdvsearch&&"expression"===a.result.tag?(d.parentNode.parentNode.classList.add("hide"),d.innerHTML='<option value="expression">expression</option>',d.value="expression"):document.getElementById("selectSaveSmartPlaylistTag").parentNode.parentNode.classList.remove("hide")):"sticker"===a.result.type?(document.getElementById("saveSmartPlaylistSticker").classList.remove("hide"),document.getElementById("selectSaveSmartPlaylistSticker").value=
a.result.sticker,document.getElementById("inputSaveSmartPlaylistStickerMaxentries").value=a.result.maxentries,document.getElementById("inputSaveSmartPlaylistStickerMinvalue").value=a.result.minvalue):"newest"===a.result.type&&(document.getElementById("saveSmartPlaylistNewest").classList.remove("hide"),a=a.result.timerange/24/60/60,document.getElementById("inputSaveSmartPlaylistNewestTimerange").value=a);modalSaveSmartPlaylist.show();b.focus()}
function saveSmartPlaylist(){var a=document.getElementById("saveSmartPlaylistName").value,b=document.getElementById("saveSmartPlaylistType").getAttribute("data-value"),c=document.getElementById("saveSmartPlaylistSort");c=c.options[c.selectedIndex].value;if(!0===validatePlname(a)){if("search"===b){var d=document.getElementById("selectSaveSmartPlaylistTag");d=d.options[d.selectedIndex].value;var f=document.getElementById("inputSaveSmartPlaylistSearchstr").value;sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,
playlist:a,tag:d,searchstr:f,sort:c})}else if("sticker"===b){d=document.getElementById("selectSaveSmartPlaylistSticker");d=d.options[d.selectedIndex].value;f=document.getElementById("inputSaveSmartPlaylistStickerMaxentries");if(!validateInt(f))return;var g=document.getElementById("inputSaveSmartPlaylistStickerMinvalue");if(!validateInt(g))return;sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,sticker:d,maxentries:parseInt(f.value),minvalue:parseInt(g.value),sort:c})}else if("newest"===b){d=document.getElementById("inputSaveSmartPlaylistNewestTimerange");
if(!validateInt(d))return;d=86400*parseInt(d.value);sendAPI("MPD_API_SMARTPLS_SAVE",{type:b,playlist:a,timerange:d,sort:c})}else{document.getElementById("saveSmartPlaylistType").classList.add("is-invalid");return}modalSaveSmartPlaylist.hide();showNotification(t("Saved smart playlist %{name}",{name:a}),"","","success")}else document.getElementById("saveSmartPlaylistName").classList.add("is-invalid")}
function addSmartpls(a){var b={jsonrpc:"2.0",id:0,result:{method:"MPD_API_SMARTPLS_GET"}};"mostPlayed"===a?(b.result.playlist=settings.smartplsPrefix+(""!==settings.smartplsPrefix?"-":"")+"mostPlayed",b.result.type="sticker",b.result.sticker="playCount",b.result.maxentries=200,b.result.minvalue=10):"newest"===a?(b.result.playlist=settings.smartplsPrefix+(""!==settings.smartplsPrefix?"-":"")+"newestSongs",b.result.type="newest",b.result.timerange=1209600):"bestRated"===a&&(b.result.playlist=settings.smartplsPrefix+
(""!==settings.smartplsPrefix?"-":"")+"bestRated",b.result.type="sticker",b.result.sticker="like",b.result.maxentries=200,b.result.minvalue=2);parseSmartPlaylist(b)}function deletePlaylists(){var a=document.getElementById("selectDeletePlaylists"),b=document.getElementById("btnDeletePlaylists");btnWaiting(b,!0);sendAPI("MPD_API_PLAYLIST_RM_ALL",{type:a.options[a.selectedIndex].value},function(){btnWaiting(b,!1)})}
function showAddToPlaylistCurrentSong(){var a=document.getElementById("currentTitle").getAttribute("data-uri");""!==a&&showAddToPlaylist(a,"")}
function showAddToPlaylist(a,b){document.getElementById("addToPlaylistUri").value=a;document.getElementById("addToPlaylistSearch").value=b;document.getElementById("addToPlaylistPlaylist").innerHTML="";document.getElementById("addToPlaylistNewPlaylist").value="";document.getElementById("addToPlaylistNewPlaylistDiv").classList.add("hide");document.getElementById("addToPlaylistNewPlaylist").classList.remove("is-invalid");toggleBtn("toggleAddToPlaylistBtn",0);b=document.getElementById("streamUrl");b.focus();
b.value="";b.classList.remove("is-invalid");"stream"!==a?(document.getElementById("addStreamFooter").classList.add("hide"),document.getElementById("addStreamFrm").classList.add("hide"),document.getElementById("addToPlaylistFooter").classList.remove("hide"),document.getElementById("addToPlaylistFrm").classList.remove("hide"),document.getElementById("addToPlaylistCaption").innerText=t("Add to playlist")):(document.getElementById("addStreamFooter").classList.remove("hide"),document.getElementById("addStreamFrm").classList.remove("hide"),
document.getElementById("addToPlaylistFooter").classList.add("hide"),document.getElementById("addToPlaylistFrm").classList.add("hide"),document.getElementById("addToPlaylistCaption").innerText=t("Add stream"));modalAddToPlaylist.show();settings.featPlaylists&&sendAPI("MPD_API_PLAYLIST_LIST_ALL",{searchstr:""},function(a){getAllPlaylists(a,"addToPlaylistPlaylist")})}
function addToPlaylist(){var a=decodeURI(document.getElementById("addToPlaylistUri").value);if("stream"===a&&(a=document.getElementById("streamUrl").value,""===a||-1===a.indexOf("http"))){document.getElementById("streamUrl").classList.add("is-invalid");return}var b=document.getElementById("addToPlaylistPlaylist");b=b.options[b.selectedIndex].value;if("new"===b&&(b=document.getElementById("addToPlaylistNewPlaylist").value,!0!==validatePlname(b))){document.getElementById("addToPlaylistNewPlaylist").classList.add("is-invalid");
return}""!==b?("SEARCH"===a&&addAllFromSearchPlist(b,null,!1),"ALBUM"===a?(a=document.getElementById("addToPlaylistSearch").value,addAllFromSearchPlist(b,a,!1)):"DATABASE"===a?addAllFromBrowseDatabasePlist(b):sendAPI("MPD_API_PLAYLIST_ADD_TRACK",{uri:a,plist:b}),modalAddToPlaylist.hide()):document.getElementById("addToPlaylistPlaylist").classList.add("is-invalid")}
function showRenamePlaylist(a){document.getElementById("renamePlaylistTo").classList.remove("is-invalid");modalRenamePlaylist.show();document.getElementById("renamePlaylistFrom").value=a;document.getElementById("renamePlaylistTo").value=""}
function renamePlaylist(){var a=document.getElementById("renamePlaylistFrom").value,b=document.getElementById("renamePlaylistTo").value;b!==a&&!0===validatePlname(b)?(sendAPI("MPD_API_PLAYLIST_RENAME",{from:a,to:b}),modalRenamePlaylist.hide()):document.getElementById("renamePlaylistTo").classList.add("is-invalid")}function showSmartPlaylist(a){sendAPI("MPD_API_SMARTPLS_GET",{playlist:a},parseSmartPlaylist)}function updateSmartPlaylist(a){sendAPI("MPDWORKER_API_SMARTPLS_UPDATE",{playlist:a})}
function updateSmartPlaylistClick(){var a=document.getElementById("BrowsePlaylistsDetailList").getAttribute("data-uri");sendAPI("MPDWORKER_API_SMARTPLS_UPDATE",{playlist:a});document.getElementById("BrowsePlaylistsDetailList").classList.add("opacity05")}function showDelPlaylist(a){document.getElementById("deletePlaylist").value=a;modalDeletePlaylist.show()}
function delPlaylist(){var a=document.getElementById("deletePlaylist").value;sendAPI("MPD_API_PLAYLIST_RM",{uri:a});modalDeletePlaylist.hide()}function playlistMoveTrack(a,b){sendAPI("MPD_API_PLAYLIST_MOVE_TRACK",{plist:app.current.search,from:a,to:b})}function addSelectedItemToPlaylist(){var a=document.activeElement;a&&"BrowsePlaylistsAllList"!==a.parentNode.parentNode.id&&showAddToPlaylist(a.getAttribute("data-uri"),"")}
function b64EncodeUnicode(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,c){return String.fromCharCode("0x"+c)}))}function b64DecodeUnicode(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function addMenuItem(a,b){return'<a class="dropdown-item" href="#" data-href=\''+b64EncodeUnicode(JSON.stringify(a))+"'>"+b+"</a>"}
function hideMenu(){var a=document.querySelector("[data-popover]");a&&((new BSN.Popover(a,{})).hide(),a.removeAttribute("data-popover"),a.parentNode.parentNode.classList.contains("selected")?focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode):"Browse"===app.current.app&&"Database"===app.current.tab?focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode):"Home"===app.current.app&&focusTable(void 0,a.parentNode.parentNode.parentNode.parentNode))}
function showMenu(a,b){b.preventDefault();b.stopPropagation();hideMenu();"TH"===a.parentNode.nodeName?showMenuTh(a):showMenuTd(a)}
function showMenuTh(a){var b=app.current.app+(void 0!==app.current.tab?app.current.tab:"")+(void 0!==app.current.view?app.current.view:"");var c='<form class="p-2" id="colChecklist'+b+'">'+setColsChecklist(b);c+='<button class="btn btn-success btn-block btn-sm mt-2">'+t("Apply")+"</button>";new BSN.Popover(a,{trigger:"click",delay:0,dismissible:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-content" id="'+b+'ColsDropdown">'+(c+"</form>")+"</div></div>",
content:" "});c=a.Popover;null===a.getAttribute("data-init")&&(a.setAttribute("data-init","true"),a.addEventListener("shown.bs.popover",function(a){a.target.setAttribute("data-popover","true");document.getElementById("colChecklist"+b).addEventListener("click",function(a){"BUTTON"===a.target.nodeName&&a.target.classList.contains("material-icons")?(toggleBtnChk(a.target),a.preventDefault(),a.stopPropagation()):"BUTTON"===a.target.nodeName&&(a.preventDefault(),saveCols(b))},!1)},!1));c.show()}
function showMenuTd(a){var b=a.getAttribute("data-type"),c=decodeURI(a.getAttribute("data-uri")),d=decodeURI(a.getAttribute("data-name")),f=0;if(null===b||""===c)b=a.parentNode.getAttribute("data-type"),c=decodeURI(a.parentNode.getAttribute("data-uri")),d=a.parentNode.getAttribute("data-name");if(null===b||""===c)b=a.parentNode.parentNode.getAttribute("data-type"),c=decodeURI(a.parentNode.parentNode.getAttribute("data-uri")),d=a.parentNode.parentNode.getAttribute("data-name");lastState&&(f=lastState.nextSongPos);
var g="";if("Browse"===app.current.app&&"Filesystem"===app.current.tab||"Search"===app.current.app||"Browse"===app.current.app&&"Database"===app.current.tab)g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+("song"===b?addMenuItem({cmd:"appendAfterQueue",options:[b,c,f,d]},t("Add after current playing song")):"")+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+("plist"!==b&&"smartpls"!==b&&settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,
""]},t("Add to playlist")):"")+("song"===b?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"")+("plist"===b||"smartpls"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):"")+("plist"!==b&&"smartpls"!==b||!0!==settings.featHome?"":addMenuItem({cmd:"addPlistToHome",options:[c,d]},t("Add to homescreen")))+("dir"===b&&settings.featBookmarks?addMenuItem({cmd:"showBookmarkSave",options:[-1,d,c,b]},t("Add bookmark")):""),"Filesystem"===app.current.tab&&(g+=("dir"===b?
addMenuItem({cmd:"updateDB",options:[dirname(c),!0]},t("Update directory")):"")+("dir"===b?addMenuItem({cmd:"rescanDB",options:[dirname(c),!0]},t("Rescan directory")):"")),"Search"===app.current.app&&(c=dirname(c),g+='<div class="dropdown-divider"></div><a class="dropdown-item" id="advancedMenuLink" data-toggle="collapse" href="#advancedMenu"><span class="material-icons material-icons-small-left">keyboard_arrow_right</span>Album actions</a><div class="collapse" id="advancedMenu">'+addMenuItem({cmd:"appendQueue",
options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"appendAfterQueue",options:[b,c,f,d]},t("Add after current playing song"))+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+(settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,""]},t("Add to playlist")):"")+"</div>");else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"All"===app.current.view)g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",
options:[b,c,d]},t("Replace queue"))+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):addMenuItem({cmd:"playlistDetails",options:[c]},t("Edit playlist")))+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"showSmartPlaylist",options:[c]},t("Edit smart playlist")):"")+(!0===settings.smartpls&&"smartpls"===b?addMenuItem({cmd:"updateSmartPlaylist",options:[c]},t("Update smart playlist")):"")+addMenuItem({cmd:"showRenamePlaylist",options:[c]},
t("Rename playlist"))+addMenuItem({cmd:"showDelPlaylist",options:[c]},t("Delete playlist"))+(!0===settings.featHome?addMenuItem({cmd:"addPlistToHome",options:[c,d]},t("Add to homescreen")):"");else if("Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view)f=document.getElementById("BrowsePlaylistsDetailList"),g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+("false"===f.getAttribute("data-ro")?
addMenuItem({cmd:"removeFromPlaylist",options:[f.getAttribute("data-uri"),a.parentNode.parentNode.getAttribute("data-songpos")]},t("Remove")):"")+(settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,""]},t("Add to playlist")):"")+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"");else if("Queue"===app.current.app&&"Current"===app.current.tab)g+=addMenuItem({cmd:"delQueueSong",options:["single",a.parentNode.parentNode.getAttribute("data-trackid")]},
t("Remove"))+addMenuItem({cmd:"delQueueSong",options:["range",0,a.parentNode.parentNode.getAttribute("data-songpos")]},t("Remove all upwards"))+addMenuItem({cmd:"delQueueSong",options:["range",parseInt(a.parentNode.parentNode.getAttribute("data-songpos"))-1,-1]},t("Remove all downwards"))+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"");else if("Queue"===app.current.app&&"LastPlayed"===app.current.tab)g+=addMenuItem({cmd:"appendQueue",options:[b,c,d]},t("Append to queue"))+
addMenuItem({cmd:"replaceQueue",options:[b,c,d]},t("Replace queue"))+(settings.featPlaylists?addMenuItem({cmd:"showAddToPlaylist",options:[c,""]},t("Add to playlist")):"")+(-1===c.indexOf("http")?addMenuItem({cmd:"songDetails",options:[c]},t("Song details")):"");else if("Queue"===app.current.app&&"Jukebox"===app.current.tab)g+=addMenuItem({cmd:"songDetails",options:[c]},t("Song details"))+addMenuItem({cmd:"delQueueJukeboxSong",options:[a.parentNode.parentNode.getAttribute("data-pos")]},t("Remove"));
else if("Home"===app.current.app){f=parseInt(a.parentNode.getAttribute("data-pos"));var h=JSON.parse(a.parentNode.getAttribute("data-href")),k="";"replaceQueue"===h.cmd&&"plist"===h.options[0]?(b="plist",c=h.options[1],k=t("Add and play playlist"),d=t("Playlist")):"appGoto"===h.cmd?(b="view",k=t("Goto view"),d=t("View")):"execScriptFromOptions"===h.cmd&&(b="script",k=t("Execute script"),d=t("Script"));g+='<h6 class="dropdown-header">'+d+"</h6>"+addMenuItem({cmd:"executeHomeIcon",options:[f]},k)+("plist"===
b?addMenuItem({cmd:"playlistDetails",options:[c]},t("View playlist")):"")+addMenuItem({cmd:"editHomeIcon",options:[f]},t("Edit home icon"))+addMenuItem({cmd:"duplicateHomeIcon",options:[f]},t("Duplicate home icon"))+addMenuItem({cmd:"deleteHomeIcon",options:[f]},t("Delete home icon"))}new BSN.Popover(a,{trigger:"click",delay:0,dismissible:!0,template:'<div class="popover" role="tooltip"><div class="arrow"></div><div class="popover-content">'+g+"</div></div>",content:" "});b=a.Popover;null===a.getAttribute("data-init")&&
(a.setAttribute("data-init","true"),a.addEventListener("shown.bs.popover",function(a){a.target.setAttribute("data-popover","true");document.getElementsByClassName("popover-content")[0].addEventListener("click",function(b){b.preventDefault();b.stopPropagation();"A"===b.target.nodeName&&(b=b.target.getAttribute("data-href"))&&(b=JSON.parse(b64DecodeUnicode(b)),parseCmd(a,b),hideMenu())},!1);document.getElementsByClassName("popover-content")[0].addEventListener("keydown",function(a){a.preventDefault();
a.stopPropagation();if("ArrowDown"===a.key||"ArrowUp"===a.key){var b=this.getElementsByTagName("a");b=Array.prototype.slice.call(b);var c=b.indexOf(document.activeElement);do if(c="ArrowUp"===a.key?1<c?c-1:0:"ArrowDown"===a.key?c<b.length-1?c+1:c:c,0===c||c===b.length-1)break;while(!b[c].offsetHeight);b[c]&&b[c].focus()}else"Enter"===a.key?a.target.click():"Escape"===a.key&&hideMenu()},!1);var b=document.getElementById("advancedMenuLink");b&&(b.addEventListener("click",function(){var a=this.getElementsByTagName("span")[0];
a.innerText="keyboard_arrow_right"===a.innerText?"keyboard_arrow_down":"keyboard_arrow_right"},!1),new BSN.Collapse(b));document.getElementsByClassName("popover-content")[0].firstChild.focus()},!1));b.show()}
function parseUpdateQueue(a){if(1===a.result.state){for(var b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText="play_arrow";playstate="stop";domCache.progressBar.style.transition="none";domCache.progressBar.style.width="0px";setTimeout(function(){domCache.progressBar.style.transition=progressBarTransition},10)}else if(2===a.result.state){for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText=!0===settings.footerStop?"stop":"pause";playstate="play"}else{for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].innerText=
"play_arrow";playstate="pause"}if(0===a.result.queueLength)for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].setAttribute("disabled","disabled");else for(b=0;b<domCache.btnsPlayLen;b++)domCache.btnsPlay[b].removeAttribute("disabled");mediaSessionSetState();mediaSessionSetPositionState(a.result.totalTime,a.result.elapsedTime);domCache.badgeQueueItems.innerText=a.result.queueLength;-1===a.result.nextSongPos&&!1===settings.jukeboxMode?domCache.btnNext.setAttribute("disabled","disabled"):domCache.btnNext.removeAttribute("disabled");
0>=a.result.songPos?domCache.btnPrev.setAttribute("disabled","disabled"):domCache.btnPrev.removeAttribute("disabled")}function getQueue(){2<=app.current.search.length?sendAPI("MPD_API_QUEUE_SEARCH",{filter:app.current.filter,offset:app.current.page,searchstr:app.current.search,cols:settings.colsQueueCurrent},parseQueue,!1):sendAPI("MPD_API_QUEUE_LIST",{offset:app.current.page,cols:settings.colsQueueCurrent},parseQueue,!1)}
function parseQueue(a){if(a.result.offset<app.current.page)gotoPage(a.result.offset);else{a.result.totalEntities>settings.maxElementsPerPage?document.getElementById("btnQueueGotoPlayingSong").parentNode.classList.remove("hide"):document.getElementById("btnQueueGotoPlayingSong").parentNode.classList.add("hide");var b=a.result.returnedEntities,c=document.getElementById("QueueCurrentList"),d=document.activeElement.parentNode.parentNode===c?!0:!1,f=0;c.setAttribute("data-version",a.result.queueVersion);
c=c.getElementsByTagName("tbody")[0];for(var g=c.getElementsByTagName("tr"),h=0;h<b;h++){a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration);a.result.data[h].Pos++;var k=document.createElement("tr");k.setAttribute("draggable","true");k.setAttribute("data-trackid",a.result.data[h].id);k.setAttribute("id","queueTrackId"+a.result.data[h].id);k.setAttribute("data-songpos",a.result.data[h].Pos);k.setAttribute("data-duration",a.result.data[h].Duration);k.setAttribute("data-uri",a.result.data[h].uri);
k.setAttribute("tabindex",0);for(var l="",m=0;m<settings.colsQueueCurrent.length;m++)l+='<td data-col="'+settings.colsQueueCurrent[m]+'">'+e(a.result.data[h][settings.colsQueueCurrent[m]])+"</td>";l+='<td data-col="Action"><a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a></td>";k.innerHTML=l;h<g.length?f=!0===replaceTblRow(g[h],k)?h:f:c.append(k)}for(h=g.length-1;h>=b;h--)g[h].remove();g=settings.colsQueueCurrent.length;g--;"MPD_API_QUEUE_SEARCH"===a.result.method&&0===b?c.innerHTML=
'<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("No results, please refine your search")+"</td></tr>":"MPD_API_QUEUE_ADD_TRACK"===a.result.method&&0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("Empty queue")+"</td></tr>");!0===d&&focusTable(f);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueCurrentList").classList.remove("opacity05")}}
function parseLastPlayed(a){var b=a.result.returnedEntities,c=document.getElementById("QueueLastPlayedList"),d=document.activeElement.parentNode.parentNode===c?!0:!1,f=0;c=c.getElementsByTagName("tbody")[0];for(var g=c.getElementsByTagName("tr"),h=0;h<b;h++){a.result.data[h].Duration=beautifySongDuration(a.result.data[h].Duration);a.result.data[h].LastPlayed=localeDate(a.result.data[h].LastPlayed);var k=document.createElement("tr");k.setAttribute("data-uri",a.result.data[h].uri);k.setAttribute("data-name",
a.result.data[h].Title);k.setAttribute("data-type","song");k.setAttribute("tabindex",0);for(var l="",m=0;m<settings.colsQueueLastPlayed.length;m++)l+='<td data-col="'+settings.colsQueueLastPlayed[m]+'">'+e(a.result.data[h][settings.colsQueueLastPlayed[m]])+"</td>";l+='<td data-col="Action">';""!==a.result.data[h].uri&&(l+='<a href="#" class="material-icons color-darkgrey">'+ligatureMore+"</a>");l+="</td>";k.innerHTML=l;h<g.length?f=!0===replaceTblRow(g[h],k)?h:f:c.append(k)}for(h=g.length-1;h>=b;h--)g[h].remove();
g=settings.colsQueueLastPlayed.length;g--;0===b&&(c.innerHTML='<tr><td><span class="material-icons">error_outline</span></td><td colspan="'+g+'">'+t("Empty list")+"</td></tr>");!0===d&&focusTable(f);setPagination(a.result.totalEntities,a.result.returnedEntities);document.getElementById("QueueLastPlayedList").classList.remove("opacity05")}
function queueSelectedItem(a){var b=document.activeElement;b&&"QueueCurrentList"!==b.parentNode.parentNode.id&&(!0===a?appendQueue(b.getAttribute("data-type"),b.getAttribute("data-uri"),b.getAttribute("data-name")):replaceQueue(b.getAttribute("data-type"),b.getAttribute("data-uri"),b.getAttribute("data-name")))}function dequeueSelectedItem(){var a=document.activeElement;a&&"QueueCurrentList"===a.parentNode.parentNode.id&&delQueueSong("single",a.getAttribute("data-trackid"))}
function appendQueue(a,b,c){switch(a){case "song":case "dir":sendAPI("MPD_API_QUEUE_ADD_TRACK",{uri:b});showNotification(t("%{name} added to queue",{name:c}),"","","success");break;case "plist":sendAPI("MPD_API_QUEUE_ADD_PLAYLIST",{plist:b}),showNotification(t("%{name} added to queue",{name:c}),"","","success")}}
function appendAfterQueue(a,b,c,d){switch(a){case "song":sendAPI("MPD_API_QUEUE_ADD_TRACK_AFTER",{uri:b,to:c}),c++,showNotification(t("%{name} added to queue position %{to}",{name:d,to:c}),"","","success")}}
function replaceQueue(a,b,c){switch(a){case "song":case "dir":sendAPI("MPD_API_QUEUE_REPLACE_TRACK",{uri:b});showNotification(t("Queue replaced with %{name}",{name:c}),"","","success");break;case "plist":sendAPI("MPD_API_QUEUE_REPLACE_PLAYLIST",{plist:b}),showNotification(t("Queue replaced with %{name}",{name:c}),"","","success")}}
function addToQueue(){var a=!0,b=document.getElementById("inputAddToQueueQuantity");validateInt(b)||(a=!1);b=document.getElementById("selectAddToQueueMode");b=b.options[b.selectedIndex].value;var c=document.getElementById("selectAddToQueuePlaylist");c=c.options[c.selectedIndex].value;"1"===b&&!1===settings.featSearchwindow&&"Database"===c&&(document.getElementById("warnJukeboxPlaylist2").classList.remove("hide"),a=!1);!0===a&&(sendAPI("MPD_API_QUEUE_ADD_RANDOM",{mode:b,playlist:c,quantity:document.getElementById("inputAddToQueueQuantity").value}),
modalAddToQueue.hide())}function saveQueue(){var a=document.getElementById("saveQueueName").value;!0===validatePlname(a)?(sendAPI("MPD_API_QUEUE_SAVE",{plist:a}),modalSaveQueue.hide()):document.getElementById("saveQueueName").classList.add("is-invalid")}function delQueueSong(a,b,c){"range"===a?sendAPI("MPD_API_QUEUE_RM_RANGE",{start:b,end:c}):"single"===a&&sendAPI("MPD_API_QUEUE_RM_TRACK",{track:b})}
function gotoPlayingSong(){var a=lastState.songPos<settings.maxElementsPerPage?0:Math.floor(lastState.songPos/settings.maxElementsPerPage)*settings.maxElementsPerPage;console.log(a);gotoPage(a)}
function saveScript(){var a=!0,b=document.getElementById("inputScriptName");validatePlnameEl(b)||(a=!1);var c=document.getElementById("inputScriptOrder");validateInt(c)||(a=!1);if(!0===a){a=[];for(var d=document.getElementById("selectScriptArguments"),f=0;f<d.options.length;f++)a.push(d.options[f].text);sendAPI("MYMPD_API_SCRIPT_SAVE",{oldscript:document.getElementById("inputOldScriptName").value,script:b.value,order:parseInt(c.value),content:document.getElementById("textareaScriptContent").value,
arguments:a},showListScripts,!1)}}function addScriptArgument(){var a=document.getElementById("inputScriptArgument");if(validatePlnameEl(a)){var b=document.createElement("option");b.text=a.value;document.getElementById("selectScriptArguments").appendChild(b);a.value=""}}function removeScriptArgument(a){var b=document.getElementById("inputScriptArgument");b.value=a.target.text;a.target.remove();b.focus()}
function showEditScript(a){document.getElementById("listScripts").classList.remove("active");document.getElementById("editScript").classList.add("active");document.getElementById("listScriptsFooter").classList.add("hide");document.getElementById("editScriptFooter").classList.remove("hide");document.getElementById("inputScriptName").classList.remove("is-invalid");document.getElementById("inputScriptOrder").classList.remove("is-invalid");document.getElementById("inputScriptArgument").classList.remove("is-invalid");
""!==a?sendAPI("MYMPD_API_SCRIPT_GET",{script:a},parseEditScript,!1):(document.getElementById("inputOldScriptName").value="",document.getElementById("inputScriptName").value="",document.getElementById("inputScriptOrder").value="1",document.getElementById("inputScriptArgument").value="",document.getElementById("selectScriptArguments").innerText="",document.getElementById("textareaScriptContent").value="")}
function parseEditScript(a){document.getElementById("inputOldScriptName").value=a.result.script;document.getElementById("inputScriptName").value=a.result.script;document.getElementById("inputScriptOrder").value=a.result.metadata.order;document.getElementById("inputScriptArgument").value="";var b=document.getElementById("selectScriptArguments");b.innerText="";for(var c=0;c<a.result.metadata.arguments.length;c++){var d=document.createElement("option");d.innerText=a.result.metadata.arguments[c];b.appendChild(d)}document.getElementById("textareaScriptContent").value=
a.result.content}function showListScripts(){document.getElementById("listScripts").classList.add("active");document.getElementById("editScript").classList.remove("active");document.getElementById("listScriptsFooter").classList.remove("hide");document.getElementById("editScriptFooter").classList.add("hide");sendAPI("MYMPD_API_SCRIPT_LIST",{all:!0},parseScriptList)}function deleteScript(a){sendAPI("MYMPD_API_SCRIPT_DELETE",{script:a},function(){getScriptList(!0)},!1)}
function getScriptList(a){sendAPI("MYMPD_API_SCRIPT_LIST",{all:a},parseScriptList,!1)}
function parseScriptList(a){var b=document.createElement("optgroup");b.setAttribute("data-value","script");b.setAttribute("label",t("Script"));var c="",d="",f=a.result.data.length;if(0<f){a.result.data.sort(function(a,b){return a.metadata.order-b.metadata.order});for(var g=0,h=0;h<f;h++){var k="";if(0<a.result.data[h].metadata.arguments.length){for(k=0;k<a.result.data[h].metadata.arguments.length;k++)a.result.data[h].metadata.arguments[k]=e(a.result.data[h].metadata.arguments[k]);k='"'+a.result.data[h].metadata.arguments.join('","')+
'"'}0<a.result.data[h].metadata.order&&(0===g&&(c=4<f?"":'<div class="dropdown-divider"></div>'),g++,c+='<a class="dropdown-item text-light alwaysEnabled" href="#" data-href=\'{"script": "'+e(a.result.data[h].name)+'", "arguments": ['+k+"]}'>"+e(a.result.data[h].name)+"</a>");d+='<tr data-script="'+encodeURI(a.result.data[h].name)+'"><td>'+e(a.result.data[h].name)+'</td><td data-col="Action">'+(!0===settings.featScripteditor?'<a href="#" title="'+t("Delete")+'" data-action="delete" class="material-icons color-darkgrey">delete</a>':
"")+'<a href="#" title="'+t("Execute")+'" data-action="execute" class="material-icons color-darkgrey"  data-href=\'{"script": "'+e(a.result.data[h].name)+'", "arguments": ['+k+']}\'>play_arrow</a><a href="#" title="'+t("Add to homescreen")+'" data-action="add2home" class="material-icons color-darkgrey"  data-href=\'{"script": "'+e(a.result.data[h].name)+'", "arguments": ['+k+"]}'>add_to_home_screen</a></td></tr>";b.innerHTML+='<option data-arguments=\'{"arguments":['+k+"]}' value=\""+e(a.result.data[h].name)+
'">'+e(a.result.data[h].name)+"</option>"}document.getElementById("listScriptsList").innerHTML=d}else document.getElementById("listScriptsList").innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="2">'+t("Empty list")+"</td></tr>";document.getElementById("scripts").innerHTML=c;4<f?(document.getElementById("navScripting").classList.remove("hide"),document.getElementById("scripts").classList.add("collapse","menu-indent")):(document.getElementById("navScripting").classList.add("hide"),
document.getElementById("scripts").classList.remove("collapse","menu-indent"));document.getElementById("selectTriggerScript").innerHTML=b.innerHTML;(a=document.getElementById("selectTimerAction").querySelector('optgroup[data-value="script"]'))?a.replaceWith(b):document.getElementById("selectTimerAction").appendChild(b)}function execScriptFromOptions(a,b){b=void 0!==b?b.split(","):[];execScript(JSON.stringify({script:a,arguments:b}))}
function execScript(a){a=JSON.parse(a);if(0===a.arguments.length)sendAPI("MYMPD_API_SCRIPT_EXECUTE",{script:a.script,arguments:{}});else{for(var b="",c=0;c<a.arguments.length;c++)b+='<div class="form-group row"><label class="col-sm-4 col-form-label" for="inputScriptArg'+c+'">'+e(a.arguments[c])+'</label><div class="col-sm-8"><input name="'+e(a.arguments[c])+'" id="inputScriptArg'+c+'" type="text" class="form-control border-secondary" value=""></div></div>';document.getElementById("execScriptArguments").innerHTML=
b;document.getElementById("modalExecScriptScriptname").value=a.script;modalExecScript.show()}}function execScriptArgs(){for(var a=document.getElementById("modalExecScriptScriptname").value,b={},c=document.getElementById("execScriptArguments").getElementsByTagName("input"),d=0;d<c.length;d++)b[c[d].name]=c[d].value;sendAPI("MYMPD_API_SCRIPT_EXECUTE",{script:a,arguments:b});modalExecScript.hide()}
function doSearch(a){if(settings.featAdvsearch){for(var b="(",c=domCache.searchCrumb.children,d=0;d<c.length;d++)b+="("+decodeURI(c[d].getAttribute("data-filter"))+")",""!==a&&(b+=" AND ");""!==a?(c=document.getElementById("searchMatch"),b+="("+app.current.filter+" "+c.options[c.selectedIndex].value+" '"+a+"'))"):b+=")";2>=b.length&&(b="");appGoto("Search",void 0,void 0,"0",app.current.filter,app.current.sort,"-",b)}else appGoto("Search",void 0,void 0,"0",app.current.filter,app.current.sort,"-",a)}
function parseSearch(a){0<a.result.returnedEntities?(document.getElementById("searchAddAllSongs").removeAttribute("disabled"),document.getElementById("searchAddAllSongsBtn").removeAttribute("disabled")):(document.getElementById("searchAddAllSongs").setAttribute("disabled","disabled"),document.getElementById("searchAddAllSongsBtn").setAttribute("disabled","disabled"));parseFilesystem(a)}
function saveSearchAsSmartPlaylist(){parseSmartPlaylist({jsonrpc:"2.0",id:0,result:{method:"MPD_API_SMARTPLS_GET",playlist:"",type:"search",tag:!0===settings.featAdvsearch?"expression":app.current.filter,searchstr:app.current.search}})}
function addAllFromSearchPlist(a,b,c){null===b&&(b=app.current.search);settings.featAdvsearch?sendAPI("MPD_API_DATABASE_SEARCH_ADV",{plist:a,sort:"",sortdesc:!1,expression:b,offset:0,cols:settings.colsSearch,replace:c}):sendAPI("MPD_API_DATABASE_SEARCH",{plist:a,filter:app.current.filter,searchstr:b,offset:0,cols:settings.colsSearch,replace:c})}
function saveConnection(){var a=!0,b=document.getElementById("inputMpdHost"),c=document.getElementById("inputMpdPort"),d=document.getElementById("inputMpdPass"),f=document.getElementById("selectMusicDirectory");f=f.options[f.selectedIndex].value;"custom"===f&&(f=document.getElementById("inputMusicDirectory"),validatePath(f)||(a=!1),f=f.value);""===c.value&&(c.value="6600");0!==b.value.indexOf("/")&&(validateInt(c)||(a=!1),validateHost(b)||(a=!1));!0===a&&(sendAPI("MYMPD_API_CONNECTION_SAVE",{mpdHost:b.value,
mpdPort:c.value,mpdPass:d.value,musicDirectory:f},getSettings),modalConnection.hide())}function getSettings(a){!1===settingsLock&&(settingsLock=!0,sendAPI("MYMPD_API_SETTINGS_GET",{},getMpdSettings,a))}
function getMpdSettings(a){if(""!==a&&a.result)settingsNew=a.result,document.getElementById("splashScreenAlert").innerText=t("Fetch MPD settings"),sendAPI("MPD_API_SETTINGS_GET",{},joinSettings,!0);else return settingsParsed="error",!1===appInited&&showAppInitAlert(""===a?t("Can not parse settings"):t(a.error.message)),!1}
function joinSettings(a){if(""!==a&&a.result)for(var b in a.result)settingsNew[b]=a.result[b];else settingsParsed="error",!1===appInited&&showAppInitAlert(""===a?t("Can not parse settings"):t(a.error.message)),settingsNew.mpdConnected=!1;settings=Object.assign({},settingsNew);settingsLock=!1;parseSettings();toggleUI();!0===settings.mpdConnected&&sendAPI("MPD_API_URLHANDLERS",{},parseUrlhandlers,!1);btnWaiting(document.getElementById("btnApplySettings"),!1)}
function parseUrlhandlers(a){for(var b="",c=0;c<a.result.data.length;c++)switch(a.result.data[c]){case "http://":case "https://":case "nfs://":case "smb://":b+='<option value="'+a.result.data[c]+'">'+a.result.data[c]+"</option>"}document.getElementById("selectMountUrlhandler").innerHTML=b}
function checkConsume(){var a=document.getElementById("btnConsume").classList.contains("active")?!0:!1;0<getBtnGroupValue("btnJukeboxModeGroup")&&!1===a?document.getElementById("warnConsume").classList.remove("hide"):document.getElementById("warnConsume").classList.add("hide")}
function parseSettings(){locale="default"===settings.locale?navigator.language||navigator.userLanguage:settings.locale;!0===isMobile&&(document.getElementById("inputScaleRatio").value=scale);var a=settings.theme;"theme-autodetect"===settings.theme&&(a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-default");Object.keys(themes).forEach(function(b){b===a?domCache.body.classList.add(b):domCache.body.classList.remove(b)});document.getElementById("selectTheme").value=
settings.theme;!0===settings.mpdConnected&&parseMPDSettings();0!==settings.mpdHost.indexOf("/")?document.getElementById("mpdInfo_host").innerText=settings.mpdHost+":"+settings.mpdPort:document.getElementById("mpdInfo_host").innerText=settings.mpdHost;document.getElementById("inputMpdHost").value=settings.mpdHost;document.getElementById("inputMpdPort").value=settings.mpdPort;document.getElementById("inputMpdPass").value=settings.mpdPass;var b=document.getElementById("btnNotifyWeb");document.getElementById("warnNotifyWeb").classList.add("hide");
notificationsSupported()?("granted"!==Notification.permission&&(!0===settings.notificationWeb&&document.getElementById("warnNotifyWeb").classList.remove("hide"),settings.notificationWeb=!1),"denied"===Notification.permission&&document.getElementById("warnNotifyWeb").classList.remove("hide"),toggleBtnChk("btnNotifyWeb",settings.notificationWeb),b.removeAttribute("disabled")):(b.setAttribute("disabled","disabled"),toggleBtnChk("btnNotifyWeb",!1));toggleBtnChk("btnNotifyPage",settings.notificationPage);
toggleBtnChk("btnMediaSession",settings.mediaSession);toggleBtnChkCollapse("btnFeatLocalplayer","collapseLocalplayer",settings.featLocalplayer);toggleBtnChk("btnFeatTimer",settings.featTimer);toggleBtnChk("btnBookmarks",settings.featBookmarks);toggleBtnChk("btnFeatLyrics",settings.featLyrics);""===settings.streamUrl?(document.getElementById("selectStreamMode").value="port",document.getElementById("inputStreamUrl").value=settings.streamPort):(document.getElementById("selectStreamMode").value="url",
document.getElementById("inputStreamUrl").value=settings.streamUrl);toggleBtnChkCollapse("btnCoverimage","collapseAlbumart",settings.coverimage);document.getElementById("inputBookletName").value=settings.bookletName;document.getElementById("selectLocale").value=settings.locale;document.getElementById("inputCoverimageName").value=settings.coverimageName;document.getElementById("inputCoverimageSize").value=settings.coverimageSize;document.getElementById("inputCoverimageSizeSmall").value=settings.coverimageSizeSmall;
document.documentElement.style.setProperty("--mympd-coverimagesize",settings.coverimageSize+"px");document.documentElement.style.setProperty("--mympd-coverimagesizesmall",settings.coverimageSizeSmall+"px");document.documentElement.style.setProperty("--mympd-highlightcolor",settings.highlightColor);document.getElementById("inputHighlightColor").value=settings.highlightColor;document.getElementById("inputBgColor").value=settings.bgColor;document.getElementsByTagName("body")[0].style.backgroundColor=
settings.bgColor;document.getElementById("highlightColorPreview").style.backgroundColor=settings.highlightColor;document.getElementById("bgColorPreview").style.backgroundColor=settings.bgColor;toggleBtnChkCollapse("btnBgCover","collapseBackground",settings.bgCover);document.getElementById("inputBgCssFilter").value=settings.bgCssFilter;b=document.querySelectorAll(".albumartbg");for(var c=0;c<b.length;c++)b[c].style.filter=settings.bgCssFilter;toggleBtnChkCollapse("btnLoveEnable","collapseLove",settings.love);
document.getElementById("inputLoveChannel").value=settings.loveChannel;document.getElementById("inputLoveMessage").value=settings.loveMessage;document.getElementById("inputMaxElementsPerPage").value=settings.maxElementsPerPage;toggleBtnChk("btnStickers",settings.stickers);document.getElementById("inputLastPlayedCount").value=settings.lastPlayedCount;toggleBtnChkCollapse("btnSmartpls","collapseSmartpls",settings.smartpls);b="featLocalplayer featSyscmds featMixramp featCacert featBookmarks featRegex featTimer featLyrics featScripting featScripteditor featHome".split(" ");
for(c=0;c<b.length;c++)for(var d=document.getElementsByClassName(b[c]),f=d.length,g=!0===settings[b[c]]?"":"none",h=0;h<f;h++)d[h].style.display=g;b=document.getElementsByClassName("warnReadonly");for(c=0;c<b.length;c++)!1===settings.readonly?b[c].classList.add("hide"):b[c].classList.remove("hide");!0===settings.readonly?(document.getElementById("btnBookmarks").setAttribute("disabled","disabled"),document.getElementsByClassName("groupClearCovercache")[0].classList.add("hide")):(document.getElementById("btnBookmarks").removeAttribute("disabled"),
document.getElementsByClassName("groupClearCovercache")[0].classList.remove("hide"));b='<optgroup data-value="player" label="'+t("Playback")+'"><option value="startplay">'+t("Start playback")+'</option><option value="stopplay">'+t("Stop playback")+"</option></optgroup>";if(!0===settings.featSyscmds){c="";d=settings.syscmdList.length;if(0<d)for(b+='<optgroup data-value="syscmd" label="'+t("System command")+'">',c=4<d?"":'<div class="dropdown-divider"></div>',f=0;f<d;f++)"HR"===settings.syscmdList[f]?
c+='<div class="dropdown-divider"></div>':(c+='<a class="dropdown-item text-light alwaysEnabled" href="#" data-href=\'{"cmd": "execSyscmd", "options": ["'+e(settings.syscmdList[f])+"\"]}'>"+e(settings.syscmdList[f])+"</a>",b+='<option value="'+e(settings.syscmdList[f])+'">'+e(settings.syscmdList[f])+"</option>");document.getElementById("syscmds").innerHTML=c;b+="</optgroup>";4<d?(document.getElementById("navSyscmds").classList.remove("hide"),document.getElementById("syscmds").classList.add("collapse",
"menu-indent")):(document.getElementById("navSyscmds").classList.add("hide"),document.getElementById("syscmds").classList.remove("collapse","menu-indent"))}else document.getElementById("syscmds").innerHTML="";!0===settings.featScripting?getScriptList(!0):document.getElementById("scripts").innerHTML="";document.getElementById("selectTimerAction").innerHTML=b;toggleBtnGroupValueCollapse(document.getElementById("btnJukeboxModeGroup"),"collapseJukeboxMode",settings.jukeboxMode);document.getElementById("selectJukeboxUniqueTag").value=
settings.jukeboxUniqueTag;document.getElementById("inputJukeboxQueueLength").value=settings.jukeboxQueueLength;document.getElementById("inputJukeboxLastPlayed").value=settings.jukeboxLastPlayed;0===settings.jukeboxMode?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled")):2===settings.jukeboxMode?(document.getElementById("inputJukeboxQueueLength").setAttribute("disabled","disabled"),
document.getElementById("selectJukeboxPlaylist").setAttribute("disabled","disabled"),document.getElementById("selectJukeboxPlaylist").value="Database"):1===settings.jukeboxMode&&(document.getElementById("inputJukeboxQueueLength").removeAttribute("disabled"),document.getElementById("selectJukeboxPlaylist").removeAttribute("disabled"));document.getElementById("inputSmartplsPrefix").value=settings.smartplsPrefix;document.getElementById("inputSmartplsInterval").value=settings.smartplsInterval/60/60;document.getElementById("selectSmartplsSort").value=
settings.smartplsSort;!0===settings.featLocalplayer&&setLocalPlayerUrl();"auto"===settings.musicDirectory?(document.getElementById("selectMusicDirectory").value=settings.musicDirectory,document.getElementById("inputMusicDirectory").value=void 0!==settings.musicDirectoryValue?settings.musicDirectoryValue:"",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):"none"===settings.musicDirectory?(document.getElementById("selectMusicDirectory").value=settings.musicDirectory,
document.getElementById("inputMusicDirectory").value="",document.getElementById("inputMusicDirectory").setAttribute("readonly","readonly")):(document.getElementById("selectMusicDirectory").value="custom",document.getElementById("inputMusicDirectory").value=settings.musicDirectoryValue,document.getElementById("inputMusicDirectory").removeAttribute("readonly"));"Queue"===app.current.app&&"Current"===app.current.tab?getQueue():"Queue"===app.current.app&&"LastPlayed"===app.current.tab?appRoute():"Queue"===
app.current.app&&"Jukebox"===app.current.tab?appRoute():"Search"===app.current.app?appRoute():"Browse"===app.current.app&&"Filesystem"===app.current.tab?appRoute():"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view?appRoute():"Browse"===app.current.app&&"Database"===app.current.tab&&""!==app.current.search&&appRoute();i18nHtml(document.getElementsByTagName("body")[0]);checkConsume();!0===settings.mediaSession&&"mediaSession"in navigator?(navigator.mediaSession.setActionHandler("play",
clickPlay),navigator.mediaSession.setActionHandler("pause",clickPlay),navigator.mediaSession.setActionHandler("stop",clickStop),navigator.mediaSession.setActionHandler("seekbackward",seekRelativeBackward),navigator.mediaSession.setActionHandler("seekforward",seekRelativeForward),navigator.mediaSession.setActionHandler("previoustrack",clickPrev),navigator.mediaSession.setActionHandler("nexttrack",clickNext),navigator.mediaSession.setPositionState||logDebug("mediaSession.setPositionState not supported by browser")):
logDebug("mediaSession not supported by browser");settingsParsed="true"}
function parseMPDSettings(){toggleBtnChk("btnRandom",settings.random);toggleBtnChk("btnConsume",settings.consume);toggleBtnChk("btnRepeat",settings.repeat);toggleBtnChk("btnAutoPlay",settings.autoPlay);toggleBtnGroupValue(document.getElementById("btnSingleGroup"),settings.single);toggleBtnGroupValue(document.getElementById("btnReplaygainGroup"),settings.replaygain);document.getElementById("partitionName").innerText=settings.partition;document.getElementById("inputCrossfade").value=settings.crossfade;
document.getElementById("inputMixrampdb").value=settings.mixrampdb;document.getElementById("inputMixrampdelay").value=settings.mixrampdelay;settings.featBrowse=!0===settings.featLibrary&&!0===settings.publish?!0:!1;for(var a="featStickers featSmartpls featPlaylists featTags featCoverimage featAdvsearch featLove featSingleOneshot featBrowse featMounts featNeighbors featPartitions".split(" "),b=0;b<a.length;b++){var c=document.getElementsByClassName(a[b]),d=c.length,f=!0===settings[a[b]]?"":"none";
"featCoverimage"===a[b]&&!1===settings.coverimage&&(f="none");for(var g=0;g<d;g++)c[g].style.display=f}!1===settings.featPlaylists&&!0===settings.smartpls?document.getElementById("warnSmartpls").classList.remove("hide"):document.getElementById("warnSmartpls").classList.add("hide");!0===settings.featPlaylists&&!1===settings.readonly?document.getElementById("btnSmartpls").removeAttribute("disabled"):document.getElementById("btnSmartpls").setAttribute("disabled","disabled");!1===settings.featStickers&&
!0===settings.stickers?document.getElementById("warnStickers").classList.remove("hide"):document.getElementById("warnStickers").classList.add("hide");!1===settings.featStickers||!1===settings.stickers||!1===settings.featStickerCache?(document.getElementById("warnPlaybackStatistics").classList.remove("hide"),document.getElementById("inputJukeboxLastPlayed").setAttribute("disabled","disabled")):(document.getElementById("warnPlaybackStatistics").classList.add("hide"),document.getElementById("inputJukeboxLastPlayed").removeAttribute("disabled"));
!1===settings.featLove&&!0===settings.love?document.getElementById("warnScrobbler").classList.remove("hide"):document.getElementById("warnScrobbler").classList.add("hide");!1===settings.featLibrary&&!0===settings.coverimage?document.getElementById("warnAlbumart").classList.remove("hide"):document.getElementById("warnAlbumart").classList.add("hide");""===settings.musicDirectoryValue&&"none"!==settings.musicDirectory?document.getElementById("warnMusicDirectory").classList.remove("hide"):document.getElementById("warnMusicDirectory").classList.add("hide");
document.getElementById("warnJukeboxPlaylist").classList.add("hide");!0===settings.bgCover&&!0===settings.featCoverimage&&!0===settings.coverimage?setBackgroundImage(lastSongObj.uri):clearBackgroundImage();var h="";Object.keys(settings.triggers).forEach(function(a){h+='<option value="'+e(settings.triggers[a])+'">'+t(a)+"</option>"});document.getElementById("selectTriggerEvent").innerHTML=h;settings.tags.sort();settings.searchtags.sort();settings.browsetags.sort();filterCols("colsSearch");filterCols("colsQueueCurrent");
filterCols("colsQueueLastPlayed");filterCols("colsQueueJukebox");filterCols("colsBrowsePlaylistsDetail");filterCols("colsBrowseFilesystem");filterCols("colsBrowseDatabaseDetail");filterCols("colsPlayback");if(!1===settings.featTags)app.apps.Browse.active="Filesystem",app.apps.Search.state="0/filename/-/-/",app.apps.Queue.state="0/filename/-/-/",settings.colsQueueCurrent=["Pos","Title","Duration"],settings.colsQueueLastPlayed=["Pos","Title","LastPlayed"],settings.colsQueueJukebox=["Pos","Title"],settings.colsSearch=
["Title","Duration"],settings.colsBrowseFilesystem=["Type","Title","Duration"],settings.colsBrowseDatabase=["Track","Title","Duration"],settings.colsPlayback=[];else{a="";for(b=0;b<settings.colsPlayback.length;b++)a+='<div id="current'+settings.colsPlayback[b]+'" data-tag="'+settings.colsPlayback[b]+'" '+("Lyrics"===settings.colsPlayback[b]?"":'data-name="'+(lastSongObj[settings.colsPlayback[b]]?encodeURI(lastSongObj[settings.colsPlayback[b]]):"")+'"')+"><small>"+t(settings.colsPlayback[b])+"</small><p",
settings.browsetags.includes(settings.colsPlayback[b])&&(a+=' class="clickable"'),a+=">",a="Duration"===settings.colsPlayback[b]?a+(lastSongObj[settings.colsPlayback[b]]?beautifySongDuration(lastSongObj[settings.colsPlayback[b]]):""):"LastModified"===settings.colsPlayback[b]?a+(lastSongObj[settings.colsPlayback[b]]?localeDate(lastSongObj[settings.colsPlayback[b]]):""):"Fileformat"===settings.colsPlayback[b]?a+(lastState?fileformat(lastState.audioFormat):""):a+(lastSongObj[settings.colsPlayback[b]]?
e(lastSongObj[settings.colsPlayback[b]]):""),a+="</p></div>";document.getElementById("cardPlaybackTags").innerHTML=a;(a=document.getElementById("currentLyrics"))&&lastSongObj.uri&&(b=a.getElementsByTagName("small")[0],b.classList.add("clickable"),b.addEventListener("click",function(a){a.target.parentNode.children[1].classList.toggle("expanded")},!1),getLyrics(lastSongObj.uri,a.getElementsByTagName("p")[0]))}settings.tags.includes("Title")&&(app.apps.Search.state="0/any/Title/-/");settings.tags.includes("AlbumArtist")||
(app.apps.Browse.tabs.Database.state="0/Artist/Artist/"+settings.dbDefaultTag+"/");!0===settings.featPlaylists?sendAPI("MPD_API_PLAYLIST_LIST_ALL",{searchstr:""},function(a){getAllPlaylists(a,"selectJukeboxPlaylist",settings.jukeboxPlaylist)}):document.getElementById("selectJukeboxPlaylist").innerHTML='<option value="Database">'+t("Database")+"</option>";setCols("QueueCurrent");setCols("Search");setCols("QueueLastPlayed");setCols("QueueJukebox");setCols("BrowseFilesystem");setCols("BrowsePlaylistsDetail");
setCols("BrowseDatabaseDetail");setCols("Playback");addTagList("BrowseDatabaseByTagDropdown","browsetags");addTagList("BrowseNavPlaylistsDropdown","browsetags");addTagList("BrowseNavFilesystemDropdown","browsetags");addTagList("searchqueuetags","searchtags");addTagList("searchtags","searchtags");addTagList("searchDatabaseTags","browsetags");addTagList("databaseSortTagsList","browsetags");addTagList("dropdownSortPlaylistTags","tags");addTagList("saveSmartPlaylistSort","tags");addTagListSelect("selectSmartplsSort",
"tags");addTagListSelect("saveSmartPlaylistSort","tags");addTagListSelect("selectJukeboxUniqueTag","browsetags");initTagMultiSelect("inputEnabledTags","listEnabledTags",settings.allmpdtags,settings.tags);initTagMultiSelect("inputSearchTags","listSearchTags",settings.tags,settings.searchtags);initTagMultiSelect("inputBrowseTags","listBrowseTags",settings.tags,settings.browsetags);initTagMultiSelect("inputGeneratePlsTags","listGeneratePlsTags",settings.browsetags,settings.generatePlsTags)}
function resetSettings(){sendAPI("MYMPD_API_SETTINGS_RESET",{},getSettings)}
function saveSettings(a){var b=!0,c=document.getElementById("inputCrossfade");c.getAttribute("disabled")||validateInt(c)||(b=!1);c=document.getElementById("inputJukeboxQueueLength");validateInt(c)||(b=!1);c=document.getElementById("inputJukeboxLastPlayed");validateInt(c)||(b=!1);var d=document.getElementById("selectStreamMode"),f=c="",g=document.getElementById("inputStreamUrl");"port"===d.options[d.selectedIndex].value?(f=g.value,validateInt(g)||(b=!1)):(c=g.value,validateStream(g)||(b=!1));d=document.getElementById("inputCoverimageSizeSmall");
validateInt(d)||(b=!1);d=document.getElementById("inputCoverimageSize");validateInt(d)||(b=!1);d=document.getElementById("inputCoverimageName");validateFilenameList(d)||(b=!1);d=document.getElementById("inputBookletName");validateFilename(d)||(b=!1);d=document.getElementById("inputMaxElementsPerPage");validateInt(d)||(b=!1);!0===isMobile&&(g=document.getElementById("inputScaleRatio"),validateFloat(g)?(scale=parseFloat(g.value),setViewport(!0)):b=!1);200<parseInt(d.value)&&(b=!1);d=document.getElementById("inputLastPlayedCount");
validateInt(d)||(b=!1);document.getElementById("btnLoveEnable").classList.contains("active")&&(d=document.getElementById("inputLoveChannel"),g=document.getElementById("inputLoveMessage"),validateNotBlank(d)&&validateNotBlank(g)||(b=!1));!0===settings.featMixramp&&(d=document.getElementById("inputMixrampdb"),d.getAttribute("disabled")||validateFloat(d)||(b=!1),d=document.getElementById("inputMixrampdelay"),d.getAttribute("disabled")||("nan"===d.value&&(d.value="-1"),validateFloat(d)||(b=!1)));d=document.getElementById("inputSmartplsInterval");
validateInt(d)||(b=!1);d=3600*document.getElementById("inputSmartplsInterval").value;g=getBtnGroupValue("btnSingleGroup");var h=getBtnGroupValue("btnJukeboxModeGroup"),k=getBtnGroupValue("btnReplaygainGroup"),l=document.getElementById("selectJukeboxUniqueTag");l=l.options[l.selectedIndex].value;var m=document.getElementById("selectJukeboxPlaylist");m=m.options[m.selectedIndex].value;"2"===h&&(l="Album");"1"===h&&!1===settings.featSearchwindow&&"Database"===m&&(b=!1,document.getElementById("warnJukeboxPlaylist").classList.remove("hide"));
if(!0===b){b=document.getElementById("selectLocale");var p=document.getElementById("selectTheme");sendAPI("MYMPD_API_SETTINGS_SET",{consume:document.getElementById("btnConsume").classList.contains("active")?1:0,random:document.getElementById("btnRandom").classList.contains("active")?1:0,single:parseInt(g),repeat:document.getElementById("btnRepeat").classList.contains("active")?1:0,replaygain:k,crossfade:document.getElementById("inputCrossfade").value,mixrampdb:!0===settings.featMixramp?document.getElementById("inputMixrampdb").value:
settings.mixrampdb,mixrampdelay:!0===settings.featMixramp?document.getElementById("inputMixrampdelay").value:settings.mixrampdelay,notificationWeb:document.getElementById("btnNotifyWeb").classList.contains("active")?!0:!1,notificationPage:document.getElementById("btnNotifyPage").classList.contains("active")?!0:!1,mediaSession:document.getElementById("btnMediaSession").classList.contains("active")?!0:!1,jukeboxMode:parseInt(h),jukeboxPlaylist:m,jukeboxQueueLength:parseInt(document.getElementById("inputJukeboxQueueLength").value),
jukeboxLastPlayed:parseInt(document.getElementById("inputJukeboxLastPlayed").value),jukeboxUniqueTag:l,autoPlay:document.getElementById("btnAutoPlay").classList.contains("active")?!0:!1,bgCover:document.getElementById("btnBgCover").classList.contains("active")?!0:!1,bgColor:document.getElementById("inputBgColor").value,bgCssFilter:document.getElementById("inputBgCssFilter").value,featLocalplayer:document.getElementById("btnFeatLocalplayer").classList.contains("active")?!0:!1,streamUrl:c,streamPort:parseInt(f),
coverimage:document.getElementById("btnCoverimage").classList.contains("active")?!0:!1,coverimageName:document.getElementById("inputCoverimageName").value,coverimageSize:document.getElementById("inputCoverimageSize").value,coverimageSizeSmall:document.getElementById("inputCoverimageSizeSmall").value,locale:b.options[b.selectedIndex].value,love:document.getElementById("btnLoveEnable").classList.contains("active")?!0:!1,loveChannel:document.getElementById("inputLoveChannel").value,loveMessage:document.getElementById("inputLoveMessage").value,
bookmarks:document.getElementById("btnBookmarks").classList.contains("active")?!0:!1,maxElementsPerPage:document.getElementById("inputMaxElementsPerPage").value,stickers:document.getElementById("btnStickers").classList.contains("active")?!0:!1,lastPlayedCount:document.getElementById("inputLastPlayedCount").value,smartpls:document.getElementById("btnSmartpls").classList.contains("active")?!0:!1,smartplsPrefix:document.getElementById("inputSmartplsPrefix").value,smartplsInterval:d,smartplsSort:document.getElementById("selectSmartplsSort").value,
taglist:getTagMultiSelectValues(document.getElementById("listEnabledTags"),!1),searchtaglist:getTagMultiSelectValues(document.getElementById("listSearchTags"),!1),browsetaglist:getTagMultiSelectValues(document.getElementById("listBrowseTags"),!1),generatePlsTags:getTagMultiSelectValues(document.getElementById("listGeneratePlsTags"),!1),theme:p.options[p.selectedIndex].value,highlightColor:document.getElementById("inputHighlightColor").value,timer:document.getElementById("btnFeatTimer").classList.contains("active")?
!0:!1,bookletName:document.getElementById("inputBookletName").value,lyrics:document.getElementById("btnFeatLyrics").classList.contains("active")?!0:!1},getSettings);!0===a?modalSettings.hide():btnWaiting(document.getElementById("btnApplySettings"),!0)}}function getTagMultiSelectValues(a,b){var c=[];a=a.getElementsByTagName("button");for(var d=0;d<a.length;d++)a[d].classList.contains("active")&&(!0===b?c.push(t(a[d].name)):c.push(a[d].name));return!0===b?c.join(", "):c.join(",")}
function initTagMultiSelect(a,b,c,d){for(var f=[],g="",h=0;h<c.length;h++)d.includes(c[h])&&f.push(t(c[h])),g+='<div class="form-check"><button class="btn btn-secondary btn-xs clickable material-icons material-icons-small'+(d.includes(c[h])?" active":"")+'" name="'+c[h]+'">'+(d.includes(c[h])?"check":"radio_button_unchecked")+'</button><label class="form-check-label" for="'+c[h]+'">&nbsp;&nbsp;'+t(c[h])+"</label></div>";document.getElementById(b).innerHTML=g;a=document.getElementById(a);a.value=f.join(", ");
"true"!==a.getAttribute("data-init")&&(a.setAttribute("data-init","true"),document.getElementById(b).addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"BUTTON"===a.target.nodeName&&(toggleBtnChk(a.target),a.target.parentNode.parentNode.parentNode.previousElementSibling.value=getTagMultiSelectValues(a.target.parentNode.parentNode,!0))}))}
function filterCols(a){var b=settings.tags.slice();!1===settings.featTags&&b.push("Title");b.push("Duration");"colsQueueCurrent"===a||"colsBrowsePlaylistsDetail"===a||"colsQueueLastPlayed"===a||"colsQueueJukebox"===a?b.push("Pos"):"colsBrowseFilesystem"===a&&b.push("Type");"colsQueueLastPlayed"===a&&b.push("LastPlayed");"colsPlayback"===a&&(b.push("Filetype"),b.push("Fileformat"),b.push("LastModified"),!0===settings.featLyrics&&b.push("Lyrics"));for(var c=[],d=0;d<settings[a].length;d++)b.includes(settings[a][d])&&
c.push(settings[a][d]);settings[a]=c;logDebug("Columns for "+a+": "+c)}
function toggleBtnNotifyWeb(){var a=document.getElementById("btnNotifyWeb").classList.contains("active")?!0:!1;notificationsSupported()?!1===a?Notification.requestPermission(function(a){"permission"in Notification||(Notification.permission=a);"granted"===a?(toggleBtnChk("btnNotifyWeb",!0),settings.notificationWeb=!0,document.getElementById("warnNotifyWeb").classList.add("hide")):(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!1,document.getElementById("warnNotifyWeb").classList.remove("hide"))}):
(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!1,document.getElementById("warnNotifyWeb").classList.add("hide")):(toggleBtnChk("btnNotifyWeb",!1),settings.notificationWeb=!1)}
function setPlaySettings(a){a.parentNode.classList.contains("btn-group")?toggleBtnGroup(a):toggleBtnChk(a);"playDropdownBtnJukeboxModeGroup"===a.parentNode.id?"0"!==a.parentNode.getElementsByClassName("active")[0].getAttribute("data-value")&&toggleBtnChk("playDropdownBtnConsume",!0):"playDropdownBtnConsume"===a.id&&!1===a.classList.contains("active")&&toggleBtnGroupValue(document.getElementById("playDropdownBtnJukeboxModeGroup"),0);savePlaySettings()}
function showPlayDropdown(){toggleBtnChk(document.getElementById("playDropdownBtnRandom"),settings.random);toggleBtnChk(document.getElementById("playDropdownBtnConsume"),settings.consume);toggleBtnChk(document.getElementById("playDropdownBtnRepeat"),settings.repeat);toggleBtnChk(document.getElementById("playDropdownBtnRandom"),settings.random);toggleBtnGroupValue(document.getElementById("playDropdownBtnSingleGroup"),settings.single);toggleBtnGroupValue(document.getElementById("playDropdownBtnJukeboxModeGroup"),
settings.jukeboxMode)}
function savePlaySettings(){var a=document.getElementById("playDropdownBtnSingleGroup").getElementsByClassName("active")[0].getAttribute("data-value"),b=document.getElementById("playDropdownBtnJukeboxModeGroup").getElementsByClassName("active")[0].getAttribute("data-value");sendAPI("MYMPD_API_SETTINGS_SET",{consume:document.getElementById("playDropdownBtnConsume").classList.contains("active")?1:0,random:document.getElementById("playDropdownBtnRandom").classList.contains("active")?1:0,single:parseInt(a),
repeat:document.getElementById("playDropdownBtnRepeat").classList.contains("active")?1:0,jukeboxMode:parseInt(b)},getSettings)}function songDetails(a){sendAPI("MPD_API_DATABASE_SONGDETAILS",{uri:a},parseSongDetails);modalSongDetails.show()}function parseFingerprint(a){var b=document.createElement("textarea");b.value=a.result.fingerprint;b.classList.add("form-control","text-monospace","small");a=document.getElementById("fingerprint");a.innerHTML="";a.appendChild(b)}
function parseSongDetails(a){var b=document.getElementById("modalSongDetails");b.getElementsByClassName("album-cover")[0].style.backgroundImage='url("'+subdir+"/albumart/"+a.result.uri+'"), url("'+subdir+'/assets/coverimage-loading.svg")';b=b.getElementsByTagName("h1");for(var c=0;c<b.length;c++)b[c].innerText=a.result.Title;b="";for(c=0;c<settings.tags.length;c++)"Title"!==settings.tags[c]&&"-"!==a.result[settings.tags[c]]&&(b+="<tr><th>"+t(settings.tags[c])+'</th><td data-tag="'+settings.tags[c]+
'" data-name="'+encodeURI(a.result[settings.tags[c]])+'">',b=settings.browsetags.includes(settings.tags[c])&&"-"!==a.result[settings.tags[c]]?b+('<a class="text-success" href="#">'+e(a.result[settings.tags[c]])+"</a>"):b+a.result[settings.tags[c]],b+="</td></tr>");b+="<tr><th>"+t("Duration")+"</th><td>"+beautifyDuration(a.result.Duration)+"</td></tr>";b=!0===settings.featLibrary&&!0===settings.publish?b+("<tr><th>"+t("Filename")+'</th><td><a class="breakAll text-success" href="/browse/music/'+encodeURI(a.result.uri)+
'" target="_blank" title="'+e(a.result.uri)+'">'+e(basename(a.result.uri,!0))+"</a></td></tr>"):b+("<tr><th>"+t("Filename")+'</th><td class="breakAll"><span title="'+e(a.result.uri)+'">'+e(basename(a.result.uri,!0))+"</span></td></tr>");b+="<tr><th>"+t("Filetype")+"</th><td>"+filetype(a.result.uri)+"</td></tr>";b+="<tr><th>"+t("LastModified")+"</th><td>"+localeDate(a.result.LastModified)+"</td></tr>";!0===settings.featFingerprint&&(b+="<tr><th>"+t("Fingerprint")+'</th><td class="breakAll" id="fingerprint"><a class="text-success" data-uri="'+
encodeURI(a.result.uri)+'" id="calcFingerprint" href="#">'+t("Calculate")+"</a></td></tr>");""!==a.result.bookletPath&&!0===settings.publish&&(b+="<tr><th>"+t("Booklet")+'</th><td><a class="text-success" href="'+subdir+"/browse/music/"+dirname(a.result.uri)+"/"+settings.bookletName+'" target="_blank">'+t("Download")+"</a></td></tr>");!0===settings.featStickers&&(b+='<tr><th colspan="2" class="pt-3"><h5>'+t("Statistics")+"</h5></th></tr><tr><th>"+t("Play count")+"</th><td>"+a.result.playCount+"</td></tr><tr><th>"+
t("Skip count")+"</th><td>"+a.result.skipCount+"</td></tr><tr><th>"+t("Last played")+"</th><td>"+(0===a.result.lastPlayed?t("never"):localeDate(a.result.lastPlayed))+"</td></tr><tr><th>"+t("Last skipped")+"</th><td>"+(0===a.result.lastSkipped?t("never"):localeDate(a.result.lastSkipped))+"</td></tr><tr><th>"+t("Like")+'</th><td><div class="btn-group btn-group-sm"><button title="'+t("Dislike song")+'" id="btnVoteDown2" data-href=\'{"cmd": "voteSong", "options": [0]}\' class="btn btn-sm btn-light material-icons">thumb_down</button><button title="'+
t("Like song")+'" id="btnVoteUp2" data-href=\'{"cmd": "voteSong", "options": [2]}\' class="btn btn-sm btn-light material-icons">thumb_up</button></div></td></tr>');document.getElementById("tbodySongDetails").innerHTML=b;setVoteSongBtns(a.result.like,a.result.uri);!0===settings.featLyrics&&getLyrics(a.result.uri,document.getElementById("lyricsText"));b=!1;0<a.result.images.length&&!0===settings.featLibrary&&!0===settings.publish?b=!0:!0===settings.coverimage&&(b=!0);c=document.getElementsByClassName("featPictures");
for(var d=0;d<c.length;d++)!0===b?c[d].classList.remove("hide"):c[d].classList.add("hide");if(!0===b){b=[subdir+"/albumart/"+a.result.uri];for(c=0;c<a.result.images.length;c++)!1===isCoverfile(a.result.images[c])&&b.push(subdir+"/browse/music/"+a.result.images[c]);a=document.getElementById("tabSongPics");createImgCarousel(a,"songPicsCarousel",b)}else document.getElementById("tabSongPics").innerText=""}
function isCoverfile(a){a=basename(a).toLowerCase();for(var b=a.split("."),c="png jpg jpeg svg webp tiff bmp".split(" "),d=settings.coverimageName.split(","),f=0;f<d.length;f++){var g=d[f].trim();if(a===g||b[1]&&g===b[0]&&c.includes(b[1]))return!0}return!1}
function getLyrics(a,b){b.classList.add("opacity05");var c=new XMLHttpRequest;c.open("GET",subdir+"/lyrics/"+a,!0);c.onreadystatechange=function(){4===c.readyState&&(b.innerText="No lyrics found"===c.responseText?t(c.responseText):c.responseText,b.classList.remove("opacity05"))};c.send()}function loveSong(){sendAPI("MPD_API_LOVE",{})}
function voteSong(a){var b=decodeURI(domCache.currentTitle.getAttribute("data-uri"));""!==b&&(2===a&&domCache.btnVoteUp.classList.contains("highlight")?a=1:0===a&&domCache.btnVoteDown.classList.contains("highlight")&&(a=1),sendAPI("MPD_API_LIKE",{uri:b,like:a}),setVoteSongBtns(a,b))}
function setVoteSongBtns(a,b){domCache.btnVoteUp2=document.getElementById("btnVoteUp2");domCache.btnVoteDown2=document.getElementById("btnVoteDown2");""===b||-1<b.indexOf("://")?(domCache.btnVoteUp.setAttribute("disabled","disabled"),domCache.btnVoteDown.setAttribute("disabled","disabled"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.setAttribute("disabled","disabled"),domCache.btnVoteDown2.setAttribute("disabled","disabled"))):(domCache.btnVoteUp.removeAttribute("disabled"),domCache.btnVoteDown.removeAttribute("disabled"),
domCache.btnVoteUp2&&(domCache.btnVoteUp2.removeAttribute("disabled"),domCache.btnVoteDown2.removeAttribute("disabled")));0===a?(domCache.btnVoteUp.classList.remove("highlight"),domCache.btnVoteDown.classList.add("highlight"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.remove("highlight"),domCache.btnVoteDown2.classList.add("highlight"))):1===a?(domCache.btnVoteUp.classList.remove("highlight"),domCache.btnVoteDown.classList.remove("highlight"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.remove("highlight"),
domCache.btnVoteDown2.classList.remove("highlight"))):2===a&&(domCache.btnVoteUp.classList.add("highlight"),domCache.btnVoteDown.classList.remove("highlight"),domCache.btnVoteUp2&&(domCache.btnVoteUp2.classList.add("highlight"),domCache.btnVoteDown2.classList.remove("highlight")))}
function parseStats(a){document.getElementById("mpdstats_artists").innerText=a.result.artists;document.getElementById("mpdstats_albums").innerText=a.result.albums;document.getElementById("mpdstats_songs").innerText=a.result.songs;document.getElementById("mpdstats_dbPlaytime").innerText=beautifyDuration(a.result.dbPlaytime);document.getElementById("mpdstats_playtime").innerText=beautifyDuration(a.result.playtime);document.getElementById("mpdstats_uptime").innerText=beautifyDuration(a.result.uptime);
document.getElementById("mpdstats_mympd_uptime").innerText=beautifyDuration(a.result.myMPDuptime);document.getElementById("mpdstats_dbUpdated").innerText=localeDate(a.result.dbUpdated);document.getElementById("mympdVersion").innerText=a.result.mympdVersion;document.getElementById("mpdInfo_version").innerText=a.result.mpdVersion;document.getElementById("mpdInfo_libmpdclientVersion").innerText=a.result.libmpdclientVersion;document.getElementById("mpdInfo_libmympdclientVersion").innerText=a.result.libmympdclientVersion}
function getServerinfo(){var a=new XMLHttpRequest;a.open("GET",subdir+"/api/serverinfo",!0);a.onreadystatechange=function(){if(4===a.readyState){var b=JSON.parse(a.responseText);document.getElementById("wsIP").innerText=b.result.ip;document.getElementById("wsMongooseVersion").innerText=b.result.version}};a.send()}
function parseOutputs(a){for(var b="",c=0,d=0;d<a.result.numOutputs;d++)"dummy"!==a.result.data[d].plugin&&(c++,b+='<button id="btnOutput'+a.result.data[d].id+'" data-output-name="'+encodeURI(a.result.data[d].name)+'" data-output-id="'+a.result.data[d].id+'" class="btn btn-secondary btn-block',1===a.result.data[d].state&&(b+=" active"),b+='"><span class="material-icons float-left">volume_up</span> '+e(a.result.data[d].name),b=0<Object.keys(a.result.data[d].attributes).length?b+('<a class="material-icons float-right text-white" title="'+
t("Edit attributes")+'">settings</a>'):b+('<a class="material-icons float-right text-white" title="'+t("Show attributes")+'">settings</a>'),b+="</button>");0===c&&(b='<span class="material-icons">error_outline</span> '+t("No outputs"));domCache.outputs.innerHTML=b}
function showListOutputAttributes(a){sendAPI("MPD_API_PLAYER_OUTPUT_LIST",{},function(b){modalOutputAttributes.show();for(var c,d=0;d<b.result.data.length;d++)if(b.result.data[d].name===a){c=b.result.data[d];break}document.getElementById("modalOutputAttributesId").value=e(c.id);var f="<tr><td>"+t("Name")+"</td><td>"+e(c.name)+"</td></tr><tr><td>"+t("State")+"</td><td>"+(1===c.state?t("enabled"):t("disabled"))+"</td></tr><tr><td>"+t("Plugin")+"</td><td>"+e(c.plugin)+"</td></tr>",g=0;Object.keys(c.attributes).forEach(function(a){g++;
f+="<tr><td>"+e(a)+'</td><td><input name="'+e(a)+'" class="form-control border-secondary" type="text" value="'+e(c.attributes[a])+'"/></td></tr>'});0<g?document.getElementById("btnOutputAttributesSave").removeAttribute("disabled"):document.getElementById("btnOutputAttributesSave").setAttribute("disabled","disabled");document.getElementById("outputAttributesList").innerHTML=f})}
function saveOutputAttributes(){var a={};a.outputId=parseInt(document.getElementById("modalOutputAttributesId").value);a.attributes={};for(var b=document.getElementById("outputAttributesList").getElementsByTagName("input"),c=0;c<b.length;c++)a.attributes[b[c].name]=b[c].value;sendAPI("MPD_API_PLAYER_OUTPUT_ATTRIBUTS_SET",a);modalOutputAttributes.hide()}
function setCounter(a,b,c){currentSong.totalTime=b;currentSong.elapsedTime=c;currentSong.currentSongId=a;var d=0<b?Math.ceil(domCache.progress.offsetWidth*c/b):0;0===d&&(domCache.progressBar.style.transition="none");domCache.progressBar.style.width=d+"px";0===d&&setTimeout(function(){domCache.progressBar.style.transition=progressBarTransition},10);domCache.progress.style.cursor=0>=b?"default":"pointer";b=beautifySongDuration(c)+"&nbsp;/&nbsp;"+beautifySongDuration(b);domCache.counter.innerHTML=b;
if(lastState&&lastState.currentSongId!==a&&(c=document.getElementById("queueTrackId"+lastState.currentSongId))){if(d=c.querySelector("[data-col=Duration]"))d.innerText=c.getAttribute("data-duration");if(d=c.querySelector("[data-col=Pos]"))d.classList.remove("material-icons"),d.innerText=c.getAttribute("data-songpos");c.classList.remove("font-weight-bold")}if(a=document.getElementById("queueTrackId"+a)){if(c=a.querySelector("[data-col=Duration]"))c.innerHTML=b;(b=a.querySelector("[data-col=Pos]"))&&
!b.classList.contains("material-icons")&&(b.classList.add("material-icons"),b.innerText="play_arrow");a.classList.add("font-weight-bold")}progressTimer&&clearTimeout(progressTimer);"play"===playstate&&(progressTimer=setTimeout(function(){currentSong.elapsedTime++;requestAnimationFrame(function(){setCounter(currentSong.currentSongId,currentSong.totalTime,currentSong.elapsedTime)})},1E3))}
function parseState(a){if(JSON.stringify(a.result)===JSON.stringify(lastState))toggleUI();else{parseUpdateQueue(a);parseVolume(a);setCounter(a.result.currentSongId,a.result.totalTime,a.result.elapsedTime);lastState&&lastState.currentSongId===a.result.currentSongId&&lastState.queueVersion===a.result.queueVersion||sendAPI("MPD_API_PLAYER_CURRENT_SONG",{},songChange);if("-1"===a.result.songPos){domCache.currentTitle.innerText="Not playing";document.title="myMPD";domCache.footerTitle.innerText="";domCache.footerTitle.removeAttribute("title");
domCache.footerTitle.classList.remove("clickable");clearCurrentCover();!0===settings.bgCover&&clearBackgroundImage();for(var b=document.getElementById("cardPlaybackTags").getElementsByTagName("p"),c=0;c<b.length;c++)b[c].innerText=""}else if(b=document.getElementById("currentFileformat"))b.getElementsByTagName("p")[0].innerText=fileformat(a.result.audioFormat);lastState=a.result;!1!==settings.mpdConnected&&!1!==uiEnabled||getSettings(!0)}}
function parseVolume(a){-1===a.result.volume?(domCache.volumePrct.innerText=t("Volumecontrol disabled"),domCache.volumeControl.classList.add("hide")):(domCache.volumeControl.classList.remove("hide"),domCache.volumePrct.innerText=a.result.volume+" %",domCache.volumeMenu.firstChild.innerText=0===a.result.volume?"volume_off":50>a.result.volume?"volume_down":"volume_up");domCache.volumeBar.value=a.result.volume}
function setBackgroundImage(a){if(void 0===a)clearBackgroundImage();else{for(var b=document.querySelectorAll(".albumartbg"),c=0;c<b.length;c++)"-10"===b[c].style.zIndex?b[c].remove():(b[c].style.zIndex="-10",b[c].style.opacity="0");b=document.createElement("div");b.classList.add("albumartbg");b.style.filter=settings.bgCssFilter;b.style.backgroundImage='url("'+subdir+"/albumart/"+a+'")';b.style.opacity=0;c=document.getElementsByTagName("body")[0];c.insertBefore(b,c.firstChild);b=new Image;b.onload=
function(){document.querySelector(".albumartbg").style.opacity=1};b.src=subdir+"/albumart/"+a}}function clearBackgroundImage(){for(var a=document.querySelectorAll(".albumartbg"),b=0;b<a.length;b++)"-10"===a[b].style.zIndex?a[b].remove():(a[b].style.zIndex="-10",a[b].style.opacity="0")}function setCurrentCover(a){_setCurrentCover(a,domCache.currentCover);_setCurrentCover(a,domCache.footerCover)}
function _setCurrentCover(a,b){if(void 0===a)clearCurrentCover();else{for(var c=b.querySelectorAll(".coverbg"),d=0;d<c.length;d++)"2"===c[d].style.zIndex?c[d].remove():c[d].style.zIndex="2";c=document.createElement("div");c.classList.add("coverbg","carousel");c.style.backgroundImage='url("'+subdir+"/albumart/"+a+'")';c.style.opacity=0;b.insertBefore(c,b.firstChild);c=new Image;c.onload=function(){b.querySelector(".coverbg").style.opacity=1};c.src=subdir+"/albumart/"+a}}
function clearCurrentCover(){_clearCurrentCover(domCache.currentCover);_clearCurrentCover(domCache.footerCover)}function _clearCurrentCover(a){a=a.querySelectorAll(".coverbg");for(var b=0;b<a.length;b++)"2"===a[b].style.zIndex?a[b].remove():(a[b].style.zIndex="2",a[b].style.opacity="0")}
function songChange(a){var b=a.result.Title+":"+a.result.Artist+":"+a.result.Album+":"+a.result.uri+":"+a.result.currentSongId;if(lastSong!==b){var c="",d="",f="";mediaSessionSetMetadata(a.result.Title,a.result.Artist,a.result.Album,a.result.uri);setCurrentCover(a.result.uri);!0===settings.bgCover&&!0===settings.featCoverimage&&setBackgroundImage(a.result.uri);void 0!==a.result.Artist&&0<a.result.Artist.length&&"-"!==a.result.Artist?(c+=a.result.Artist,d+=a.result.Artist,f+=a.result.Artist+" - ",
domCache.footerArtist.innerText=a.result.Artist,domCache.footerArtist.setAttribute("data-name",encodeURI(a.result.Artist)),domCache.footerArtist.classList.add("clickable")):(domCache.footerArtist.innerText="",domCache.footerArtist.setAttribute("data-name",""),domCache.footerArtist.classList.remove("clickable"));void 0!==a.result.Album&&0<a.result.Album.length&&"-"!==a.result.Album?(c+=" - "+a.result.Album,d+="<br/>"+a.result.Album,domCache.footerAlbum.innerText=a.result.Album,domCache.footerAlbum.setAttribute("data-name",
encodeURI(a.result.Album)),domCache.footerAlbum.classList.add("clickable")):(domCache.footerAlbum.innerText="",domCache.footerAlbum.setAttribute("data-name",""),domCache.footerAlbum.classList.remove("clickable"));void 0!==a.result.Title&&0<a.result.Title.length?(f+=a.result.Title,domCache.currentTitle.innerText=a.result.Title,domCache.currentTitle.setAttribute("data-uri",encodeURI(a.result.uri)),domCache.footerTitle.innerText=a.result.Title,domCache.footerTitle.classList.add("clickable")):(domCache.currentTitle.innerText=
"",domCache.currentTitle.setAttribute("data-uri",""),domCache.footerTitle.innerText="",domCache.footerTitle.setAttribute("data-name",""),domCache.footerTitle.classList.remove("clickable"));document.title="myMPD: "+f;domCache.footerCover.title=f;void 0!==a.result.uri&&""!==a.result.uri&&-1===a.result.uri.indexOf("://")?domCache.footerTitle.classList.add("clickable"):domCache.footerTitle.classList.remove("clickable");void 0!==a.result.uri?(!0===settings.featStickers&&setVoteSongBtns(a.result.like,a.result.uri),
a.result.Filetype=filetype(a.result.uri)):a.result.Filetype="";a.result.Fileformat=lastState?fileformat(lastState.audioFormat):"";for(f=0;f<settings.colsPlayback.length;f++){var g=document.getElementById("current"+settings.colsPlayback[f]);if(g&&"Lyrics"===settings.colsPlayback[f])getLyrics(a.result.uri,g.getElementsByTagName("p")[0]);else if(g){var h=a.result[settings.colsPlayback[f]];void 0===h&&(h="");"Duration"===settings.colsPlayback[f]?h=beautifySongDuration(h):"LastModified"===settings.colsPlayback[f]&&
(h=localeDate(h));g.getElementsByTagName("p")[0].innerText=h;g.setAttribute("data-name",encodeURI(h))}}document.getElementById("currentBooklet").innerHTML=""===a.result.bookletPath||void 0===a.result.bookletPath||!1===settings.featBrowse?"":'<span class="text-light material-icons">description</span>&nbsp;<a class="text-light" target="_blank" href="'+subdir+"/browse/music/"+e(a.result.bookletPath)+'">'+t("Download booklet")+"</a>";if(f=document.getElementById("queueTrackId"+a.result.currentSongId))f.getElementsByTagName("td")[1].innerText=
a.result.Title;"play"===playstate&&showNotification(a.result.Title,c,d,"success");lastSong=b;lastSongObj=a.result}}function gotoTagList(){appGoto(app.current.app,app.current.tab,app.current.view,"0","-","-","-","")}function volumeStep(a){chVolume("up"===a?settings.volumeStep:0-settings.volumeStep)}function chVolume(a){a=parseInt(domCache.volumeBar.value)+a;0>a?a=0:100<a&&(a=100);domCache.volumeBar.value=a;sendAPI("MPD_API_PLAYER_VOLUME_SET",{volume:a})}
function clickTitle(){var a=decodeURI(domCache.currentTitle.getAttribute("data-uri"));""!==a&&-1===a.indexOf("://")&&songDetails(a)}function mediaSessionSetPositionState(a,b){!0===settings.mediaSession&&"mediaSession"in navigator&&navigator.mediaSession.setPositionState&&b<a&&navigator.mediaSession.setPositionState({duration:a,position:b})}
function mediaSessionSetState(){!0===settings.mediaSession&&"mediaSession"in navigator&&(navigator.mediaSession.playbackState="play"===playstate?"playing":"paused")}
function mediaSessionSetMetadata(a,b,c,d){if(!0===settings.mediaSession&&"mediaSession"in navigator){var f=window.location.port;d=window.location.protocol+"//"+window.location.hostname+(""!==f?":"+f:"")+subdir+"/albumart/"+d;navigator.mediaSession.metadata=!0===settings.coverimage?new MediaMetadata({title:a,artist:b,album:c,artwork:[{src:d}]}):new MediaMetadata({title:a,artist:b,album:c})}}
function focusTable(a,b){void 0===b&&(b=document.getElementById(app.current.app+(void 0!==app.current.tab?app.current.tab:"")+(void 0!==app.current.view?app.current.view:"")+"List"));if("Browse"===app.current.app&&"Database"===app.current.tab&&"List"===app.current.view){if(a=document.getElementsByClassName("card-grid"),0!==a.length){b=a[0];for(var c=0;c<a.length;c++)if(a[c].classList.contains("selected")){b=a[c];break}b.focus()}}else if("Home"===app.current.app){if(a=document.getElementsByClassName("home-icons"),
0!==a.length){b=a[0];for(c=0;c<a.length;c++)if(a[c].classList.contains("selected")){b=a[c];break}b.focus()}}else if(null!==b){c=b.getElementsByClassName("selected");if(void 0===a)0===c.length?(a=b.getElementsByTagName("tbody")[0].rows[0],a.classList.contains("not-clickable")&&(a=b.getElementsByTagName("tbody")[0].rows[1]),a.focus(),a.classList.add("selected")):c[0].focus();else{c&&0<c.length&&c[0].classList.remove("selected");c=b.getElementsByTagName("tbody")[0].rows;var d=c.length;d<a&&(a=0);d>a&&
(c[a].focus(),c[a].classList.add("selected"))}"BrowseFilesystemList"===b.id&&(a=b.getElementsByTagName("tbody")[0],0<a.rows.length&&"parentDir"!==a.rows[0].getAttribute("data-type")&&""!==app.current.search&&(b=b.getElementsByTagName("thead")[0].rows[0].cells.length,c=app.current.search.replace(/\/?([^/]+)$/,""),a=a.insertRow(0),a.setAttribute("data-type","parentDir"),a.setAttribute("tabindex",0),a.setAttribute("data-uri",encodeURI(c)),a.innerHTML='<td colspan="'+b+'">..</td>'));scrollFocusIntoView()}}
function scrollFocusIntoView(){var a=document.activeElement,b=a.getBoundingClientRect().top,c=a.offsetHeight;a=a.parentNode.parentNode.offsetTop;window.innerHeight>window.innerWidth&&(a+=domCache.header.offsetHeight);var d=window.innerHeight-a-domCache.footer.offsetHeight,f=c/2;b<=a+f?window.scrollBy(0,-c):b+c>d-f&&window.scrollBy(0,c)}
function navigateTable(a,b){if(a=document.activeElement){var c=null,d=!1;"ArrowDown"===b?(c=a.nextElementSibling,c.classList.contains("not-clickable")&&(c=c.nextElementSibling),d=!0):"ArrowUp"===b?(c=a.previousElementSibling,c.classList.contains("not-clickable")&&(c=c.previousElementSibling),d=!0):" "===b?(b=a.lastChild.firstChild,"A"===b.nodeName&&b.click(),d=!0):"Enter"===b?(a.firstChild.click(),d=!0):"Escape"===b&&(a.blur(),a.classList.remove("selected"),d=!0);!0===d&&(event.preventDefault(),event.stopPropagation());
c&&(a.classList.remove("selected"),c.classList.add("selected"),c.focus(),scrollFocusIntoView())}}
function dragAndDropTable(a){var b=document.getElementById(a).getElementsByTagName("tbody")[0];b.addEventListener("dragstart",function(a){"TR"===a.target.nodeName&&(a.target.classList.add("opacity05"),a.dataTransfer.setDragImage(a.target,0,0),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("Text",a.target.getAttribute("id")),dragEl=a.target.cloneNode(!0))},!1);b.addEventListener("dragleave",function(a){a.preventDefault();if("TR"===dragEl.nodeName){var b=a.target;"TD"===a.target.nodeName&&
(b=a.target.parentNode);"TR"===b.nodeName&&b.classList.remove("dragover")}},!1);b.addEventListener("dragover",function(a){a.preventDefault();if("TR"===dragEl.nodeName){for(var c=b.getElementsByClassName("dragover"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover");c=a.target;"TD"===a.target.nodeName&&(c=a.target.parentNode);"TR"===c.nodeName&&c.classList.add("dragover");a.dataTransfer.dropEffect="move"}},!1);b.addEventListener("dragend",function(a){a.preventDefault();if("TR"===dragEl.nodeName){for(var c=
b.getElementsByClassName("dragover"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover");document.getElementById(a.dataTransfer.getData("Text"))&&document.getElementById(a.dataTransfer.getData("Text")).classList.remove("opacity05")}},!1);b.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();if("TR"===dragEl.nodeName){var d=c.target;"TD"===c.target.nodeName&&(d=c.target.parentNode);var f=document.getElementById(c.dataTransfer.getData("Text")).getAttribute("data-songpos"),
g=d.getAttribute("data-songpos");document.getElementById(c.dataTransfer.getData("Text")).remove();dragEl.classList.remove("opacity05");b.insertBefore(dragEl,d);c=b.getElementsByClassName("dragover");d=c.length;for(var h=0;h<d;h++)c[h].classList.remove("dragover");document.getElementById(a).classList.add("opacity05");"Queue"===app.current.app&&"Current"===app.current.tab?sendAPI("MPD_API_QUEUE_MOVE_TRACK",{from:f,to:g}):"Browse"===app.current.app&&"Playlists"===app.current.tab&&"Detail"===app.current.view&&
playlistMoveTrack(f,g)}},!1)}
function dragAndDropTableHeader(a){if(document.getElementById(a+"List"))var b=document.getElementById(a+"List").getElementsByTagName("tr")[0];else b=a.getElementsByTagName("tr")[0],a="BrowseDatabase";b.addEventListener("dragstart",function(a){"TH"===a.target.nodeName&&(a.target.classList.add("opacity05"),a.dataTransfer.setDragImage(a.target,0,0),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("Text",a.target.getAttribute("data-col")),dragEl=a.target.cloneNode(!0))},!1);b.addEventListener("dragleave",
function(a){a.preventDefault();"TH"===dragEl.nodeName&&"TH"===a.target.nodeName&&a.target.classList.remove("dragover-th")},!1);b.addEventListener("dragover",function(a){a.preventDefault();if("TH"===dragEl.nodeName){for(var c=b.getElementsByClassName("dragover-th"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover-th");"TH"===a.target.nodeName&&a.target.classList.add("dragover-th");a.dataTransfer.dropEffect="move"}},!1);b.addEventListener("dragend",function(a){a.preventDefault();if("TH"===dragEl.nodeName){for(var c=
b.getElementsByClassName("dragover-th"),f=c.length,g=0;g<f;g++)c[g].classList.remove("dragover-th");this.querySelector("[data-col="+a.dataTransfer.getData("Text")+"]")&&this.querySelector("[data-col="+a.dataTransfer.getData("Text")+"]").classList.remove("opacity05")}},!1);b.addEventListener("drop",function(c){c.stopPropagation();c.preventDefault();if("TH"===dragEl.nodeName){this.querySelector("[data-col="+c.dataTransfer.getData("Text")+"]").remove();dragEl.classList.remove("opacity05");b.insertBefore(dragEl,
c.target);c=b.getElementsByClassName("dragover-th");for(var d=c.length,f=0;f<d;f++)c[f].classList.remove("dragover-th");document.getElementById(a+"List")?(document.getElementById(a+"List").classList.add("opacity05"),saveCols(a)):saveCols(a,this.parentNode.parentNode)}},!1)}
function setColTags(a){var b=settings.tags.slice();!1===settings.featTags&&b.push("Title");b.push("Duration");"QueueCurrent"!==a&&"BrowsePlaylistsDetail"!==a&&"QueueLastPlayed"!==a&&"QueueJukebox"!==a||b.push("Pos");"BrowseFilesystem"===a&&b.push("Type");"QueueLastPlayed"===a&&b.push("LastPlayed");"Playback"===a&&(b.push("Filetype"),b.push("Fileformat"),b.push("LastModified"),!0===settings.featLyrics&&b.push("Lyrics"));b.sort();return b}
function setColsChecklist(a){for(var b="",c=setColTags(a),d=0;d<c.length;d++)if("Playback"!==a||"Title"!==c[d])b+='<div><button class="btn btn-secondary btn-xs clickable material-icons material-icons-small'+(settings["cols"+a].includes(c[d])?" active":"")+'" name="'+c[d]+'">'+(settings["cols"+a].includes(c[d])?"check":"radio_button_unchecked")+'</button><label class="form-check-label" for="'+c[d]+'">&nbsp;&nbsp;'+t(c[d])+"</label></div>";return b}
function setCols(a,b){var c=document.getElementById(a+"ColsDropdown");c&&(c.firstChild.innerHTML=setColsChecklist(a));var d=app.current.sort;"Search"===a&&"0/any/Title/-/"===app.apps.Search.state&&(d=settings.tags.includes("Title")?"Title":!1===settings.featTags?"Filename":"-");if("Playback"!==a){c="";for(var f=0;f<settings["cols"+a].length;f++){var g=settings["cols"+a][f];c+='<th draggable="true" data-col="'+g+'">';if("Track"===g||"Pos"===g)g="#";c+=t(g);"Search"!==a||g!==d&&"-"+g!==d||(g=!1,0===
app.current.sort.indexOf("-")&&(g=!0),c+='<span class="sort-dir material-icons pull-right">'+(!0===g?"arrow_drop_up":"arrow_drop_down")+"</span>");c+="</th>"}c=!0===settings.featTags?c+'<th data-col="Action"><a href="#" class="text-secondary align-middle material-icons material-icons-small">settings</a></th>':c+"<th></th>";if(void 0===b)document.getElementById(a+"List").getElementsByTagName("tr")[0].innerHTML=c;else for(a=document.querySelectorAll(b),b=0;b<a.length;b++)a[b].getElementsByTagName("tr")[0].innerHTML=
c}}
function saveCols(a,b){var c=document.getElementById(a+"ColsDropdown");b=void 0===b?document.getElementById(a+"List").getElementsByTagName("tr")[0]:"string"===typeof b?document.querySelector(b).getElementsByTagName("tr")[0]:b.getElementsByTagName("tr")[0];if(c){c=c.firstChild.getElementsByTagName("button");for(var d=0;d<c.length;d++)if(null!==c[d].getAttribute("name")){var f=b.querySelector("[data-col="+c[d].name+"]");!1===c[d].classList.contains("active")?f&&f.remove():f||(f=document.createElement("th"),f.innerText=
c[d].name,f.setAttribute("data-col",c[d].name),b.insertBefore(f,b.lastChild))}}a={table:"cols"+a,cols:[]};b=b.getElementsByTagName("th");for(c=0;c<b.length;c++)d=b[c].getAttribute("data-col"),"Action"!==d&&null!==d&&a.cols.push(d);sendAPI("MYMPD_API_COLS_SAVE",a,getSettings)}
function saveColsPlayback(a){for(var b=document.getElementById(a+"ColsDropdown").firstChild.getElementsByTagName("button"),c=document.getElementById("cardPlaybackTags"),d=0;d<b.length-1;d++){var f=document.getElementById("current"+b[d].name);!1===b[d].classList.contains("active")?f&&f.remove():f||(f=document.createElement("div"),f.innerHTML="<small>"+t(b[d].name)+"</small><p></p>",f.setAttribute("id","current"+b[d].name),f.setAttribute("data-tag",b[d].name),c.appendChild(f))}a={table:"cols"+a,cols:[]};
c=c.getElementsByTagName("div");for(b=0;b<c.length;b++)(d=c[b].getAttribute("data-tag"))&&a.cols.push(d);sendAPI("MYMPD_API_COLS_SAVE",a,getSettings)}function replaceTblRow(a,b){var c=!1;a.querySelector("[data-popover]")&&hideMenu();a.classList.contains("selected")&&(b.classList.add("selected"),b.focus(),c=!0);a.replaceWith(b);return c}var themes={"theme-autodetect":"Autodetect","theme-default":"Default","theme-dark":"Dark","theme-light":"Light"};
function deleteTimer(a){sendAPI("MYMPD_API_TIMER_RM",{timerid:a},showListTimer)}function toggleTimer(a,b){a.classList.contains("active")?(a.classList.remove("active"),sendAPI("MYMPD_API_TIMER_TOGGLE",{timerid:b,enabled:!1},showListTimer)):(a.classList.add("active"),sendAPI("MYMPD_API_TIMER_TOGGLE",{timerid:b,enabled:!0},showListTimer))}
function saveTimer(){var a=!0,b=document.getElementById("inputTimerName");validateNotBlank(b)||(a=!1);for(var c=!1,d="btnTimerMon btnTimerTue btnTimerWed btnTimerThu btnTimerFri btnTimerSat btnTimerSun".split(" "),f=[],g=0;g<d.length;g++){var h=document.getElementById(d[g]).classList.contains("active")?!0:!1;f.push(h);!0===h&&(c=!0)}!1===c?(a=!1,document.getElementById("invalidTimerWeekdays").style.display="block"):document.getElementById("invalidTimerWeekdays").style.display="none";c=document.getElementById("selectTimerAction");
d=document.getElementById("selectTimerPlaylist");g=document.getElementById("selectTimerHour");h=document.getElementById("selectTimerMinute");var k=document.getElementById("btnTimerJukeboxModeGroup").getElementsByClassName("active")[0].getAttribute("data-value");-1===c.selectedIndex&&(a=!1,c.classList.add("is-invalid"));"0"===k&&"Database"===d.options[d.selectedIndex].value&&"startplay"===c.options[c.selectedIndex].value&&(a=!1,document.getElementById("btnTimerJukeboxModeGroup").classList.add("is-invalid"));
if(!0===a){a={};for(var l=document.getElementById("timerActionScriptArguments").getElementsByTagName("input"),m=0;m<l.length;m++)a[l[m].getAttribute("data-name")]=l[m].value;sendAPI("MYMPD_API_TIMER_SAVE",{timerid:parseInt(document.getElementById("inputTimerId").value),name:b.value,enabled:document.getElementById("btnTimerEnabled").classList.contains("active")?!0:!1,startHour:parseInt(g.options[g.selectedIndex].value),startMinute:parseInt(h.options[h.selectedIndex].value),weekdays:f,action:c.options[c.selectedIndex].parentNode.getAttribute("data-value"),
subaction:c.options[c.selectedIndex].value,volume:parseInt(document.getElementById("inputTimerVolume").value),playlist:d.options[d.selectedIndex].value,jukeboxMode:parseInt(k),arguments:a},showListTimer)}}
function showEditTimer(a){document.getElementById("timerActionPlay").classList.add("hide");document.getElementById("timerActionScript").classList.add("hide");document.getElementById("listTimer").classList.remove("active");document.getElementById("editTimer").classList.add("active");document.getElementById("listTimerFooter").classList.add("hide");document.getElementById("editTimerFooter").classList.remove("hide");if(0!==a)sendAPI("MYMPD_API_TIMER_GET",{timerid:a},parseEditTimer);else{sendAPI("MPD_API_PLAYLIST_LIST_ALL",
{searchstr:""},function(a){getAllPlaylists(a,"selectTimerPlaylist","Database")});document.getElementById("inputTimerId").value="0";document.getElementById("inputTimerName").value="";toggleBtnChk("btnTimerEnabled",!0);document.getElementById("selectTimerHour").value="12";document.getElementById("selectTimerMinute").value="0";document.getElementById("selectTimerAction").value="startplay";document.getElementById("inputTimerVolume").value="50";document.getElementById("selectTimerPlaylist").value="Database";
toggleBtnGroupValue(document.getElementById("btnTimerJukeboxModeGroup"),1);a="btnTimerMon btnTimerTue btnTimerWed btnTimerThu btnTimerFri btnTimerSat btnTimerSun".split(" ");for(var b=0;b<a.length;b++)toggleBtnChk(a[b],!1);document.getElementById("timerActionPlay").classList.remove("hide")}document.getElementById("inputTimerName").focus();removeIsInvalid(document.getElementById("editTimerForm"));document.getElementById("invalidTimerWeekdays").style.display="none"}
function parseEditTimer(a){var b=a.result.playlist;sendAPI("MPD_API_PLAYLIST_LIST_ALL",{searchstr:""},function(a){getAllPlaylists(a,"selectTimerPlaylist",b)});document.getElementById("inputTimerId").value=a.result.timerid;document.getElementById("inputTimerName").value=a.result.name;toggleBtnChk("btnTimerEnabled",a.result.enabled);document.getElementById("selectTimerHour").value=a.result.startHour;document.getElementById("selectTimerMinute").value=a.result.startMinute;document.getElementById("selectTimerAction").value=
a.result.subaction;selectTimerActionChange(a.result.arguments);document.getElementById("inputTimerVolume").value=a.result.volume;toggleBtnGroupValue(document.getElementById("btnTimerJukeboxModeGroup"),a.result.jukeboxMode);for(var c="btnTimerMon btnTimerTue btnTimerWed btnTimerThu btnTimerFri btnTimerSat btnTimerSun".split(" "),d=0;d<c.length;d++)toggleBtnChk(c[d],a.result.weekdays[d])}
function selectTimerActionChange(a){var b=document.getElementById("selectTimerAction");"startplay"===b.options[b.selectedIndex].value?(document.getElementById("timerActionPlay").classList.remove("hide"),document.getElementById("timerActionScript").classList.add("hide")):"script"===b.options[b.selectedIndex].parentNode.getAttribute("data-value")?(document.getElementById("timerActionScript").classList.remove("hide"),document.getElementById("timerActionPlay").classList.add("hide"),showTimerScriptArgs(b.options[b.selectedIndex],
a)):(document.getElementById("timerActionPlay").classList.add("hide"),document.getElementById("timerActionScript").classList.add("hide"))}
function showTimerScriptArgs(a,b){void 0===b&&(b={});a=JSON.parse(a.getAttribute("data-arguments"));for(var c="",d=0;d<a.arguments.length;d++)c+='<div class="form-group row"><label class="col-sm-4 col-form-label" for="timerActionScriptArguments'+d+'">'+e(a.arguments[d])+'</label><div class="col-sm-8"><input name="timerActionScriptArguments'+d+'" class="form-control border-secondary" type="text" value="'+(b[a.arguments[d]]?e(b[a.arguments[d]]):"")+'"data-name="'+a.arguments[d]+'"></div></div>';0===
a.arguments.length&&(c="No arguments");document.getElementById("timerActionScriptArguments").innerHTML=c}function showListTimer(){document.getElementById("listTimer").classList.add("active");document.getElementById("editTimer").classList.remove("active");document.getElementById("listTimerFooter").classList.remove("hide");document.getElementById("editTimerFooter").classList.add("hide");sendAPI("MYMPD_API_TIMER_LIST",{},parseListTimer)}
function parseListTimer(a){for(var b=document.getElementById("listTimer").getElementsByTagName("tbody")[0],c=b.getElementsByTagName("tr"),d=0,f="Mon Tue Wed Thu Fri Sat Sun".split(" "),g=0;g<a.result.returnedEntities;g++){var h=document.createElement("tr");h.setAttribute("data-id",a.result.data[g].timerid);for(var k="<td>"+e(a.result.data[g].name)+'</td><td><button name="enabled" class="btn btn-secondary btn-xs clickable material-icons material-icons-small'+(!0===a.result.data[g].enabled?" active":
"")+'">'+(!0===a.result.data[g].enabled?"check":"radio_button_unchecked")+"</button></td><td>"+zeroPad(a.result.data[g].startHour,2)+":"+zeroPad(a.result.data[g].startMinute,2)+" "+t("on")+" ",l=[],m=0;7>m;m++)!0===a.result.data[g].weekdays[m]&&l.push(t(f[m]));k+=l.join(", ")+"</td><td>"+prettyTimerAction(a.result.data[g].action,a.result.data[g].subaction)+'</td><td data-col="Action"><a href="#" class="material-icons color-darkgrey">delete</a></td>';h.innerHTML=k;g<c.length?d=!0===replaceTblRow(c[g],
h)?g:d:b.append(h)}for(d=c.length-1;d>=a.result.returnedEntities;d--)c[d].remove();0===a.result.returnedEntities&&(b.innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="4">'+t("Empty list")+"</td></tr>")}function prettyTimerAction(a,b){return"player"===a&&"startplay"===b?t("Start playback"):"player"===a&&"stopplay"===b?t("Stop playback"):"syscmd"===a?t("System command")+": "+e(b):"script"===a?t("Script")+": "+e(b):e(a)+": "+e(b)}
function saveTrigger(){var a=!0,b=document.getElementById("inputTriggerName");validatePlnameEl(b)||(a=!1);if(!0===a){a={};for(var c=document.getElementById("triggerActionScriptArguments").getElementsByTagName("input"),d=0;d<c.length;d++)a[c[d].getAttribute("data-name")]=c[d].value;sendAPI("MPD_API_TRIGGER_SAVE",{id:parseInt(document.getElementById("inputTriggerId").value),name:b.value,event:getSelectValue("selectTriggerEvent"),script:getSelectValue("selectTriggerScript"),arguments:a},showListTrigger,
!1)}}
function showEditTrigger(a){document.getElementById("listTrigger").classList.remove("active");document.getElementById("newTrigger").classList.add("active");document.getElementById("listTriggerFooter").classList.add("hide");document.getElementById("newTriggerFooter").classList.remove("hide");var b=document.getElementById("inputTriggerName");b.classList.remove("is-invalid");b.value="";b.focus();document.getElementById("inputTriggerId").value="-1";document.getElementById("selectTriggerEvent").selectedIndex=0;
document.getElementById("selectTriggerScript").selectedIndex=0;-1<a?sendAPI("MPD_API_TRIGGER_GET",{id:a},parseTriggerEdit,!1):selectTriggerActionChange()}function parseTriggerEdit(a){document.getElementById("inputTriggerId").value=a.result.id;document.getElementById("inputTriggerName").value=a.result.name;document.getElementById("selectTriggerEvent").value=a.result.event;document.getElementById("selectTriggerScript").value=a.result.script;selectTriggerActionChange(a.result.arguments)}
function selectTriggerActionChange(a){var b=document.getElementById("selectTriggerScript");showTriggerScriptArgs(b.options[b.selectedIndex],a)}
function showTriggerScriptArgs(a,b){void 0===b&&(b={});a=JSON.parse(a.getAttribute("data-arguments"));for(var c="",d=0;d<a.arguments.length;d++)c+='<div class="form-group row"><label class="col-sm-4 col-form-label" for="triggerActionScriptArguments'+d+'">'+e(a.arguments[d])+'</label><div class="col-sm-8"><input name="triggerActionScriptArguments'+d+'" class="form-control border-secondary" type="text" value="'+(b[a.arguments[d]]?e(b[a.arguments[d]]):"")+'"data-name="'+a.arguments[d]+'"></div></div>';
0===a.arguments.length&&(c="No arguments");document.getElementById("triggerActionScriptArguments").innerHTML=c}function showListTrigger(){document.getElementById("listTrigger").classList.add("active");document.getElementById("newTrigger").classList.remove("active");document.getElementById("listTriggerFooter").classList.remove("hide");document.getElementById("newTriggerFooter").classList.add("hide");sendAPI("MPD_API_TRIGGER_LIST",{},parseTriggerList,!1)}
function deleteTrigger(a){sendAPI("MPD_API_TRIGGER_DELETE",{id:a},function(){sendAPI("MPD_API_TRIGGER_LIST",{},parseTriggerList,!1)},!0)}
function parseTriggerList(a){if(0<a.result.data.length){for(var b="",c=0;c<a.result.data.length;c++)b+='<tr data-trigger-id="'+encodeURI(a.result.data[c].id)+'"><td class="'+(a.result.data[c].name===settings.trigger?"font-weight-bold":"")+'">'+e(a.result.data[c].name)+"</td><td>"+t(a.result.data[c].eventName)+"</td><td>"+e(a.result.data[c].script)+'</td><td data-col="Action">'+("default"===a.result.data[c].name||a.result.data[c].name===settings.trigger?"":'<a href="#" title="'+t("Delete")+'" data-action="delete" class="material-icons color-darkgrey">delete</a>')+
"</td></tr>";document.getElementById("listTriggerList").innerHTML=b}else document.getElementById("listTriggerList").innerHTML='<tr class="not-clickable"><td><span class="material-icons">error_outline</span></td><td colspan="2">'+t("Empty list")+"</td></tr>"}function removeIsInvalid(a){a=a.querySelectorAll(".is-invalid");for(var b=0;b<a.length;b++)a[b].classList.remove("is-invalid")}
function getSelectValue(a){"string"===typeof a&&(a=document.getElementById(a));if(a&&0<=a.selectedIndex)return a.options[a.selectedIndex].value}function getSelectedOptionAttribute(a,b){if((a=document.getElementById(a))&&0<=a.selectedIndex)return a.options[a.selectedIndex].getAttribute(b)}
function alignDropdown(a){getXpos(a.children[0])<.66*domCache.body.offsetWidth?"navState"===a.id?(a.classList.remove("dropdown"),a.classList.add("dropright")):a.getElementsByClassName("dropdown-menu")[0].classList.remove("dropdown-menu-right"):(a.getElementsByClassName("dropdown-menu")[0].classList.add("dropdown-menu-right"),a.classList.add("dropdown"),a.classList.remove("dropright"))}function getXpos(a){for(var b=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,a=a.offsetParent;return b}
function zeroPad(a,b){b=b-a.toString().length+1;return Array(+(0<b&&b)).join("0")+a}function dirname(a){return a.replace(/\/[^/]*$/,"")}function basename(a,b){return!0===b?a.split("/").reverse()[0].split(/[?#]/)[0]:a.split("/").reverse()[0]}
function filetype(a){if(void 0===a)return"";a=a.split(".").pop().toUpperCase();switch(a){case "MP3":return a+" - MPEG-1 Audio Layer III";case "FLAC":return a+" - Free Lossless Audio Codec";case "OGG":return a+" - Ogg Vorbis";case "OPUS":return a+" - Opus Audio";case "WAV":return a+" - WAVE Audio File";case "WV":return a+" - WavPack";case "AAC":return a+" - Advancded Audio Coding";case "MPC":return a+" - Musepack";case "MP4":return a+" - MPEG-4";case "APE":return a+" - Monkey Audio ";case "WMA":return a+
" - Windows Media Audio";default:return a}}function fileformat(a){return a.bits+t("bits")+" - "+a.sampleRate/1E3+t("kHz")}function scrollToPosY(a){document.body.scrollTop=a;document.documentElement.scrollTop=a}
function selectTag(a,b,c){a=document.getElementById(a);var d=a.querySelector(".active");d&&d.classList.remove("active");if(d=a.querySelector("[data-tag="+c+"]"))d.classList.add("active"),void 0!==b&&(document.getElementById(b).innerText=d.innerText,document.getElementById(b).setAttribute("data-phrase",d.innerText))}
function addTagList(a,b){var c="";"searchtags"===b&&(!0===settings.featTags&&(c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="any">'+t("Any Tag")+"</button>"),c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="filename">'+t("Filename")+"</button>");for(var d=0;d<settings[b].length;d++)c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="'+settings[b][d]+'">'+t(settings[b][d])+"</button>";if("BrowseNavFilesystemDropdown"===
a||"BrowseNavPlaylistsDropdown"===a)c='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="Database">Database</button>';"BrowseDatabaseByTagDropdown"===a||"BrowseNavFilesystemDropdown"===a||"BrowseNavPlaylistsDropdown"===a?("BrowseDatabaseByTagDropdown"===a&&(c+='<div class="dropdown-divider"></div>'),c+='<button type="button" class="btn btn-secondary btn-sm btn-block'+("BrowseNavPlaylistsDropdown"===a?" active":"")+'" data-tag="Playlists">'+t("Playlists")+'</button><button type="button" class="btn btn-secondary btn-sm btn-block'+
("BrowseNavFilesystemDropdown"===a?" active":"")+'" data-tag="Filesystem">'+t("Filesystem")+"</button>"):"databaseSortTagsList"===a&&(settings.tags.includes("Date")&&(c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="Date">'+t("Date")+"</button>"),c+='<button type="button" class="btn btn-secondary btn-sm btn-block" data-tag="Last-Modified">'+t("Last modified")+"</button>");document.getElementById(a).innerHTML=c}
function addTagListSelect(a,b){var c="";"saveSmartPlaylistSort"===a||"selectSmartplsSort"===a?(c+='<option value="">'+t("Disabled")+"</option>",c+='<option value="shuffle">'+t("Shuffle")+"</option>",c+='<optgroup label="'+t("Sort by tag")+'">',c+='<option value="filename">'+t("Filename")+"</option>"):"selectJukeboxUniqueTag"===a&&!1===settings.browsetags.includes("Title")&&(c='<option value="Title">'+t("Song")+"</option>");for(var d=0;d<settings[b].length;d++)c+='<option value="'+settings[b][d]+'">'+
t(settings[b][d])+"</option>";if("saveSmartPlaylistSort"===a||"selectSmartplsSort"===a)c+="</optgroup>";document.getElementById(a).innerHTML=c}function openModal(a){window[a].show()}function openDropdown(a){window[a].toggle()}function focusSearch(){"Queue"===app.current.app?document.getElementById("searchqueuestr").focus():"Search"===app.current.app?domCache.searchstr.focus():appGoto("Search")}
function btnWaiting(a,b){!0===b?(b=document.createElement("span"),b.classList.add("spinner-border","spinner-border-sm","mr-2"),a.insertBefore(b,a.firstChild),a.setAttribute("disabled","disabled")):(a.removeAttribute("disabled"),"SPAN"===a.firstChild.nodeName&&a.firstChild.remove())}
function toggleBtnGroupValue(a,b){a=a.getElementsByTagName("button");var c=a[0],d=b;!1===isNaN(b)&&(d=b.toString());for(b=0;b<a.length;b++)a[b].getAttribute("data-value")===d?(a[b].classList.add("active"),c=a[b]):a[b].classList.remove("active");return c}function toggleBtnGroupValueCollapse(a,b,c){"show"===toggleBtnGroupValue(a,c).getAttribute("data-collapse")?document.getElementById(b).classList.add("show"):document.getElementById(b).classList.remove("show")}
function toggleBtnGroup(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));a=b.parentNode.getElementsByTagName("button");for(var c=0;c<a.length;c++)a[c]===b?a[c].classList.add("active"):a[c].classList.remove("active");return b}function getBtnGroupValue(a){var b=document.getElementById(a).getElementsByClassName("active");0===b.length&&(b=document.getElementById(a).getElementsByTagName("button"));return b[0].getAttribute("data-value")}
function toggleBtnGroupCollapse(a,b){"show"===toggleBtnGroup(a).getAttribute("data-collapse")?!1===document.getElementById(b).classList.contains("show")&&window[b].show():window[b].hide()}function toggleBtn(a,b){var c=a;"string"===typeof a&&(c=document.getElementById(a));c&&(void 0===b&&(b=c.classList.contains("active")?!1:!0),!0===b||1===b?c.classList.add("active"):c.classList.remove("active"))}
function toggleBtnChk(a,b){var c=a;"string"===typeof a&&(c=document.getElementById(a));if(c){void 0===b&&(b=c.classList.contains("active")?!1:!0);if(!0===b||1===b)return c.classList.add("active"),c.innerText="check",!0;c.classList.remove("active");c.innerText="radio_button_unchecked";return!1}}function toggleBtnChkCollapse(a,b,c){!0===toggleBtnChk(a,c)?document.getElementById(b).classList.add("show"):document.getElementById(b).classList.remove("show")}
function setPagination(a,b){var c=app.current.app+(void 0===app.current.tab?"":app.current.tab),d=Math.ceil(a/settings.maxElementsPerPage);0===d&&(d=1);for(var f=[document.getElementById(c+"PaginationTop"),document.getElementById(c+"PaginationBottom")],g=0;g<f.length;g++){var h=f[g].children[0],k=f[g].children[1].children[0],l=f[g].children[1].children[1],m=f[g].children[2];k.innerText=app.current.page/settings.maxElementsPerPage+1+" / "+d;if(1<d){k.removeAttribute("disabled");for(var p="",n=0;n<
d;n++)p+='<button data-page="'+n*settings.maxElementsPerPage+'" type="button" class="mr-1 mb-1 btn-sm btn btn-secondary">'+(n+1)+"</button>";l.innerHTML=p;k.classList.remove("nodropdown")}else-1===a?(k.setAttribute("disabled","disabled"),k.innerText=app.current.page/settings.maxElementsPerPage+1):k.setAttribute("disabled","disabled"),k.classList.add("nodropdown");a>app.current.page+settings.maxElementsPerPage||-1===a&&b>=settings.maxElementsPerPage?(m.removeAttribute("disabled"),f[g].classList.remove("hide"),
document.getElementById(c+"ButtonsBottom").classList.remove("hide")):(m.setAttribute("disabled","disabled"),f[g].classList.add("hide"),document.getElementById(c+"ButtonsBottom").classList.add("hide"));0<app.current.page?(h.removeAttribute("disabled"),f[g].classList.remove("hide"),document.getElementById(c+"ButtonsBottom").classList.remove("hide")):h.setAttribute("disabled","disabled")}}function genId(a){return"id"+a.replace(/[^\w-]/g,"")}
function parseCmd(a,b){null!==a&&a.preventDefault();var c=b;"string"===typeof b&&(c=JSON.parse(b));if("function"===typeof window[c.cmd])switch(c.cmd){case "sendAPI":sendAPI(c.options[0].cmd,{});break;case "toggleBtn":case "toggleBtnChk":case "toggleBtnGroup":case "toggleBtnGroupCollapse":case "zoomPicture":case "setPlaySettings":window[c.cmd].apply(null,[a.target].concat($jscomp.arrayFromIterable(c.options)));break;case "toggleBtnChkCollapse":window[c.cmd].apply(null,[a.target,void 0].concat($jscomp.arrayFromIterable(c.options)));
break;default:window[c.cmd].apply(null,$jscomp.arrayFromIterable(c.options))}else logError("Can not execute cmd: "+c)}function gotoPage(a){switch(a){case "next":app.current.page+=settings.maxElementsPerPage;break;case "prev":app.current.page-=settings.maxElementsPerPage;0>app.current.page&&(app.current.page=0);break;default:app.current.page=a}appGoto(app.current.app,app.current.tab,app.current.view,app.current.page,app.current.filter,app.current.sort,app.current.tag,app.current.search)}
function validateFilenameString(a){return""===a?!1:null!==a.match(/^[\w-.]+$/)?!0:!1}function validateFilename(a){if(!1===validateFilenameString(a.value))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateFilenameList(a){a.classList.remove("is-invalid");for(var b=a.value.split(","),c=0;c<b.length;c++)if(!1===validateFilenameString(b[c].trim()))return a.classList.add("is-invalid"),!1;return!0}
function validatePath(a){if(""===a.value)return a.classList.add("is-invalid"),!1;if(null!==a.value.match(/^\/[/.\w-]+$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validatePlnameEl(a){if(!1===validatePlname(a.value))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validatePlname(a){return""===a?!1:null===a.match(/\/|\r|\n|"|'/)?!0:!1}
function validateNotBlank(a){if(""===a.value.replace(/\s/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateInt(a){if(""!==a.value.replace(/\d/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}function validateFloat(a){if(""!==a.value.replace(/[\d-.]/g,""))return a.classList.add("is-invalid"),!1;a.classList.remove("is-invalid");return!0}
function validateStream(a){if(-1<a.value.indexOf("://"))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1}function validateHost(a){if(null!==a.value.match(/^([\w-.]+)$/))return a.classList.remove("is-invalid"),!0;a.classList.add("is-invalid");return!1};
